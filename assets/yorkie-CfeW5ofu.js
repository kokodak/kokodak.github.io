function hl(bt){return bt&&bt.__esModule&&Object.prototype.hasOwnProperty.call(bt,"default")?bt.default:bt}var lr={exports:{}},al=lr.exports,_a;function ll(){return _a||(_a=1,function(bt,Va){var ki={};(function(L,Js){Js(Va)})(al,function(L){var Js=Object.defineProperty,Ka=(r,e,t)=>e in r?Js(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,o=(r,e,t)=>Ka(r,typeof e!="symbol"?e+"":e,t),Le,qe,$e,Ue,Fe,Me,ze,_e,Ve,D;(function(r){r[r.Canceled=1]="Canceled",r[r.Unknown=2]="Unknown",r[r.InvalidArgument=3]="InvalidArgument",r[r.DeadlineExceeded=4]="DeadlineExceeded",r[r.NotFound=5]="NotFound",r[r.AlreadyExists=6]="AlreadyExists",r[r.PermissionDenied=7]="PermissionDenied",r[r.ResourceExhausted=8]="ResourceExhausted",r[r.FailedPrecondition=9]="FailedPrecondition",r[r.Aborted=10]="Aborted",r[r.OutOfRange=11]="OutOfRange",r[r.Unimplemented=12]="Unimplemented",r[r.Internal=13]="Internal",r[r.Unavailable=14]="Unavailable",r[r.DataLoss=15]="DataLoss",r[r.Unauthenticated=16]="Unauthenticated"})(D||(D={}));function Ni(r){const e=D[r];return typeof e!="string"?r.toString():e[0].toLowerCase()+e.substring(1).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}class J extends Error{constructor(e,t=D.Unknown,n,s,i){super(ja(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t,this.metadata=new Headers(n??{}),this.details=s??[],this.cause=i}static from(e,t=D.Unknown){return e instanceof J?e:e instanceof Error?e.name=="AbortError"?new J(e.message,D.Canceled):new J(e.message,t,void 0,void 0,e):new J(String(e),t,void 0,void 0,e)}static[Symbol.hasInstance](e){return e instanceof Error?Object.getPrototypeOf(e)===J.prototype?!0:e.name==="ConnectError"&&"code"in e&&typeof e.code=="number"&&"metadata"in e&&"details"in e&&Array.isArray(e.details)&&"rawMessage"in e&&typeof e.rawMessage=="string"&&"cause"in e:!1}findDetails(e){const t="typeName"in e?{findMessage:s=>s===e.typeName?e:void 0}:e,n=[];for(const s of this.details){if("getType"in s){t.findMessage(s.getType().typeName)&&n.push(s);continue}const i=t.findMessage(s.type);if(i)try{n.push(i.fromBinary(s.value))}catch{}}return n}}function ja(r,e){return r.length?`[${Ni(e)}] ${r}`:`[${Ni(e)}]`}function M(r,e){if(!r)throw new Error(e)}const Wa=34028234663852886e22,Ga=-34028234663852886e22,Ha=4294967295,Ya=2147483647,Xa=-2147483648;function dn(r){if(typeof r!="number")throw new Error("invalid int 32: "+typeof r);if(!Number.isInteger(r)||r>Ya||r<Xa)throw new Error("invalid int 32: "+r)}function Ls(r){if(typeof r!="number")throw new Error("invalid uint 32: "+typeof r);if(!Number.isInteger(r)||r>Ha||r<0)throw new Error("invalid uint 32: "+r)}function Ei(r){if(typeof r!="number")throw new Error("invalid float 32: "+typeof r);if(Number.isFinite(r)&&(r>Wa||r<Ga))throw new Error("invalid float 32: "+r)}const Pi=Symbol("@bufbuild/protobuf/enum-type");function Za(r){const e=r[Pi];return M(e,"missing enum type on enum object"),e}function Di(r,e,t,n){r[Pi]=xi(e,t.map(s=>({no:s.no,name:s.name,localName:r[s.no]})))}function xi(r,e,t){const n=Object.create(null),s=Object.create(null),i=[];for(const a of e){const c=Ci(a);i.push(c),n[a.name]=c,s[a.no]=c}return{typeName:r,values:i,findName(a){return n[a]},findNumber(a){return s[a]}}}function Qa(r,e,t){const n={};for(const s of e){const i=Ci(s);n[i.localName]=i.no,n[i.no]=i.localName}return Di(n,r,e),n}function Ci(r){return"localName"in r?r:Object.assign(Object.assign({},r),{localName:r.name})}class T{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType(),s=n.runtime.bin,i=s.makeReadOptions(t);return s.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),s=n.runtime.json,i=s.makeReadOptions(t);return s.readMessage(n,e,i,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(s){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${s instanceof Error?s.message:String(s)}`)}return this.fromJson(n,t)}toBinary(e){const t=this.getType(),n=t.runtime.bin,s=n.makeWriteOptions(e),i=s.writerFactory();return n.writeMessage(this,i,s),i.finish()}toJson(e){const t=this.getType(),n=t.runtime.json,s=n.makeWriteOptions(e);return n.writeMessage(this,s)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function ec(r,e,t,n){var s;const i=(s=n==null?void 0:n.localName)!==null&&s!==void 0?s:e.substring(e.lastIndexOf(".")+1),a={[i]:function(c){r.util.initFields(this),r.util.initPartial(c,this)}}[i];return Object.setPrototypeOf(a.prototype,new T),Object.assign(a,{runtime:r,typeName:e,fields:r.util.newFieldList(t),fromBinary(c,h){return new a().fromBinary(c,h)},fromJson(c,h){return new a().fromJson(c,h)},fromJsonString(c,h){return new a().fromJsonString(c,h)},equals(c,h){return r.util.equals(a,c,h)}}),a}function tc(){let r=0,e=0;for(let n=0;n<28;n+=7){let s=this.buf[this.pos++];if(r|=(s&127)<<n,(s&128)==0)return this.assertBounds(),[r,e]}let t=this.buf[this.pos++];if(r|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[r,e];for(let n=3;n<=31;n+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<n,(s&128)==0)return this.assertBounds(),[r,e]}throw new Error("invalid varint")}function qs(r,e,t){for(let i=0;i<28;i=i+7){const a=r>>>i,c=!(!(a>>>7)&&e==0),h=(c?a|128:a)&255;if(t.push(h),!c)return}const n=r>>>28&15|(e&7)<<4,s=e>>3!=0;if(t.push((s?n|128:n)&255),!!s){for(let i=3;i<31;i=i+7){const a=e>>>i,c=!!(a>>>7),h=(c?a|128:a)&255;if(t.push(h),!c)return}t.push(e>>>31&1)}}const gn=4294967296;function Oi(r){const e=r[0]==="-";e&&(r=r.slice(1));const t=1e6;let n=0,s=0;function i(a,c){const h=Number(r.slice(a,c));s*=t,n=n*t+h,n>=gn&&(s=s+(n/gn|0),n=n%gn)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),e?Bi(n,s):$s(n,s)}function rc(r,e){let t=$s(r,e);const n=t.hi&2147483648;n&&(t=Bi(t.lo,t.hi));const s=Ri(t.lo,t.hi);return n?"-"+s:s}function Ri(r,e){if({lo:r,hi:e}=nc(r,e),e<=2097151)return String(gn*e+r);const t=r&16777215,n=(r>>>24|e<<8)&16777215,s=e>>16&65535;let i=t+n*6777216+s*6710656,a=n+s*8147497,c=s*2;const h=1e7;return i>=h&&(a+=Math.floor(i/h),i%=h),a>=h&&(c+=Math.floor(a/h),a%=h),c.toString()+Ji(a)+Ji(i)}function nc(r,e){return{lo:r>>>0,hi:e>>>0}}function $s(r,e){return{lo:r|0,hi:e|0}}function Bi(r,e){return e=~e,r?r=~r+1:e+=1,$s(r,e)}const Ji=r=>{const e=String(r);return"0000000".slice(e.length)+e};function Li(r,e){if(r>=0){for(;r>127;)e.push(r&127|128),r=r>>>7;e.push(r)}else{for(let t=0;t<9;t++)e.push(r&127|128),r=r>>7;e.push(1)}}function sc(){let r=this.buf[this.pos++],e=r&127;if((r&128)==0)return this.assertBounds(),e;if(r=this.buf[this.pos++],e|=(r&127)<<7,(r&128)==0)return this.assertBounds(),e;if(r=this.buf[this.pos++],e|=(r&127)<<14,(r&128)==0)return this.assertBounds(),e;if(r=this.buf[this.pos++],e|=(r&127)<<21,(r&128)==0)return this.assertBounds(),e;r=this.buf[this.pos++],e|=(r&15)<<28;for(let t=5;(r&128)!==0&&t<10;t++)r=this.buf[this.pos++];if((r&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function ic(){const r=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof r.getBigInt64=="function"&&typeof r.getBigUint64=="function"&&typeof r.setBigInt64=="function"&&typeof r.setBigUint64=="function"&&(typeof process!="object"||typeof ki!="object"||ki.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),i=BigInt("9223372036854775807"),a=BigInt("0"),c=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(h){const l=typeof h=="bigint"?h:BigInt(h);if(l>i||l<s)throw new Error(`int64 invalid: ${h}`);return l},uParse(h){const l=typeof h=="bigint"?h:BigInt(h);if(l>c||l<a)throw new Error(`uint64 invalid: ${h}`);return l},enc(h){return r.setBigInt64(0,this.parse(h),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},uEnc(h){return r.setBigInt64(0,this.uParse(h),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},dec(h,l){return r.setInt32(0,h,!0),r.setInt32(4,l,!0),r.getBigInt64(0,!0)},uDec(h,l){return r.setInt32(0,h,!0),r.setInt32(4,l,!0),r.getBigUint64(0,!0)}}}const t=s=>M(/^-?[0-9]+$/.test(s),`int64 invalid: ${s}`),n=s=>M(/^[0-9]+$/.test(s),`uint64 invalid: ${s}`);return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),t(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),n(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),t(s),Oi(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),n(s),Oi(s)},dec(s,i){return rc(s,i)},uDec(s,i){return Ri(s,i)}}}const U=ic();var p;(function(r){r[r.DOUBLE=1]="DOUBLE",r[r.FLOAT=2]="FLOAT",r[r.INT64=3]="INT64",r[r.UINT64=4]="UINT64",r[r.INT32=5]="INT32",r[r.FIXED64=6]="FIXED64",r[r.FIXED32=7]="FIXED32",r[r.BOOL=8]="BOOL",r[r.STRING=9]="STRING",r[r.BYTES=12]="BYTES",r[r.UINT32=13]="UINT32",r[r.SFIXED32=15]="SFIXED32",r[r.SFIXED64=16]="SFIXED64",r[r.SINT32=17]="SINT32",r[r.SINT64=18]="SINT64"})(p||(p={}));var et;(function(r){r[r.BIGINT=0]="BIGINT",r[r.STRING=1]="STRING"})(et||(et={}));function tt(r,e,t){if(e===t)return!0;if(r==p.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}switch(r){case p.UINT64:case p.FIXED64:case p.INT64:case p.SFIXED64:case p.SINT64:return e==t}return!1}function It(r,e){switch(r){case p.BOOL:return!1;case p.UINT64:case p.FIXED64:case p.INT64:case p.SFIXED64:case p.SINT64:return e==0?U.zero:"0";case p.DOUBLE:case p.FLOAT:return 0;case p.BYTES:return new Uint8Array(0);case p.STRING:return"";default:return 0}}function qi(r,e){switch(r){case p.BOOL:return e===!1;case p.STRING:return e==="";case p.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var V;(function(r){r[r.Varint=0]="Varint",r[r.Bit64=1]="Bit64",r[r.LengthDelimited=2]="LengthDelimited",r[r.StartGroup=3]="StartGroup",r[r.EndGroup=4]="EndGroup",r[r.Bit32=5]="Bit32"})(V||(V={}));class oc{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),n=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],n),n+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Ls(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return dn(e),Li(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Ei(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Ls(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){dn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return dn(e),e=(e<<1^e>>31)>>>0,Li(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),s=U.enc(e);return n.setInt32(0,s.lo,!0),n.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),s=U.uEnc(e);return n.setInt32(0,s.lo,!0),n.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=U.enc(e);return qs(t.lo,t.hi,this.buf),this}sint64(e){let t=U.enc(e),n=t.hi>>31,s=t.lo<<1^n,i=(t.hi<<1|t.lo>>>31)^n;return qs(s,i,this.buf),this}uint64(e){let t=U.uEnc(e);return qs(t.lo,t.hi,this.buf),this}}class ac{constructor(e,t){this.varint64=tc,this.uint32=sc,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=e&7;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case V.Varint:for(;this.buf[this.pos++]&128;);break;case V.Bit64:this.pos+=4;case V.Bit32:this.pos+=4;break;case V.LengthDelimited:let s=this.uint32();this.pos+=s;break;case V.StartGroup:for(;;){const[i,a]=this.tag();if(a===V.EndGroup){if(t!==void 0&&i!==t)throw new Error("invalid end group tag");break}this.skip(a,i)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return U.dec(...this.varint64())}uint64(){return U.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(e&1);return e=(e>>>1|(t&1)<<31)^n,t=t>>>1^n,U.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return U.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return U.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function cc(r,e,t,n){let s;return{typeName:e,extendee:t,get field(){if(!s){const i=typeof n=="function"?n():n;i.name=e.split(".").pop(),i.jsonName=`[${e}]`,s=r.util.newFieldList([i]).list()[0]}return s},runtime:r}}function $i(r){const e=r.field.localName,t=Object.create(null);return t[e]=uc(r),[t,()=>t[e]]}function uc(r){const e=r.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return It(e.T,e.L);case"message":const t=e.T,n=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}function hc(r,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=r.length-1;t>=0;--t)if(r[t].no==e.no)return[r[t]];return[]}return r.filter(t=>t.no===e.no)}let Ke="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),mn=[];for(let r=0;r<Ke.length;r++)mn[Ke[r].charCodeAt(0)]=r;mn[45]=Ke.indexOf("+"),mn[95]=Ke.indexOf("/");const Us={dec(r){let e=r.length*3/4;r[r.length-2]=="="?e-=2:r[r.length-1]=="="&&(e-=1);let t=new Uint8Array(e),n=0,s=0,i,a=0;for(let c=0;c<r.length;c++){if(i=mn[r.charCodeAt(c)],i===void 0)switch(r[c]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:a=i,s=1;break;case 1:t[n++]=a<<2|(i&48)>>4,a=i,s=2;break;case 2:t[n++]=(a&15)<<4|(i&60)>>2,a=i,s=3;break;case 3:t[n++]=(a&3)<<6|i,s=0;break}}if(s==1)throw Error("invalid base64 string.");return t.subarray(0,n)},enc(r){let e="",t=0,n,s=0;for(let i=0;i<r.length;i++)switch(n=r[i],t){case 0:e+=Ke[n>>2],s=(n&3)<<4,t=1;break;case 1:e+=Ke[s|n>>4],s=(n&15)<<2,t=2;break;case 2:e+=Ke[s|n>>6],e+=Ke[n&63],t=0;break}return t&&(e+=Ke[s],e+="=",t==1&&(e+="=")),e}};function lc(r,e,t){Fi(e,r);const n=e.runtime.bin.makeReadOptions(t),s=hc(r.getType().runtime.bin.listUnknownFields(r),e.field),[i,a]=$i(e);for(const c of s)e.runtime.bin.readField(i,n.readerFactory(c.data),e.field,c.wireType,n);return a()}function fc(r,e,t,n){Fi(e,r);const s=e.runtime.bin.makeReadOptions(n),i=e.runtime.bin.makeWriteOptions(n);if(Ui(r,e)){const l=r.getType().runtime.bin.listUnknownFields(r).filter(f=>f.no!=e.field.no);r.getType().runtime.bin.discardUnknownFields(r);for(const f of l)r.getType().runtime.bin.onUnknownField(r,f.no,f.wireType,f.data)}const a=i.writerFactory();let c=e.field;!c.opt&&!c.repeated&&(c.kind=="enum"||c.kind=="scalar")&&(c=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(c,t,a,i);const h=s.readerFactory(a.finish());for(;h.pos<h.len;){const[l,f]=h.tag(),m=h.skip(f,l);r.getType().runtime.bin.onUnknownField(r,l,f,m)}}function Ui(r,e){const t=r.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(r).find(n=>n.no==e.field.no)}function Fi(r,e){M(r.extendee.typeName==e.getType().typeName,`extension ${r.typeName} can only be applied to message ${r.extendee.typeName}`)}function Mi(r,e){const t=r.localName;if(r.repeated)return e[t].length>0;if(r.oneof)return e[r.oneof.localName].case===t;switch(r.kind){case"enum":case"scalar":return r.opt||r.req?e[t]!==void 0:r.kind=="enum"?e[t]!==r.T.values[0].no:!qi(r.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function zi(r,e){const t=r.localName,n=!r.opt&&!r.req;if(r.repeated)e[t]=[];else if(r.oneof)e[r.oneof.localName]={case:void 0};else switch(r.kind){case"map":e[t]={};break;case"enum":e[t]=n?r.T.values[0].no:void 0;break;case"scalar":e[t]=n?It(r.T,r.L):void 0;break;case"message":e[t]=void 0;break}}function ut(r,e){if(r===null||typeof r!="object"||!Object.getOwnPropertyNames(T.prototype).every(n=>n in r&&typeof r[n]=="function"))return!1;const t=r.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function _i(r,e){return ut(e)||!r.fieldWrapper?e:r.fieldWrapper.wrapField(e)}p.DOUBLE,p.FLOAT,p.INT64,p.UINT64,p.INT32,p.UINT32,p.BOOL,p.STRING,p.BYTES;const Vi={ignoreUnknownFields:!1},Ki={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function dc(r){return r?Object.assign(Object.assign({},Vi),r):Vi}function gc(r){return r?Object.assign(Object.assign({},Ki),r):Ki}const pn=Symbol(),yn=Symbol();function mc(){return{makeReadOptions:dc,makeWriteOptions:gc,readMessage(r,e,t,n){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${r.typeName} from JSON: ${Se(e)}`);n=n??new r;const s=new Map,i=t.typeRegistry;for(const[a,c]of Object.entries(e)){const h=r.fields.findJsonName(a);if(h){if(h.oneof){if(c===null&&h.kind=="scalar")continue;const l=s.get(h.oneof);if(l!==void 0)throw new Error(`cannot decode message ${r.typeName} from JSON: multiple keys for oneof "${h.oneof.name}" present: "${l}", "${a}"`);s.set(h.oneof,a)}ji(n,c,h,t,r)}else{let l=!1;if(i!=null&&i.findExtension&&a.startsWith("[")&&a.endsWith("]")){const f=i.findExtension(a.substring(1,a.length-1));if(f&&f.extendee.typeName==r.typeName){l=!0;const[m,v]=$i(f);ji(m,c,f.field,t,f),fc(n,f,v(),t)}}if(!l&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${r.typeName} from JSON: key "${a}" is unknown`)}}return n},writeMessage(r,e){const t=r.getType(),n={};let s;try{for(s of t.fields.byNumber()){if(!Mi(s,r)){if(s.req)throw"required field not set";if(!e.emitDefaultValues||!yc(s))continue}const a=s.oneof?r[s.oneof.localName].value:r[s.localName],c=Wi(s,a,e);c!==void 0&&(n[e.useProtoFieldName?s.name:s.jsonName]=c)}const i=e.typeRegistry;if(i!=null&&i.findExtensionFor)for(const a of t.runtime.bin.listUnknownFields(r)){const c=i.findExtensionFor(t.typeName,a.no);if(c&&Ui(r,c)){const h=lc(r,c,e),l=Wi(c.field,h,e);l!==void 0&&(n[c.field.jsonName]=l)}}}catch(i){const a=s?`cannot encode field ${t.typeName}.${s.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,c=i instanceof Error?i.message:String(i);throw new Error(a+(c.length>0?`: ${c}`:""))}return n},readScalar(r,e,t){return $t(r,e,t??et.BIGINT,!0)},writeScalar(r,e,t){if(e!==void 0&&(t||qi(r,e)))return vn(r,e)},debug:Se}}function Se(r){if(r===null)return"null";switch(typeof r){case"object":return Array.isArray(r)?"array":"object";case"string":return r.length>100?"string":`"${r.split('"').join('\\"')}"`;default:return String(r)}}function ji(r,e,t,n,s){let i=t.localName;if(t.repeated){if(M(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${Se(e)}`);const a=r[i];for(const c of e){if(c===null)throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${Se(c)}`);switch(t.kind){case"message":a.push(t.T.fromJson(c,n));break;case"enum":const h=Fs(t.T,c,n.ignoreUnknownFields,!0);h!==yn&&a.push(h);break;case"scalar":try{a.push($t(t.T,c,t.L,!0))}catch(l){let f=`cannot decode field ${s.typeName}.${t.name} from JSON: ${Se(c)}`;throw l instanceof Error&&l.message.length>0&&(f+=`: ${l.message}`),new Error(f)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${Se(e)}`);const a=r[i];for(const[c,h]of Object.entries(e)){if(h===null)throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: map value null`);let l;try{l=pc(t.K,c)}catch(f){let m=`cannot decode map key for field ${s.typeName}.${t.name} from JSON: ${Se(e)}`;throw f instanceof Error&&f.message.length>0&&(m+=`: ${f.message}`),new Error(m)}switch(t.V.kind){case"message":a[l]=t.V.T.fromJson(h,n);break;case"enum":const f=Fs(t.V.T,h,n.ignoreUnknownFields,!0);f!==yn&&(a[l]=f);break;case"scalar":try{a[l]=$t(t.V.T,h,et.BIGINT,!0)}catch(m){let v=`cannot decode map value for field ${s.typeName}.${t.name} from JSON: ${Se(e)}`;throw m instanceof Error&&m.message.length>0&&(v+=`: ${m.message}`),new Error(v)}break}}}else switch(t.oneof&&(r=r[t.oneof.localName]={case:i},i="value"),t.kind){case"message":const a=t.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let c=r[i];ut(c)?c.fromJson(e,n):(r[i]=c=a.fromJson(e,n),a.fieldWrapper&&!t.oneof&&(r[i]=a.fieldWrapper.unwrapField(c)));break;case"enum":const h=Fs(t.T,e,n.ignoreUnknownFields,!1);switch(h){case pn:zi(t,r);break;case yn:break;default:r[i]=h;break}break;case"scalar":try{const l=$t(t.T,e,t.L,!1);switch(l){case pn:zi(t,r);break;default:r[i]=l;break}}catch(l){let f=`cannot decode field ${s.typeName}.${t.name} from JSON: ${Se(e)}`;throw l instanceof Error&&l.message.length>0&&(f+=`: ${l.message}`),new Error(f)}break}}function pc(r,e){if(r===p.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return $t(r,e,et.BIGINT,!0).toString()}function $t(r,e,t,n){if(e===null)return n?It(r,t):pn;switch(r){case p.DOUBLE:case p.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const s=Number(e);if(Number.isNaN(s)||!Number.isFinite(s))break;return r==p.FLOAT&&Ei(s),s;case p.INT32:case p.FIXED32:case p.SFIXED32:case p.SINT32:case p.UINT32:let i;if(typeof e=="number"?i=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(i=Number(e)),i===void 0)break;return r==p.UINT32||r==p.FIXED32?Ls(i):dn(i),i;case p.INT64:case p.SFIXED64:case p.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=U.parse(e);return t?a.toString():a;case p.FIXED64:case p.UINT64:if(typeof e!="number"&&typeof e!="string")break;const c=U.uParse(e);return t?c.toString():c;case p.BOOL:if(typeof e!="boolean")break;return e;case p.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case p.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Us.dec(e)}throw new Error}function Fs(r,e,t,n){if(e===null)return r.typeName=="google.protobuf.NullValue"?0:n?r.values[0].no:pn;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const s=r.findName(e);if(s!==void 0)return s.no;if(t)return yn;break}throw new Error(`cannot decode enum ${r.typeName} from JSON: ${Se(e)}`)}function yc(r){return r.repeated||r.kind=="map"?!0:!(r.oneof||r.kind=="message"||r.opt||r.req)}function Wi(r,e,t){if(r.kind=="map"){M(typeof e=="object"&&e!=null);const n={},s=Object.entries(e);switch(r.V.kind){case"scalar":for(const[a,c]of s)n[a.toString()]=vn(r.V.T,c);break;case"message":for(const[a,c]of s)n[a.toString()]=c.toJson(t);break;case"enum":const i=r.V.T;for(const[a,c]of s)n[a.toString()]=Ms(i,c,t.enumAsInteger);break}return t.emitDefaultValues||s.length>0?n:void 0}if(r.repeated){M(Array.isArray(e));const n=[];switch(r.kind){case"scalar":for(let s=0;s<e.length;s++)n.push(vn(r.T,e[s]));break;case"enum":for(let s=0;s<e.length;s++)n.push(Ms(r.T,e[s],t.enumAsInteger));break;case"message":for(let s=0;s<e.length;s++)n.push(e[s].toJson(t));break}return t.emitDefaultValues||n.length>0?n:void 0}switch(r.kind){case"scalar":return vn(r.T,e);case"enum":return Ms(r.T,e,t.enumAsInteger);case"message":return _i(r.T,e).toJson(t)}}function Ms(r,e,t){var n;if(M(typeof e=="number"),r.typeName=="google.protobuf.NullValue")return null;if(t)return e;const s=r.findNumber(e);return(n=s==null?void 0:s.name)!==null&&n!==void 0?n:e}function vn(r,e){switch(r){case p.INT32:case p.SFIXED32:case p.SINT32:case p.FIXED32:case p.UINT32:return M(typeof e=="number"),e;case p.FLOAT:case p.DOUBLE:return M(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case p.STRING:return M(typeof e=="string"),e;case p.BOOL:return M(typeof e=="boolean"),e;case p.UINT64:case p.FIXED64:case p.INT64:case p.SFIXED64:case p.SINT64:return M(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case p.BYTES:return M(e instanceof Uint8Array),Us.enc(e)}}const At=Symbol("@bufbuild/protobuf/unknown-fields"),Gi={readUnknownFields:!0,readerFactory:r=>new ac(r)},Hi={writeUnknownFields:!0,writerFactory:()=>new oc};function vc(r){return r?Object.assign(Object.assign({},Gi),r):Gi}function wc(r){return r?Object.assign(Object.assign({},Hi),r):Hi}function Tc(){return{makeReadOptions:vc,makeWriteOptions:wc,listUnknownFields(r){var e;return(e=r[At])!==null&&e!==void 0?e:[]},discardUnknownFields(r){delete r[At]},writeUnknownFields(r,e){const n=r[At];if(n)for(const s of n)e.tag(s.no,s.wireType).raw(s.data)},onUnknownField(r,e,t,n){const s=r;Array.isArray(s[At])||(s[At]=[]),s[At].push({no:e,wireType:t,data:n})},readMessage(r,e,t,n,s){const i=r.getType(),a=s?e.len:e.pos+t;let c,h;for(;e.pos<a&&([c,h]=e.tag(),!(s===!0&&h==V.EndGroup));){const l=i.fields.find(c);if(!l){const f=e.skip(h,c);n.readUnknownFields&&this.onUnknownField(r,c,h,f);continue}Yi(r,e,l,h,n)}if(s&&(h!=V.EndGroup||c!==t))throw new Error("invalid end group tag")},readField:Yi,writeMessage(r,e,t){const n=r.getType();for(const s of n.fields.byNumber()){if(!Mi(s,r)){if(s.req)throw new Error(`cannot encode field ${n.typeName}.${s.name} to binary: required field not set`);continue}const i=s.oneof?r[s.oneof.localName].value:r[s.localName];Xi(s,i,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(r,e),e},writeField(r,e,t,n){e!==void 0&&Xi(r,e,t,n)}}}function Yi(r,e,t,n,s){let{repeated:i,localName:a}=t;switch(t.oneof&&(r=r[t.oneof.localName],r.case!=a&&delete r.value,r.case=a,a="value"),t.kind){case"scalar":case"enum":const c=t.kind=="enum"?p.INT32:t.T;let h=Tn;if(t.kind=="scalar"&&t.L>0&&(h=bc),i){let v=r[a];if(n==V.LengthDelimited&&c!=p.STRING&&c!=p.BYTES){let S=e.uint32()+e.pos;for(;e.pos<S;)v.push(h(e,c))}else v.push(h(e,c))}else r[a]=h(e,c);break;case"message":const l=t.T;i?r[a].push(wn(e,new l,s,t)):ut(r[a])?wn(e,r[a],s,t):(r[a]=wn(e,new l,s,t),l.fieldWrapper&&!t.oneof&&!t.repeated&&(r[a]=l.fieldWrapper.unwrapField(r[a])));break;case"map":let[f,m]=Sc(t,e,s);r[a][f]=m;break}}function wn(r,e,t,n){const s=e.getType().runtime.bin,i=n==null?void 0:n.delimited;return s.readMessage(e,r,i?n.no:r.uint32(),t,i),e}function Sc(r,e,t){const n=e.uint32(),s=e.pos+n;let i,a;for(;e.pos<s;){const[c]=e.tag();switch(c){case 1:i=Tn(e,r.K);break;case 2:switch(r.V.kind){case"scalar":a=Tn(e,r.V.T);break;case"enum":a=e.int32();break;case"message":a=wn(e,new r.V.T,t,void 0);break}break}}if(i===void 0&&(i=It(r.K,et.BIGINT)),typeof i!="string"&&typeof i!="number"&&(i=i.toString()),a===void 0)switch(r.V.kind){case"scalar":a=It(r.V.T,et.BIGINT);break;case"enum":a=r.V.T.values[0].no;break;case"message":a=new r.V.T;break}return[i,a]}function bc(r,e){const t=Tn(r,e);return typeof t=="bigint"?t.toString():t}function Tn(r,e){switch(e){case p.STRING:return r.string();case p.BOOL:return r.bool();case p.DOUBLE:return r.double();case p.FLOAT:return r.float();case p.INT32:return r.int32();case p.INT64:return r.int64();case p.UINT64:return r.uint64();case p.FIXED64:return r.fixed64();case p.BYTES:return r.bytes();case p.FIXED32:return r.fixed32();case p.SFIXED32:return r.sfixed32();case p.SFIXED64:return r.sfixed64();case p.SINT64:return r.sint64();case p.UINT32:return r.uint32();case p.SINT32:return r.sint32()}}function Xi(r,e,t,n){M(e!==void 0);const s=r.repeated;switch(r.kind){case"scalar":case"enum":let i=r.kind=="enum"?p.INT32:r.T;if(s)if(M(Array.isArray(e)),r.packed)Ac(t,i,r.no,e);else for(const a of e)Ut(t,i,r.no,a);else Ut(t,i,r.no,e);break;case"message":if(s){M(Array.isArray(e));for(const a of e)Zi(t,n,r,a)}else Zi(t,n,r,e);break;case"map":M(typeof e=="object"&&e!=null);for(const[a,c]of Object.entries(e))Ic(t,n,r,a,c);break}}function Ic(r,e,t,n,s){r.tag(t.no,V.LengthDelimited),r.fork();let i=n;switch(t.K){case p.INT32:case p.FIXED32:case p.UINT32:case p.SFIXED32:case p.SINT32:i=Number.parseInt(n);break;case p.BOOL:M(n=="true"||n=="false"),i=n=="true";break}switch(Ut(r,t.K,1,i),t.V.kind){case"scalar":Ut(r,t.V.T,2,s);break;case"enum":Ut(r,p.INT32,2,s);break;case"message":M(s!==void 0),r.tag(2,V.LengthDelimited).bytes(s.toBinary(e));break}r.join()}function Zi(r,e,t,n){const s=_i(t.T,n);t.delimited?r.tag(t.no,V.StartGroup).raw(s.toBinary(e)).tag(t.no,V.EndGroup):r.tag(t.no,V.LengthDelimited).bytes(s.toBinary(e))}function Ut(r,e,t,n){M(n!==void 0);let[s,i]=Qi(e);r.tag(t,s)[i](n)}function Ac(r,e,t,n){if(!n.length)return;r.tag(t,V.LengthDelimited).fork();let[,s]=Qi(e);for(let i=0;i<n.length;i++)r[s](n[i]);r.join()}function Qi(r){let e=V.Varint;switch(r){case p.BYTES:case p.STRING:e=V.LengthDelimited;break;case p.DOUBLE:case p.FIXED64:case p.SFIXED64:e=V.Bit64;break;case p.FIXED32:case p.SFIXED32:case p.FLOAT:e=V.Bit32;break}const t=p[r].toLowerCase();return[e,t]}function kc(){return{setEnumType:Di,initPartial(r,e){if(r===void 0)return;const t=e.getType();for(const n of t.fields.byMember()){const s=n.localName,i=e,a=r;if(a[s]!=null)switch(n.kind){case"oneof":const c=a[s].case;if(c===void 0)continue;const h=n.findField(c);let l=a[s].value;h&&h.kind=="message"&&!ut(l,h.T)?l=new h.T(l):h&&h.kind==="scalar"&&h.T===p.BYTES&&(l=Ft(l)),i[s]={case:c,value:l};break;case"scalar":case"enum":let f=a[s];n.T===p.BYTES&&(f=n.repeated?f.map(Ft):Ft(f)),i[s]=f;break;case"map":switch(n.V.kind){case"scalar":case"enum":if(n.V.T===p.BYTES)for(const[y,S]of Object.entries(a[s]))i[s][y]=Ft(S);else Object.assign(i[s],a[s]);break;case"message":const v=n.V.T;for(const y of Object.keys(a[s])){let S=a[s][y];v.fieldWrapper||(S=new v(S)),i[s][y]=S}break}break;case"message":const m=n.T;if(n.repeated)i[s]=a[s].map(v=>ut(v,m)?v:new m(v));else{const v=a[s];m.fieldWrapper?m.typeName==="google.protobuf.BytesValue"?i[s]=Ft(v):i[s]=v:i[s]=ut(v,m)?v:new m(v)}break}}},equals(r,e,t){return e===t?!0:!e||!t?!1:r.fields.byMember().every(n=>{const s=e[n.localName],i=t[n.localName];if(n.repeated){if(s.length!==i.length)return!1;switch(n.kind){case"message":return s.every((a,c)=>n.T.equals(a,i[c]));case"scalar":return s.every((a,c)=>tt(n.T,a,i[c]));case"enum":return s.every((a,c)=>tt(p.INT32,a,i[c]))}throw new Error(`repeated cannot contain ${n.kind}`)}switch(n.kind){case"message":return n.T.equals(s,i);case"enum":return tt(p.INT32,s,i);case"scalar":return tt(n.T,s,i);case"oneof":if(s.case!==i.case)return!1;const a=n.findField(s.case);if(a===void 0)return!0;switch(a.kind){case"message":return a.T.equals(s.value,i.value);case"enum":return tt(p.INT32,s.value,i.value);case"scalar":return tt(a.T,s.value,i.value)}throw new Error(`oneof cannot contain ${a.kind}`);case"map":const c=Object.keys(s).concat(Object.keys(i));switch(n.V.kind){case"message":const h=n.V.T;return c.every(f=>h.equals(s[f],i[f]));case"enum":return c.every(f=>tt(p.INT32,s[f],i[f]));case"scalar":const l=n.V.T;return c.every(f=>tt(l,s[f],i[f]))}break}})},clone(r){const e=r.getType(),t=new e,n=t;for(const s of e.fields.byMember()){const i=r[s.localName];let a;if(s.repeated)a=i.map(Sn);else if(s.kind=="map"){a=n[s.localName];for(const[c,h]of Object.entries(i))a[c]=Sn(h)}else s.kind=="oneof"?a=s.findField(i.case)?{case:i.case,value:Sn(i.value)}:{case:void 0}:a=Sn(i);n[s.localName]=a}for(const s of e.runtime.bin.listUnknownFields(r))e.runtime.bin.onUnknownField(n,s.no,s.wireType,s.data);return t}}}function Sn(r){if(r===void 0)return r;if(ut(r))return r.clone();if(r instanceof Uint8Array){const e=new Uint8Array(r.byteLength);return e.set(r),e}return r}function Ft(r){return r instanceof Uint8Array?r:new Uint8Array(r)}function Nc(r,e,t){return{syntax:r,json:mc(),bin:Tc(),util:Object.assign(Object.assign({},kc()),{newFieldList:e,initFields:t}),makeMessageType(n,s,i){return ec(this,n,s,i)},makeEnum:Qa,makeEnumType:xi,getEnumType:Za,makeExtension(n,s,i){return cc(this,n,s,i)}}}class Ec{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const n of this.list())t[n.jsonName]=t[n.name]=n;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const n of this.list())t[n.no]=n;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function eo(r,e){const t=to(r);return e?t:Rc(Oc(t))}function Pc(r){return eo(r,!1)}const Dc=to;function to(r){let e=!1;const t=[];for(let n=0;n<r.length;n++){let s=r.charAt(n);switch(s){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(s),e=!1;break;default:e&&(e=!1,s=s.toUpperCase()),t.push(s);break}}return t.join("")}const xc=new Set(["constructor","toString","toJSON","valueOf"]),Cc=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),ro=r=>`${r}$`,Oc=r=>Cc.has(r)?ro(r):r,Rc=r=>xc.has(r)?ro(r):r;class Bc{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Pc(e)}addField(e){M(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function Jc(r,e){var t,n,s,i,a,c;const h=[];let l;for(const f of typeof r=="function"?r():r){const m=f;if(m.localName=eo(f.name,f.oneof!==void 0),m.jsonName=(t=f.jsonName)!==null&&t!==void 0?t:Dc(f.name),m.repeated=(n=f.repeated)!==null&&n!==void 0?n:!1,f.kind=="scalar"&&(m.L=(s=f.L)!==null&&s!==void 0?s:et.BIGINT),m.delimited=(i=f.delimited)!==null&&i!==void 0?i:!1,m.req=(a=f.req)!==null&&a!==void 0?a:!1,m.opt=(c=f.opt)!==null&&c!==void 0?c:!1,f.packed===void 0&&(m.packed=f.kind=="enum"||f.kind=="scalar"&&f.T!=p.BYTES&&f.T!=p.STRING),f.oneof!==void 0){const v=typeof f.oneof=="string"?f.oneof:f.oneof.name;(!l||l.name!=v)&&(l=new Bc(v)),m.oneof=l,l.addField(m)}h.push(m)}return h}const u=Nc("proto3",r=>new Ec(r,e=>Jc(e)),r=>{for(const e of r.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,n=r;if(e.repeated){n[t]=[];continue}switch(e.kind){case"oneof":n[t]={case:void 0};break;case"enum":n[t]=0;break;case"map":n[t]={};break;case"scalar":n[t]=It(e.T,e.L);break}}});var Q;(function(r){r[r.Unary=0]="Unary",r[r.ServerStreaming=1]="ServerStreaming",r[r.ClientStreaming=2]="ClientStreaming",r[r.BiDiStreaming=3]="BiDiStreaming"})(Q||(Q={}));var no;(function(r){r[r.NoSideEffects=1]="NoSideEffects",r[r.Idempotent=2]="Idempotent"})(no||(no={}));class Y extends T{constructor(e){super(),this.seconds=U.zero,this.nanos=0,u.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error(`cannot decode google.protobuf.Timestamp from JSON: ${u.json.debug(e)}`);const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const s=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=U.parse(s/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?n="."+s.substring(0,3)+"Z":s.substring(6)==="000"?n="."+s.substring(0,6)+"Z":n="."+s+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Y.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Y({seconds:U.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new Y().fromBinary(e,t)}static fromJson(e,t){return new Y().fromJson(e,t)}static fromJsonString(e,t){return new Y().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Y,e,t)}}Y.runtime=u,Y.typeName="google.protobuf.Timestamp",Y.fields=u.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class je extends T{constructor(e){super(),this.seconds=U.zero,this.nanos=0,u.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(e)}`);const n=e.match(/^(-?[0-9]+)(?:\.([0-9]+))?s/);if(n===null)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(e)}`);const s=Number(n[1]);if(s>315576e6||s<-315576e6)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(e)}`);if(this.seconds=U.parse(s),typeof n[2]=="string"){const i=n[2]+"0".repeat(9-n[2].length);this.nanos=parseInt(i),(s<0||Object.is(s,-0))&&(this.nanos=-this.nanos)}return this}toJson(e){if(Number(this.seconds)>315576e6||Number(this.seconds)<-315576e6)throw new Error("cannot encode google.protobuf.Duration to JSON: value out of range");let t=this.seconds.toString();if(this.nanos!==0){let n=Math.abs(this.nanos).toString();n="0".repeat(9-n.length)+n,n.substring(3)==="000000"?n=n.substring(0,3):n.substring(6)==="000"&&(n=n.substring(0,6)),t+="."+n,this.nanos<0&&Number(this.seconds)==0&&(t="-"+t)}return t+"s"}static fromBinary(e,t){return new je().fromBinary(e,t)}static fromJson(e,t){return new je().fromJson(e,t)}static fromJsonString(e,t){return new je().fromJsonString(e,t)}static equals(e,t){return u.util.equals(je,e,t)}}je.runtime=u,je.typeName="google.protobuf.Duration",je.fields=u.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class be extends T{constructor(e){super(),this.typeUrl="",this.value=new Uint8Array(0),u.util.initPartial(e,this)}toJson(e){var t;if(this.typeUrl==="")return{};const n=this.typeUrlToName(this.typeUrl),s=(t=e==null?void 0:e.typeRegistry)===null||t===void 0?void 0:t.findMessage(n);if(!s)throw new Error(`cannot encode message google.protobuf.Any to JSON: "${this.typeUrl}" is not in the type registry`);let a=s.fromBinary(this.value).toJson(e);return(n.startsWith("google.protobuf.")||a===null||Array.isArray(a)||typeof a!="object")&&(a={value:a}),a["@type"]=this.typeUrl,a}fromJson(e,t){var n;if(e===null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message google.protobuf.Any from JSON: expected object but got ${e===null?"null":Array.isArray(e)?"array":typeof e}`);if(Object.keys(e).length==0)return this;const s=e["@type"];if(typeof s!="string"||s=="")throw new Error('cannot decode message google.protobuf.Any from JSON: "@type" is empty');const i=this.typeUrlToName(s),a=(n=t==null?void 0:t.typeRegistry)===null||n===void 0?void 0:n.findMessage(i);if(!a)throw new Error(`cannot decode message google.protobuf.Any from JSON: ${s} is not in the type registry`);let c;if(i.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(e,"value"))c=a.fromJson(e.value,t);else{const h=Object.assign({},e);delete h["@type"],c=a.fromJson(h,t)}return this.packFrom(c),this}packFrom(e){this.value=e.toBinary(),this.typeUrl=this.typeNameToUrl(e.getType().typeName)}unpackTo(e){return this.is(e.getType())?(e.fromBinary(this.value),!0):!1}unpack(e){if(this.typeUrl==="")return;const t=e.findMessage(this.typeUrlToName(this.typeUrl));if(t)return t.fromBinary(this.value)}is(e){if(this.typeUrl==="")return!1;const t=this.typeUrlToName(this.typeUrl);let n="";return typeof e=="string"?n=e:n=e.typeName,t===n}typeNameToUrl(e){return`type.googleapis.com/${e}`}typeUrlToName(e){if(!e.length)throw new Error(`invalid type url: ${e}`);const t=e.lastIndexOf("/"),n=t>=0?e.substring(t+1):e;if(!n.length)throw new Error(`invalid type url: ${e}`);return n}static pack(e){const t=new be;return t.packFrom(e),t}static fromBinary(e,t){return new be().fromBinary(e,t)}static fromJson(e,t){return new be().fromJson(e,t)}static fromJsonString(e,t){return new be().fromJsonString(e,t)}static equals(e,t){return u.util.equals(be,e,t)}}be.runtime=u,be.typeName="google.protobuf.Any",be.fields=u.util.newFieldList(()=>[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}]);class Ie extends T{constructor(e){super(),this.value=0,u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.DOUBLE,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.DOUBLE,e)}catch(n){let s='cannot decode message google.protobuf.DoubleValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Ie().fromBinary(e,t)}static fromJson(e,t){return new Ie().fromJson(e,t)}static fromJsonString(e,t){return new Ie().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Ie,e,t)}}Ie.runtime=u,Ie.typeName="google.protobuf.DoubleValue",Ie.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:1}]),Ie.fieldWrapper={wrapField(r){return new Ie({value:r})},unwrapField(r){return r.value}};class Ae extends T{constructor(e){super(),this.value=0,u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.FLOAT,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.FLOAT,e)}catch(n){let s='cannot decode message google.protobuf.FloatValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Ae().fromBinary(e,t)}static fromJson(e,t){return new Ae().fromJson(e,t)}static fromJsonString(e,t){return new Ae().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Ae,e,t)}}Ae.runtime=u,Ae.typeName="google.protobuf.FloatValue",Ae.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:2}]),Ae.fieldWrapper={wrapField(r){return new Ae({value:r})},unwrapField(r){return r.value}};class ke extends T{constructor(e){super(),this.value=U.zero,u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.INT64,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.INT64,e)}catch(n){let s='cannot decode message google.protobuf.Int64Value from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new ke().fromBinary(e,t)}static fromJson(e,t){return new ke().fromJson(e,t)}static fromJsonString(e,t){return new ke().fromJsonString(e,t)}static equals(e,t){return u.util.equals(ke,e,t)}}ke.runtime=u,ke.typeName="google.protobuf.Int64Value",ke.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:3}]),ke.fieldWrapper={wrapField(r){return new ke({value:r})},unwrapField(r){return r.value}};class Ne extends T{constructor(e){super(),this.value=U.zero,u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.UINT64,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.UINT64,e)}catch(n){let s='cannot decode message google.protobuf.UInt64Value from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Ne().fromBinary(e,t)}static fromJson(e,t){return new Ne().fromJson(e,t)}static fromJsonString(e,t){return new Ne().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Ne,e,t)}}Ne.runtime=u,Ne.typeName="google.protobuf.UInt64Value",Ne.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:4}]),Ne.fieldWrapper={wrapField(r){return new Ne({value:r})},unwrapField(r){return r.value}};class Ee extends T{constructor(e){super(),this.value=0,u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.INT32,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.INT32,e)}catch(n){let s='cannot decode message google.protobuf.Int32Value from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Ee().fromBinary(e,t)}static fromJson(e,t){return new Ee().fromJson(e,t)}static fromJsonString(e,t){return new Ee().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Ee,e,t)}}Ee.runtime=u,Ee.typeName="google.protobuf.Int32Value",Ee.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:5}]),Ee.fieldWrapper={wrapField(r){return new Ee({value:r})},unwrapField(r){return r.value}};class Pe extends T{constructor(e){super(),this.value=0,u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.UINT32,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.UINT32,e)}catch(n){let s='cannot decode message google.protobuf.UInt32Value from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Pe().fromBinary(e,t)}static fromJson(e,t){return new Pe().fromJson(e,t)}static fromJsonString(e,t){return new Pe().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Pe,e,t)}}Pe.runtime=u,Pe.typeName="google.protobuf.UInt32Value",Pe.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:13}]),Pe.fieldWrapper={wrapField(r){return new Pe({value:r})},unwrapField(r){return r.value}};class De extends T{constructor(e){super(),this.value=!1,u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.BOOL,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.BOOL,e)}catch(n){let s='cannot decode message google.protobuf.BoolValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new De().fromBinary(e,t)}static fromJson(e,t){return new De().fromJson(e,t)}static fromJsonString(e,t){return new De().fromJsonString(e,t)}static equals(e,t){return u.util.equals(De,e,t)}}De.runtime=u,De.typeName="google.protobuf.BoolValue",De.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:8}]),De.fieldWrapper={wrapField(r){return new De({value:r})},unwrapField(r){return r.value}};class re extends T{constructor(e){super(),this.value="",u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.STRING,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.STRING,e)}catch(n){let s='cannot decode message google.protobuf.StringValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new re().fromBinary(e,t)}static fromJson(e,t){return new re().fromJson(e,t)}static fromJsonString(e,t){return new re().fromJsonString(e,t)}static equals(e,t){return u.util.equals(re,e,t)}}re.runtime=u,re.typeName="google.protobuf.StringValue",re.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9}]),re.fieldWrapper={wrapField(r){return new re({value:r})},unwrapField(r){return r.value}};class xe extends T{constructor(e){super(),this.value=new Uint8Array(0),u.util.initPartial(e,this)}toJson(e){return u.json.writeScalar(p.BYTES,this.value,!0)}fromJson(e,t){try{this.value=u.json.readScalar(p.BYTES,e)}catch(n){let s='cannot decode message google.protobuf.BytesValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new xe().fromBinary(e,t)}static fromJson(e,t){return new xe().fromJson(e,t)}static fromJsonString(e,t){return new xe().fromJsonString(e,t)}static equals(e,t){return u.util.equals(xe,e,t)}}xe.runtime=u,xe.typeName="google.protobuf.BytesValue",xe.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:12}]),xe.fieldWrapper={wrapField(r){return new xe({value:r})},unwrapField(r){return r.value}};function Lc(r,e,t){try{const n=Us.dec(r);return e?e.fromBinary(n,t):n}catch(n){throw J.from(n,D.DataLoss)}}function qc(r,e){const t={};for(const[n,s]of Object.entries(r.methods)){const i=e(Object.assign(Object.assign({},s),{localName:n,service:r}));i!=null&&(t[n]=i)}return t}const so=1;function io(r){let e,t=new Uint8Array(0);function n(s){const i=new Uint8Array(t.length+s.length);i.set(t),i.set(s,t.length),t=i}return new ReadableStream({start(){e=r.getReader()},async pull(s){let i;for(;;){if(i===void 0&&t.byteLength>=5){let h=0;for(let l=1;l<5;l++)h=(h<<8)+t[l];i={flags:t[0],length:h}}if(i!==void 0&&t.byteLength>=i.length+5)break;const c=await e.read();if(c.done)break;n(c.value)}if(i===void 0){if(t.byteLength==0){s.close();return}s.error(new J("premature end of stream",D.DataLoss));return}const a=t.subarray(5,5+i.length);t=t.subarray(5+i.length),s.enqueue({flags:i.flags,data:a})}})}function oo(r,e){const t=new Uint8Array(e.length+5);t.set(e,5);const n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.setUint8(0,r),n.setUint32(1,e.length),t}var $c=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=r[i]&&function(a){return new Promise(function(c,h){a=r[i](a),s(c,h,a.done,a.value)})}}function s(i,a,c,h){Promise.resolve(h).then(function(l){i({value:l,done:c})},a)}},Mt=function(r){return this instanceof Mt?(this.v=r,this):new Mt(r)},Uc=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,i=[];return s={},c("next"),c("throw"),c("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(y){return function(S){return Promise.resolve(S).then(y,m)}}function c(y,S){n[y]&&(s[y]=function(I){return new Promise(function(A,B){i.push([y,I,A,B])>1||h(y,I)})},S&&(s[y]=S(s[y])))}function h(y,S){try{l(n[y](S))}catch(I){v(i[0][3],I)}}function l(y){y.value instanceof Mt?Promise.resolve(y.value.v).then(f,m):v(i[0][2],y)}function f(y){h("next",y)}function m(y){h("throw",y)}function v(y,S){y(S),i.shift(),i.length&&h(i[0][0],i[0][1])}},Fc=function(r){var e,t;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=r[s]?function(a){return(t=!t)?{value:Mt(r[s](a)),done:!1}:i?i(a):a}:i}};function Mc(r){return Uc(this,arguments,function*(){yield Mt(yield*Fc($c(r)))})}var ao=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=r[i]&&function(a){return new Promise(function(c,h){a=r[i](a),s(c,h,a.done,a.value)})}}function s(i,a,c,h){Promise.resolve(h).then(function(l){i({value:l,done:c})},a)}},kt=function(r){return this instanceof kt?(this.v=r,this):new kt(r)},zc=function(r){var e,t;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=r[s]?function(a){return(t=!t)?{value:kt(r[s](a)),done:!1}:i?i(a):a}:i}},_c=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,i=[];return s={},c("next"),c("throw"),c("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(y){return function(S){return Promise.resolve(S).then(y,m)}}function c(y,S){n[y]&&(s[y]=function(I){return new Promise(function(A,B){i.push([y,I,A,B])>1||h(y,I)})},S&&(s[y]=S(s[y])))}function h(y,S){try{l(n[y](S))}catch(I){v(i[0][3],I)}}function l(y){y.value instanceof kt?Promise.resolve(y.value.v).then(f,m):v(i[0][2],y)}function f(y){h("next",y)}function m(y){h("throw",y)}function v(y,S){y(S),i.shift(),i.length&&h(i[0][0],i[0][1])}};function Vc(r,e){return qc(r,t=>{switch(t.kind){case Q.Unary:return Kc(e,r,t);case Q.ServerStreaming:return jc(e,r,t);case Q.ClientStreaming:return Wc(e,r,t);case Q.BiDiStreaming:return Gc(e,r,t);default:return null}})}function Kc(r,e,t){return async function(n,s){var i,a;const c=await r.unary(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,n,s==null?void 0:s.contextValues);return(i=s==null?void 0:s.onHeader)===null||i===void 0||i.call(s,c.header),(a=s==null?void 0:s.onTrailer)===null||a===void 0||a.call(s,c.trailer),c.message}}function jc(r,e,t){return function(n,s){return co(r.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,Mc([n]),s==null?void 0:s.contextValues),s)}}function Wc(r,e,t){return async function(n,s){var i,a,c,h,l,f;const m=await r.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,n,s==null?void 0:s.contextValues);(l=s==null?void 0:s.onHeader)===null||l===void 0||l.call(s,m.header);let v,y=0;try{for(var S=!0,I=ao(m.message),A;A=await I.next(),i=A.done,!i;S=!0)h=A.value,S=!1,v=h,y++}catch(B){a={error:B}}finally{try{!S&&!i&&(c=I.return)&&await c.call(I)}finally{if(a)throw a.error}}if(!v)throw new J("protocol error: missing response message",D.Unimplemented);if(y>1)throw new J("protocol error: received extra messages for client streaming method",D.Unimplemented);return(f=s==null?void 0:s.onTrailer)===null||f===void 0||f.call(s,m.trailer),v}}function Gc(r,e,t){return function(n,s){return co(r.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,n,s==null?void 0:s.contextValues),s)}}function co(r,e){const t=function(){return _c(this,arguments,function*(){var n,s;const i=yield kt(r);(n=e==null?void 0:e.onHeader)===null||n===void 0||n.call(e,i.header),yield kt(yield*zc(ao(i.message))),(s=e==null?void 0:e.onTrailer)===null||s===void 0||s.call(e,i.trailer)})}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>t.next()})}}function Hc(...r){const e=new AbortController,t=r.filter(s=>s!==void 0).concat(e.signal);for(const s of t){if(s.aborted){n.apply(s);break}s.addEventListener("abort",n)}function n(){e.signal.aborted||e.abort(uo(this));for(const s of t)s.removeEventListener("abort",n)}return e}function Yc(r){const e=new AbortController,t=()=>{e.abort(new J("the operation timed out",D.DeadlineExceeded))};let n;return r!==void 0&&(r<=0?t():n=setTimeout(t,r)),{signal:e.signal,cleanup:()=>clearTimeout(n)}}function uo(r){if(!r.aborted)return;if(r.reason!==void 0)return r.reason;const e=new Error("This operation was aborted");return e.name="AbortError",e}function ho(){return{get(r){return r.id in this?this[r.id]:r.defaultValue},set(r,e){return this[r.id]=e,this},delete(r){return delete this[r.id],this}}}const zs=128;function lo(r){const e=new Headers,t=new TextDecoder().decode(r).split(`\r
`);for(const n of t){if(n==="")continue;const s=n.indexOf(":");if(s>0){const i=n.substring(0,s).trim(),a=n.substring(s+1).trim();e.append(i,a)}}return e}const Xc="Content-Type",Zc="Grpc-Timeout",Nt="Grpc-Status",fo="Grpc-Message",Qc="Grpc-Status-Details-Bin",eu="X-User-Agent",tu="X-Grpc-Web",ru="application/grpc-web+proto",nu="application/grpc-web+json";class We extends T{constructor(e){super(),this.code=0,this.message="",this.details=[],u.util.initPartial(e,this)}static fromBinary(e,t){return new We().fromBinary(e,t)}static fromJson(e,t){return new We().fromJson(e,t)}static fromJsonString(e,t){return new We().fromJsonString(e,t)}static equals(e,t){return u.util.equals(We,e,t)}}We.runtime=u,We.typeName="google.rpc.Status",We.fields=u.util.newFieldList(()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:be,repeated:!0}]);const su="0";function go(r){var e;const t=r.get(Qc);if(t!=null){const s=Lc(t,We);if(s.code==0)return;const i=new J(s.message,s.code,r);return i.details=s.details.map(a=>({type:a.typeUrl.substring(a.typeUrl.lastIndexOf("/")+1),value:a.value})),i}const n=r.get(Nt);if(n!=null){if(n===su)return;const s=parseInt(n,10);return s in D?new J(decodeURIComponent((e=r.get(fo))!==null&&e!==void 0?e:""),s,r):new J(`invalid grpc-status: ${n}`,D.Internal,r)}}function mo(r,e,t){const n=typeof e=="string"?e:e.typeName,s=typeof t=="string"?t:t.name;return r.toString().replace(/\/?$/,`/${n}/${s}`)}function po(r,e){return e instanceof r?e:new r(e)}function iu(r,e){function t(n){return n.done===!0?n:{done:n.done,value:po(r,n.value)}}return{[Symbol.asyncIterator](){const n=e[Symbol.asyncIterator](),s={next:()=>n.next().then(t)};return n.throw!==void 0&&(s.throw=i=>n.throw(i).then(t)),n.return!==void 0&&(s.return=i=>n.return(i).then(t)),s}}}function yo(r,e){var t;return(t=e==null?void 0:e.concat().reverse().reduce((n,s)=>s(n),r))!==null&&t!==void 0?t:r}function ou(r){var e;const t=Object.assign({},r);return(e=t.ignoreUnknownFields)!==null&&e!==void 0||(t.ignoreUnknownFields=!0),t}function vo(r,e,t,n){const s=e?wo(r.I,n):To(r.I,t);return{parse:(e?wo(r.O,n):To(r.O,t)).parse,serialize:s.serialize}}function wo(r,e){return{parse(t){try{return r.fromBinary(t,e)}catch(n){const s=n instanceof Error?n.message:String(n);throw new J(`parse binary: ${s}`,D.Internal)}},serialize(t){try{return t.toBinary(e)}catch(n){const s=n instanceof Error?n.message:String(n);throw new J(`serialize binary: ${s}`,D.Internal)}}}}function To(r,e){var t,n;const s=(t=e==null?void 0:e.textEncoder)!==null&&t!==void 0?t:new TextEncoder,i=(n=e==null?void 0:e.textDecoder)!==null&&n!==void 0?n:new TextDecoder,a=ou(e);return{parse(c){try{const h=i.decode(c);return r.fromJsonString(h,a)}catch(h){throw J.from(h,D.InvalidArgument)}},serialize(c){try{const h=c.toJsonString(a);return s.encode(h)}catch(h){throw J.from(h,D.Internal)}}}}function au(r){const e=yo(r.next,r.interceptors),[t,n,s]=So(r),i=Object.assign(Object.assign({},r.req),{message:po(r.req.method.I,r.req.message),signal:t});return e(i).then(a=>(s(),a),n)}function cu(r){const e=yo(r.next,r.interceptors),[t,n,s]=So(r),i=Object.assign(Object.assign({},r.req),{message:iu(r.req.method.I,r.req.message),signal:t});let a=!1;return t.addEventListener("abort",function(){var c,h;const l=r.req.message[Symbol.asyncIterator]();a||(c=l.throw)===null||c===void 0||c.call(l,this.reason).catch(()=>{}),(h=l.return)===null||h===void 0||h.call(l).catch(()=>{})}),e(i).then(c=>Object.assign(Object.assign({},c),{message:{[Symbol.asyncIterator](){const h=c.message[Symbol.asyncIterator]();return{next(){return h.next().then(l=>(l.done==!0&&(a=!0,s()),l),n)}}}}}),n)}function So(r){const{signal:e,cleanup:t}=Yc(r.timeoutMs),n=Hc(r.signal,e);return[n.signal,function(i){const a=J.from(e.aborted?uo(e):i);return n.abort(a),t(),Promise.reject(a)},function(){t(),n.abort()}]}function uu(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}function bo(r,e){const t=go(r);if(t)throw e.forEach((n,s)=>{t.metadata.append(s,n)}),t;if(!e.has(Nt)&&!r.has(Nt))throw new J("protocol error: missing status",D.Internal)}function Io(r,e,t,n){const s=new Headers(t??{});return s.set(Xc,r?ru:nu),s.set(tu,"1"),s.set(eu,"connect-es/1.6.1"),e!==void 0&&s.set(Zc,`${e}m`),s}function hu(r){switch(r){case 400:return D.Internal;case 401:return D.Unauthenticated;case 403:return D.PermissionDenied;case 404:return D.Unimplemented;case 429:return D.Unavailable;case 502:return D.Unavailable;case 503:return D.Unavailable;case 504:return D.Unavailable;default:return D.Unknown}}function Ao(r,e){var t;if(r>=200&&r<300)return{foundStatus:e.has(Nt),headerError:go(e)};throw new J(decodeURIComponent((t=e.get(fo))!==null&&t!==void 0?t:`HTTP ${r}`),hu(r),e)}var ht=function(r){return this instanceof ht?(this.v=r,this):new ht(r)},lu=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,i=[];return s={},c("next"),c("throw"),c("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(y){return function(S){return Promise.resolve(S).then(y,m)}}function c(y,S){n[y]&&(s[y]=function(I){return new Promise(function(A,B){i.push([y,I,A,B])>1||h(y,I)})},S&&(s[y]=S(s[y])))}function h(y,S){try{l(n[y](S))}catch(I){v(i[0][3],I)}}function l(y){y.value instanceof ht?Promise.resolve(y.value.v).then(f,m):v(i[0][2],y)}function f(y){h("next",y)}function m(y){h("throw",y)}function v(y,S){y(S),i.shift(),i.length&&h(i[0][0],i[0][1])}};function fu(r){var e;uu();const t=(e=r.useBinaryFormat)!==null&&e!==void 0?e:!0;return{async unary(n,s,i,a,c,h,l){var f;const{serialize:m,parse:v}=vo(s,t,r.jsonOptions,r.binaryOptions);return a=a===void 0?r.defaultTimeoutMs:a<=0?void 0:a,await au({interceptors:r.interceptors,signal:i,timeoutMs:a,req:{stream:!1,service:n,method:s,url:mo(r.baseUrl,n,s),init:{method:"POST",credentials:(f=r.credentials)!==null&&f!==void 0?f:"same-origin",redirect:"error",mode:"cors"},header:Io(t,a,c),contextValues:l??ho(),message:h},next:async y=>{var S;const A=await((S=r.fetch)!==null&&S!==void 0?S:globalThis.fetch)(y.url,Object.assign(Object.assign({},y.init),{headers:y.header,signal:y.signal,body:oo(0,m(y.message))})),{headerError:B}=Ao(A.status,A.headers);if(!A.body)throw B!==void 0?B:"missing response body";const C=io(A.body).getReader();let R,$;for(;;){const G=await C.read();if(G.done)break;const{flags:Te,data:St}=G.value;if((Te&so)===so)throw new J("protocol error: received unsupported compressed output",D.Internal);if(Te===zs){if(R!==void 0)throw"extra trailer";R=lo(St);continue}if($!==void 0)throw new J("extra message",D.Unimplemented);$=v(St)}if(R===void 0)throw B!==void 0?B:new J("missing trailer",A.headers.has(Nt)?D.Unimplemented:D.Unknown);if(bo(R,A.headers),$===void 0)throw new J("missing message",R.has(Nt)?D.Unimplemented:D.Unknown);return{stream:!1,service:n,method:s,header:A.headers,message:$,trailer:R}}})},async stream(n,s,i,a,c,h,l){var f;const{serialize:m,parse:v}=vo(s,t,r.jsonOptions,r.binaryOptions);function y(I,A,B,C,R){return lu(this,arguments,function*(){const G=io(I).getReader();if(A){if(!(yield ht(G.read())).done)throw"extra data for trailers-only";return yield ht(void 0)}let Te=!1;for(;;){const St=yield ht(G.read());if(St.done)break;const{flags:sl,data:Ma}=St.value;if((sl&zs)===zs){if(Te)throw"extra trailer";Te=!0;const za=lo(Ma);bo(za,C),za.forEach((il,ol)=>B.set(ol,il));continue}if(Te)throw"extra message";yield yield ht(v(Ma))}if("throwIfAborted"in R&&R.throwIfAborted(),!Te)throw"missing trailer"})}async function S(I){if(s.kind!=Q.ServerStreaming)throw"The fetch API does not support streaming request bodies";const A=await I[Symbol.asyncIterator]().next();if(A.done==!0)throw"missing request message";return oo(0,m(A.value))}return a=a===void 0?r.defaultTimeoutMs:a<=0?void 0:a,cu({interceptors:r.interceptors,signal:i,timeoutMs:a,req:{stream:!0,service:n,method:s,url:mo(r.baseUrl,n,s),init:{method:"POST",credentials:(f=r.credentials)!==null&&f!==void 0?f:"same-origin",redirect:"error",mode:"cors"},header:Io(t,a,c),contextValues:l??ho(),message:h},next:async I=>{var A;const C=await((A=r.fetch)!==null&&A!==void 0?A:globalThis.fetch)(I.url,Object.assign(Object.assign({},I.init),{headers:I.header,signal:I.signal,body:await S(I.message)})),{foundStatus:R,headerError:$}=Ao(C.status,C.headers);if($!=null)throw $;if(!C.body)throw"missing response body";const G=new Headers;return Object.assign(Object.assign({},I),{header:C.headers,trailer:G,message:y(C.body,R,G,C.headers,I.signal)})}})}}}var P=(r=>(r[r.NULL=0]="NULL",r[r.BOOLEAN=1]="BOOLEAN",r[r.INTEGER=2]="INTEGER",r[r.LONG=3]="LONG",r[r.DOUBLE=4]="DOUBLE",r[r.STRING=5]="STRING",r[r.BYTES=6]="BYTES",r[r.DATE=7]="DATE",r[r.JSON_OBJECT=8]="JSON_OBJECT",r[r.JSON_ARRAY=9]="JSON_ARRAY",r[r.TEXT=10]="TEXT",r[r.INTEGER_CNT=11]="INTEGER_CNT",r[r.LONG_CNT=12]="LONG_CNT",r[r.TREE=13]="TREE",r))(P||{});u.util.setEnumType(P,"yorkie.v1.ValueType",[{no:0,name:"VALUE_TYPE_NULL"},{no:1,name:"VALUE_TYPE_BOOLEAN"},{no:2,name:"VALUE_TYPE_INTEGER"},{no:3,name:"VALUE_TYPE_LONG"},{no:4,name:"VALUE_TYPE_DOUBLE"},{no:5,name:"VALUE_TYPE_STRING"},{no:6,name:"VALUE_TYPE_BYTES"},{no:7,name:"VALUE_TYPE_DATE"},{no:8,name:"VALUE_TYPE_JSON_OBJECT"},{no:9,name:"VALUE_TYPE_JSON_ARRAY"},{no:10,name:"VALUE_TYPE_TEXT"},{no:11,name:"VALUE_TYPE_INTEGER_CNT"},{no:12,name:"VALUE_TYPE_LONG_CNT"},{no:13,name:"VALUE_TYPE_TREE"}]);var lt=(r=>(r[r.DOCUMENT_CHANGED=0]="DOCUMENT_CHANGED",r[r.DOCUMENT_WATCHED=1]="DOCUMENT_WATCHED",r[r.DOCUMENT_UNWATCHED=2]="DOCUMENT_UNWATCHED",r[r.DOCUMENT_BROADCAST=3]="DOCUMENT_BROADCAST",r))(lt||{});u.util.setEnumType(lt,"yorkie.v1.DocEventType",[{no:0,name:"DOC_EVENT_TYPE_DOCUMENT_CHANGED"},{no:1,name:"DOC_EVENT_TYPE_DOCUMENT_WATCHED"},{no:2,name:"DOC_EVENT_TYPE_DOCUMENT_UNWATCHED"},{no:3,name:"DOC_EVENT_TYPE_DOCUMENT_BROADCAST"}]);const bn=class fr extends T{constructor(e){super(),o(this,"root"),o(this,"presences",{}),u.util.initPartial(e,this)}static fromBinary(e,t){return new fr().fromBinary(e,t)}static fromJson(e,t){return new fr().fromJson(e,t)}static fromJsonString(e,t){return new fr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(fr,e,t)}};o(bn,"runtime",u),o(bn,"typeName","yorkie.v1.Snapshot"),o(bn,"fields",u.util.newFieldList(()=>[{no:1,name:"root",kind:"message",T:ae},{no:2,name:"presences",kind:"map",K:9,V:{kind:"message",T:Xs}}]));let du=bn,Ge=(Le=class extends T{constructor(r){super(),o(this,"documentKey",""),o(this,"checkpoint"),o(this,"snapshot",new Uint8Array(0)),o(this,"changes",[]),o(this,"minSyncedTicket"),o(this,"isRemoved",!1),o(this,"versionVector"),u.util.initPartial(r,this)}static fromBinary(r,e){return new Le().fromBinary(r,e)}static fromJson(r,e){return new Le().fromJson(r,e)}static fromJsonString(r,e){return new Le().fromJsonString(r,e)}static equals(r,e){return u.util.equals(Le,r,e)}},o(Le,"runtime",u),o(Le,"typeName","yorkie.v1.ChangePack"),o(Le,"fields",u.util.newFieldList(()=>[{no:1,name:"document_key",kind:"scalar",T:9},{no:2,name:"checkpoint",kind:"message",T:Ko},{no:3,name:"snapshot",kind:"scalar",T:12},{no:4,name:"changes",kind:"message",T:ko,repeated:!0},{no:5,name:"min_synced_ticket",kind:"message",T:b},{no:6,name:"is_removed",kind:"scalar",T:8},{no:7,name:"version_vector",kind:"message",T:An}])),Le),ko=(qe=class extends T{constructor(r){super(),o(this,"id"),o(this,"message",""),o(this,"operations",[]),o(this,"presenceChange"),u.util.initPartial(r,this)}static fromBinary(r,e){return new qe().fromBinary(r,e)}static fromJson(r,e){return new qe().fromJson(r,e)}static fromJsonString(r,e){return new qe().fromJsonString(r,e)}static equals(r,e){return u.util.equals(qe,r,e)}},o(qe,"runtime",u),o(qe,"typeName","yorkie.v1.Change"),o(qe,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:In},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"operations",kind:"message",T:_s,repeated:!0},{no:4,name:"presence_change",kind:"message",T:Ys}])),qe),In=($e=class extends T{constructor(r){super(),o(this,"clientSeq",0),o(this,"serverSeq",U.zero),o(this,"lamport",U.zero),o(this,"actorId",new Uint8Array(0)),o(this,"versionVector"),u.util.initPartial(r,this)}static fromBinary(r,e){return new $e().fromBinary(r,e)}static fromJson(r,e){return new $e().fromJson(r,e)}static fromJsonString(r,e){return new $e().fromJsonString(r,e)}static equals(r,e){return u.util.equals($e,r,e)}},o($e,"runtime",u),o($e,"typeName","yorkie.v1.ChangeID"),o($e,"fields",u.util.newFieldList(()=>[{no:1,name:"client_seq",kind:"scalar",T:13},{no:2,name:"server_seq",kind:"scalar",T:3},{no:3,name:"lamport",kind:"scalar",T:3},{no:4,name:"actor_id",kind:"scalar",T:12},{no:5,name:"version_vector",kind:"message",T:An}])),$e),An=(Ue=class extends T{constructor(r){super(),o(this,"vector",{}),u.util.initPartial(r,this)}static fromBinary(r,e){return new Ue().fromBinary(r,e)}static fromJson(r,e){return new Ue().fromJson(r,e)}static fromJsonString(r,e){return new Ue().fromJsonString(r,e)}static equals(r,e){return u.util.equals(Ue,r,e)}},o(Ue,"runtime",u),o(Ue,"typeName","yorkie.v1.VersionVector"),o(Ue,"fields",u.util.newFieldList(()=>[{no:1,name:"vector",kind:"map",K:9,V:{kind:"scalar",T:3}}])),Ue),_s=(Fe=class extends T{constructor(r){super(),o(this,"body",{case:void 0}),u.util.initPartial(r,this)}static fromBinary(r,e){return new Fe().fromBinary(r,e)}static fromJson(r,e){return new Fe().fromJson(r,e)}static fromJsonString(r,e){return new Fe().fromJsonString(r,e)}static equals(r,e){return u.util.equals(Fe,r,e)}},o(Fe,"runtime",u),o(Fe,"typeName","yorkie.v1.Operation"),o(Fe,"fields",u.util.newFieldList(()=>[{no:1,name:"set",kind:"message",T:No,oneof:"body"},{no:2,name:"add",kind:"message",T:Eo,oneof:"body"},{no:3,name:"move",kind:"message",T:Po,oneof:"body"},{no:4,name:"remove",kind:"message",T:Do,oneof:"body"},{no:5,name:"edit",kind:"message",T:xo,oneof:"body"},{no:6,name:"select",kind:"message",T:gu,oneof:"body"},{no:7,name:"style",kind:"message",T:Co,oneof:"body"},{no:8,name:"increase",kind:"message",T:Oo,oneof:"body"},{no:9,name:"tree_edit",kind:"message",T:Ro,oneof:"body"},{no:10,name:"tree_style",kind:"message",T:Bo,oneof:"body"},{no:11,name:"array_set",kind:"message",T:mu,oneof:"body"}])),Fe);const kn=class dr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"key",""),o(this,"value"),o(this,"executedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new dr().fromBinary(e,t)}static fromJson(e,t){return new dr().fromJson(e,t)}static fromJsonString(e,t){return new dr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(dr,e,t)}};o(kn,"runtime",u),o(kn,"typeName","yorkie.v1.Operation.Set"),o(kn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"value",kind:"message",T:Ce},{no:4,name:"executed_at",kind:"message",T:b}]));let No=kn;const Nn=class gr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"prevCreatedAt"),o(this,"value"),o(this,"executedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new gr().fromBinary(e,t)}static fromJson(e,t){return new gr().fromJson(e,t)}static fromJsonString(e,t){return new gr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(gr,e,t)}};o(Nn,"runtime",u),o(Nn,"typeName","yorkie.v1.Operation.Add"),o(Nn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"prev_created_at",kind:"message",T:b},{no:3,name:"value",kind:"message",T:Ce},{no:4,name:"executed_at",kind:"message",T:b}]));let Eo=Nn;const En=class mr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"prevCreatedAt"),o(this,"createdAt"),o(this,"executedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new mr().fromBinary(e,t)}static fromJson(e,t){return new mr().fromJson(e,t)}static fromJsonString(e,t){return new mr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(mr,e,t)}};o(En,"runtime",u),o(En,"typeName","yorkie.v1.Operation.Move"),o(En,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"prev_created_at",kind:"message",T:b},{no:3,name:"created_at",kind:"message",T:b},{no:4,name:"executed_at",kind:"message",T:b}]));let Po=En;const Pn=class pr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"createdAt"),o(this,"executedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new pr().fromBinary(e,t)}static fromJson(e,t){return new pr().fromJson(e,t)}static fromJsonString(e,t){return new pr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(pr,e,t)}};o(Pn,"runtime",u),o(Pn,"typeName","yorkie.v1.Operation.Remove"),o(Pn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"created_at",kind:"message",T:b},{no:3,name:"executed_at",kind:"message",T:b}]));let Do=Pn;const Dn=class yr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"from"),o(this,"to"),o(this,"createdAtMapByActor",{}),o(this,"content",""),o(this,"executedAt"),o(this,"attributes",{}),u.util.initPartial(e,this)}static fromBinary(e,t){return new yr().fromBinary(e,t)}static fromJson(e,t){return new yr().fromJson(e,t)}static fromJsonString(e,t){return new yr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(yr,e,t)}};o(Dn,"runtime",u),o(Dn,"typeName","yorkie.v1.Operation.Edit"),o(Dn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"from",kind:"message",T:dt},{no:3,name:"to",kind:"message",T:dt},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:b}},{no:5,name:"content",kind:"scalar",T:9},{no:6,name:"executed_at",kind:"message",T:b},{no:7,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]));let xo=Dn;const xn=class vr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"from"),o(this,"to"),o(this,"executedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new vr().fromBinary(e,t)}static fromJson(e,t){return new vr().fromJson(e,t)}static fromJsonString(e,t){return new vr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(vr,e,t)}};o(xn,"runtime",u),o(xn,"typeName","yorkie.v1.Operation.Select"),o(xn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"from",kind:"message",T:dt},{no:3,name:"to",kind:"message",T:dt},{no:4,name:"executed_at",kind:"message",T:b}]));let gu=xn;const Cn=class wr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"from"),o(this,"to"),o(this,"attributes",{}),o(this,"executedAt"),o(this,"createdAtMapByActor",{}),u.util.initPartial(e,this)}static fromBinary(e,t){return new wr().fromBinary(e,t)}static fromJson(e,t){return new wr().fromJson(e,t)}static fromJsonString(e,t){return new wr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(wr,e,t)}};o(Cn,"runtime",u),o(Cn,"typeName","yorkie.v1.Operation.Style"),o(Cn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"from",kind:"message",T:dt},{no:3,name:"to",kind:"message",T:dt},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:b},{no:6,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:b}}]));let Co=Cn;const On=class Tr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"value"),o(this,"executedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Tr().fromBinary(e,t)}static fromJson(e,t){return new Tr().fromJson(e,t)}static fromJsonString(e,t){return new Tr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Tr,e,t)}};o(On,"runtime",u),o(On,"typeName","yorkie.v1.Operation.Increase"),o(On,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"value",kind:"message",T:Ce},{no:3,name:"executed_at",kind:"message",T:b}]));let Oo=On;const Rn=class Sr extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"from"),o(this,"to"),o(this,"createdAtMapByActor",{}),o(this,"contents",[]),o(this,"splitLevel",0),o(this,"executedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Sr().fromBinary(e,t)}static fromJson(e,t){return new Sr().fromJson(e,t)}static fromJsonString(e,t){return new Sr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Sr,e,t)}};o(Rn,"runtime",u),o(Rn,"typeName","yorkie.v1.Operation.TreeEdit"),o(Rn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"from",kind:"message",T:_t},{no:3,name:"to",kind:"message",T:_t},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:b}},{no:5,name:"contents",kind:"message",T:Vo,repeated:!0},{no:7,name:"split_level",kind:"scalar",T:5},{no:6,name:"executed_at",kind:"message",T:b}]));let Ro=Rn;const Bn=class br extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"from"),o(this,"to"),o(this,"attributes",{}),o(this,"executedAt"),o(this,"attributesToRemove",[]),o(this,"createdAtMapByActor",{}),u.util.initPartial(e,this)}static fromBinary(e,t){return new br().fromBinary(e,t)}static fromJson(e,t){return new br().fromJson(e,t)}static fromJsonString(e,t){return new br().fromJsonString(e,t)}static equals(e,t){return u.util.equals(br,e,t)}};o(Bn,"runtime",u),o(Bn,"typeName","yorkie.v1.Operation.TreeStyle"),o(Bn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"from",kind:"message",T:_t},{no:3,name:"to",kind:"message",T:_t},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:b},{no:6,name:"attributes_to_remove",kind:"scalar",T:9,repeated:!0},{no:7,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:b}}]));let Bo=Bn;const Jn=class Ir extends T{constructor(e){super(),o(this,"parentCreatedAt"),o(this,"createdAt"),o(this,"value"),o(this,"executedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Ir().fromBinary(e,t)}static fromJson(e,t){return new Ir().fromJson(e,t)}static fromJsonString(e,t){return new Ir().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Ir,e,t)}};o(Jn,"runtime",u),o(Jn,"typeName","yorkie.v1.Operation.ArraySet"),o(Jn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:b},{no:2,name:"created_at",kind:"message",T:b},{no:3,name:"value",kind:"message",T:Ce},{no:4,name:"executed_at",kind:"message",T:b}]));let mu=Jn;const Ln=class Ar extends T{constructor(e){super(),o(this,"createdAt"),o(this,"movedAt"),o(this,"removedAt"),o(this,"type",0),o(this,"value",new Uint8Array(0)),u.util.initPartial(e,this)}static fromBinary(e,t){return new Ar().fromBinary(e,t)}static fromJson(e,t){return new Ar().fromJson(e,t)}static fromJsonString(e,t){return new Ar().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Ar,e,t)}};o(Ln,"runtime",u),o(Ln,"typeName","yorkie.v1.JSONElementSimple"),o(Ln,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:b},{no:2,name:"moved_at",kind:"message",T:b},{no:3,name:"removed_at",kind:"message",T:b},{no:4,name:"type",kind:"enum",T:u.getEnumType(P)},{no:5,name:"value",kind:"scalar",T:12}]));let Ce=Ln;const qn=class kr extends T{constructor(e){super(),o(this,"body",{case:void 0}),u.util.initPartial(e,this)}static fromBinary(e,t){return new kr().fromBinary(e,t)}static fromJson(e,t){return new kr().fromJson(e,t)}static fromJsonString(e,t){return new kr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(kr,e,t)}};o(qn,"runtime",u),o(qn,"typeName","yorkie.v1.JSONElement"),o(qn,"fields",u.util.newFieldList(()=>[{no:1,name:"json_object",kind:"message",T:Jo,oneof:"body"},{no:2,name:"json_array",kind:"message",T:Lo,oneof:"body"},{no:3,name:"primitive",kind:"message",T:qo,oneof:"body"},{no:5,name:"text",kind:"message",T:$o,oneof:"body"},{no:6,name:"counter",kind:"message",T:Uo,oneof:"body"},{no:7,name:"tree",kind:"message",T:Fo,oneof:"body"}]));let ae=qn;const $n=class Nr extends T{constructor(e){super(),o(this,"nodes",[]),o(this,"createdAt"),o(this,"movedAt"),o(this,"removedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Nr().fromBinary(e,t)}static fromJson(e,t){return new Nr().fromJson(e,t)}static fromJsonString(e,t){return new Nr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Nr,e,t)}};o($n,"runtime",u),o($n,"typeName","yorkie.v1.JSONElement.JSONObject"),o($n,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:Mo,repeated:!0},{no:2,name:"created_at",kind:"message",T:b},{no:3,name:"moved_at",kind:"message",T:b},{no:4,name:"removed_at",kind:"message",T:b}]));let Jo=$n;const Un=class Er extends T{constructor(e){super(),o(this,"nodes",[]),o(this,"createdAt"),o(this,"movedAt"),o(this,"removedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Er().fromBinary(e,t)}static fromJson(e,t){return new Er().fromJson(e,t)}static fromJsonString(e,t){return new Er().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Er,e,t)}};o(Un,"runtime",u),o(Un,"typeName","yorkie.v1.JSONElement.JSONArray"),o(Un,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:zo,repeated:!0},{no:2,name:"created_at",kind:"message",T:b},{no:3,name:"moved_at",kind:"message",T:b},{no:4,name:"removed_at",kind:"message",T:b}]));let Lo=Un;const Fn=class Pr extends T{constructor(e){super(),o(this,"type",0),o(this,"value",new Uint8Array(0)),o(this,"createdAt"),o(this,"movedAt"),o(this,"removedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Pr().fromBinary(e,t)}static fromJson(e,t){return new Pr().fromJson(e,t)}static fromJsonString(e,t){return new Pr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Pr,e,t)}};o(Fn,"runtime",u),o(Fn,"typeName","yorkie.v1.JSONElement.Primitive"),o(Fn,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(P)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:b},{no:4,name:"moved_at",kind:"message",T:b},{no:5,name:"removed_at",kind:"message",T:b}]));let qo=Fn;const Mn=class Dr extends T{constructor(e){super(),o(this,"nodes",[]),o(this,"createdAt"),o(this,"movedAt"),o(this,"removedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Dr().fromBinary(e,t)}static fromJson(e,t){return new Dr().fromJson(e,t)}static fromJsonString(e,t){return new Dr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Dr,e,t)}};o(Mn,"runtime",u),o(Mn,"typeName","yorkie.v1.JSONElement.Text"),o(Mn,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:_o,repeated:!0},{no:2,name:"created_at",kind:"message",T:b},{no:3,name:"moved_at",kind:"message",T:b},{no:4,name:"removed_at",kind:"message",T:b}]));let $o=Mn;const zn=class xr extends T{constructor(e){super(),o(this,"type",0),o(this,"value",new Uint8Array(0)),o(this,"createdAt"),o(this,"movedAt"),o(this,"removedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new xr().fromBinary(e,t)}static fromJson(e,t){return new xr().fromJson(e,t)}static fromJsonString(e,t){return new xr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(xr,e,t)}};o(zn,"runtime",u),o(zn,"typeName","yorkie.v1.JSONElement.Counter"),o(zn,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(P)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:b},{no:4,name:"moved_at",kind:"message",T:b},{no:5,name:"removed_at",kind:"message",T:b}]));let Uo=zn;const _n=class Cr extends T{constructor(e){super(),o(this,"nodes",[]),o(this,"createdAt"),o(this,"movedAt"),o(this,"removedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Cr().fromBinary(e,t)}static fromJson(e,t){return new Cr().fromJson(e,t)}static fromJsonString(e,t){return new Cr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Cr,e,t)}};o(_n,"runtime",u),o(_n,"typeName","yorkie.v1.JSONElement.Tree"),o(_n,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:Ks,repeated:!0},{no:2,name:"created_at",kind:"message",T:b},{no:3,name:"moved_at",kind:"message",T:b},{no:4,name:"removed_at",kind:"message",T:b}]));let Fo=_n,Mo=(Me=class extends T{constructor(r){super(),o(this,"key",""),o(this,"element"),u.util.initPartial(r,this)}static fromBinary(r,e){return new Me().fromBinary(r,e)}static fromJson(r,e){return new Me().fromJson(r,e)}static fromJsonString(r,e){return new Me().fromJsonString(r,e)}static equals(r,e){return u.util.equals(Me,r,e)}},o(Me,"runtime",u),o(Me,"typeName","yorkie.v1.RHTNode"),o(Me,"fields",u.util.newFieldList(()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"element",kind:"message",T:ae}])),Me);const zt=class Or extends T{constructor(e){super(),o(this,"next"),o(this,"element"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Or().fromBinary(e,t)}static fromJson(e,t){return new Or().fromJson(e,t)}static fromJsonString(e,t){return new Or().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Or,e,t)}};o(zt,"runtime",u),o(zt,"typeName","yorkie.v1.RGANode"),o(zt,"fields",u.util.newFieldList(()=>[{no:1,name:"next",kind:"message",T:zt},{no:2,name:"element",kind:"message",T:ae}]));let zo=zt;const Vn=class Rr extends T{constructor(e){super(),o(this,"value",""),o(this,"updatedAt"),o(this,"isRemoved",!1),u.util.initPartial(e,this)}static fromBinary(e,t){return new Rr().fromBinary(e,t)}static fromJson(e,t){return new Rr().fromJson(e,t)}static fromJsonString(e,t){return new Rr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Rr,e,t)}};o(Vn,"runtime",u),o(Vn,"typeName","yorkie.v1.NodeAttr"),o(Vn,"fields",u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9},{no:2,name:"updated_at",kind:"message",T:b},{no:3,name:"is_removed",kind:"scalar",T:8}]));let Kn=Vn;const jn=class Br extends T{constructor(e){super(),o(this,"id"),o(this,"value",""),o(this,"removedAt"),o(this,"insPrevId"),o(this,"attributes",{}),u.util.initPartial(e,this)}static fromBinary(e,t){return new Br().fromBinary(e,t)}static fromJson(e,t){return new Br().fromJson(e,t)}static fromJsonString(e,t){return new Br().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Br,e,t)}};o(jn,"runtime",u),o(jn,"typeName","yorkie.v1.TextNode"),o(jn,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:Vs},{no:2,name:"value",kind:"scalar",T:9},{no:3,name:"removed_at",kind:"message",T:b},{no:4,name:"ins_prev_id",kind:"message",T:Vs},{no:5,name:"attributes",kind:"map",K:9,V:{kind:"message",T:Kn}}]));let _o=jn;const Wn=class Jr extends T{constructor(e){super(),o(this,"createdAt"),o(this,"offset",0),u.util.initPartial(e,this)}static fromBinary(e,t){return new Jr().fromBinary(e,t)}static fromJson(e,t){return new Jr().fromJson(e,t)}static fromJsonString(e,t){return new Jr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Jr,e,t)}};o(Wn,"runtime",u),o(Wn,"typeName","yorkie.v1.TextNodeID"),o(Wn,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:b},{no:2,name:"offset",kind:"scalar",T:5}]));let Vs=Wn;const Gn=class Lr extends T{constructor(e){super(),o(this,"id"),o(this,"type",""),o(this,"value",""),o(this,"removedAt"),o(this,"insPrevId"),o(this,"insNextId"),o(this,"depth",0),o(this,"attributes",{}),u.util.initPartial(e,this)}static fromBinary(e,t){return new Lr().fromBinary(e,t)}static fromJson(e,t){return new Lr().fromJson(e,t)}static fromJsonString(e,t){return new Lr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Lr,e,t)}};o(Gn,"runtime",u),o(Gn,"typeName","yorkie.v1.TreeNode"),o(Gn,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:Et},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"value",kind:"scalar",T:9},{no:4,name:"removed_at",kind:"message",T:b},{no:5,name:"ins_prev_id",kind:"message",T:Et},{no:6,name:"ins_next_id",kind:"message",T:Et},{no:7,name:"depth",kind:"scalar",T:5},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:Kn}}]));let Ks=Gn;const Hn=class qr extends T{constructor(e){super(),o(this,"content",[]),u.util.initPartial(e,this)}static fromBinary(e,t){return new qr().fromBinary(e,t)}static fromJson(e,t){return new qr().fromJson(e,t)}static fromJsonString(e,t){return new qr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(qr,e,t)}};o(Hn,"runtime",u),o(Hn,"typeName","yorkie.v1.TreeNodes"),o(Hn,"fields",u.util.newFieldList(()=>[{no:1,name:"content",kind:"message",T:Ks,repeated:!0}]));let Vo=Hn;const Yn=class $r extends T{constructor(e){super(),o(this,"createdAt"),o(this,"offset",0),u.util.initPartial(e,this)}static fromBinary(e,t){return new $r().fromBinary(e,t)}static fromJson(e,t){return new $r().fromJson(e,t)}static fromJsonString(e,t){return new $r().fromJsonString(e,t)}static equals(e,t){return u.util.equals($r,e,t)}};o(Yn,"runtime",u),o(Yn,"typeName","yorkie.v1.TreeNodeID"),o(Yn,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:b},{no:2,name:"offset",kind:"scalar",T:5}]));let Et=Yn;const Xn=class Ur extends T{constructor(e){super(),o(this,"parentId"),o(this,"leftSiblingId"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Ur().fromBinary(e,t)}static fromJson(e,t){return new Ur().fromJson(e,t)}static fromJsonString(e,t){return new Ur().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Ur,e,t)}};o(Xn,"runtime",u),o(Xn,"typeName","yorkie.v1.TreePos"),o(Xn,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_id",kind:"message",T:Et},{no:2,name:"left_sibling_id",kind:"message",T:Et}]));let _t=Xn;const js=class Fr extends T{constructor(e){super(),o(this,"id",""),o(this,"username",""),o(this,"createdAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Fr().fromBinary(e,t)}static fromJson(e,t){return new Fr().fromJson(e,t)}static fromJsonString(e,t){return new Fr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Fr,e,t)}};o(js,"runtime",u),o(js,"typeName","yorkie.v1.User"),o(js,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"created_at",kind:"message",T:Y}]));const Ws=class Mr extends T{constructor(e){super(),o(this,"id",""),o(this,"name",""),o(this,"publicKey",""),o(this,"secretKey",""),o(this,"authWebhookUrl",""),o(this,"authWebhookMethods",[]),o(this,"clientDeactivateThreshold",""),o(this,"createdAt"),o(this,"updatedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Mr().fromBinary(e,t)}static fromJson(e,t){return new Mr().fromJson(e,t)}static fromJsonString(e,t){return new Mr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Mr,e,t)}};o(Ws,"runtime",u),o(Ws,"typeName","yorkie.v1.Project"),o(Ws,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"public_key",kind:"scalar",T:9},{no:4,name:"secret_key",kind:"scalar",T:9},{no:5,name:"auth_webhook_url",kind:"scalar",T:9},{no:6,name:"auth_webhook_methods",kind:"scalar",T:9,repeated:!0},{no:7,name:"client_deactivate_threshold",kind:"scalar",T:9},{no:8,name:"created_at",kind:"message",T:Y},{no:9,name:"updated_at",kind:"message",T:Y}]));const Gs=class zr extends T{constructor(e){super(),o(this,"name"),o(this,"authWebhookUrl"),o(this,"authWebhookMethods"),o(this,"clientDeactivateThreshold"),u.util.initPartial(e,this)}static fromBinary(e,t){return new zr().fromBinary(e,t)}static fromJson(e,t){return new zr().fromJson(e,t)}static fromJsonString(e,t){return new zr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(zr,e,t)}};o(Gs,"runtime",u),o(Gs,"typeName","yorkie.v1.UpdatableProjectFields"),o(Gs,"fields",u.util.newFieldList(()=>[{no:1,name:"name",kind:"message",T:re},{no:2,name:"auth_webhook_url",kind:"message",T:re},{no:3,name:"auth_webhook_methods",kind:"message",T:pu},{no:4,name:"client_deactivate_threshold",kind:"message",T:re}]));const Zn=class _r extends T{constructor(e){super(),o(this,"methods",[]),u.util.initPartial(e,this)}static fromBinary(e,t){return new _r().fromBinary(e,t)}static fromJson(e,t){return new _r().fromJson(e,t)}static fromJsonString(e,t){return new _r().fromJsonString(e,t)}static equals(e,t){return u.util.equals(_r,e,t)}};o(Zn,"runtime",u),o(Zn,"typeName","yorkie.v1.UpdatableProjectFields.AuthWebhookMethods"),o(Zn,"fields",u.util.newFieldList(()=>[{no:1,name:"methods",kind:"scalar",T:9,repeated:!0}]));let pu=Zn;const Hs=class Vr extends T{constructor(e){super(),o(this,"id",""),o(this,"key",""),o(this,"snapshot",""),o(this,"createdAt"),o(this,"accessedAt"),o(this,"updatedAt"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Vr().fromBinary(e,t)}static fromJson(e,t){return new Vr().fromJson(e,t)}static fromJsonString(e,t){return new Vr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Vr,e,t)}};o(Hs,"runtime",u),o(Hs,"typeName","yorkie.v1.DocumentSummary"),o(Hs,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"snapshot",kind:"scalar",T:9},{no:4,name:"created_at",kind:"message",T:Y},{no:5,name:"accessed_at",kind:"message",T:Y},{no:6,name:"updated_at",kind:"message",T:Y}]));const Qn=class Kr extends T{constructor(e){super(),o(this,"type",0),o(this,"presence"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Kr().fromBinary(e,t)}static fromJson(e,t){return new Kr().fromJson(e,t)}static fromJsonString(e,t){return new Kr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Kr,e,t)}};o(Qn,"runtime",u),o(Qn,"typeName","yorkie.v1.PresenceChange"),o(Qn,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(ft)},{no:2,name:"presence",kind:"message",T:Xs}]));let Ys=Qn;var ft=(r=>(r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.PUT=1]="PUT",r[r.DELETE=2]="DELETE",r[r.CLEAR=3]="CLEAR",r))(ft||{});u.util.setEnumType(ft,"yorkie.v1.PresenceChange.ChangeType",[{no:0,name:"CHANGE_TYPE_UNSPECIFIED"},{no:1,name:"CHANGE_TYPE_PUT"},{no:2,name:"CHANGE_TYPE_DELETE"},{no:3,name:"CHANGE_TYPE_CLEAR"}]);let Xs=(ze=class extends T{constructor(r){super(),o(this,"data",{}),u.util.initPartial(r,this)}static fromBinary(r,e){return new ze().fromBinary(r,e)}static fromJson(r,e){return new ze().fromJson(r,e)}static fromJsonString(r,e){return new ze().fromJsonString(r,e)}static equals(r,e){return u.util.equals(ze,r,e)}},o(ze,"runtime",u),o(ze,"typeName","yorkie.v1.Presence"),o(ze,"fields",u.util.newFieldList(()=>[{no:1,name:"data",kind:"map",K:9,V:{kind:"scalar",T:9}}])),ze),Ko=(_e=class extends T{constructor(r){super(),o(this,"serverSeq",U.zero),o(this,"clientSeq",0),u.util.initPartial(r,this)}static fromBinary(r,e){return new _e().fromBinary(r,e)}static fromJson(r,e){return new _e().fromJson(r,e)}static fromJsonString(r,e){return new _e().fromJsonString(r,e)}static equals(r,e){return u.util.equals(_e,r,e)}},o(_e,"runtime",u),o(_e,"typeName","yorkie.v1.Checkpoint"),o(_e,"fields",u.util.newFieldList(()=>[{no:1,name:"server_seq",kind:"scalar",T:3},{no:2,name:"client_seq",kind:"scalar",T:13}])),_e);const es=class jr extends T{constructor(e){super(),o(this,"createdAt"),o(this,"offset",0),o(this,"relativeOffset",0),u.util.initPartial(e,this)}static fromBinary(e,t){return new jr().fromBinary(e,t)}static fromJson(e,t){return new jr().fromJson(e,t)}static fromJsonString(e,t){return new jr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(jr,e,t)}};o(es,"runtime",u),o(es,"typeName","yorkie.v1.TextNodePos"),o(es,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:b},{no:2,name:"offset",kind:"scalar",T:5},{no:3,name:"relative_offset",kind:"scalar",T:5}]));let dt=es,b=(Ve=class extends T{constructor(r){super(),o(this,"lamport",U.zero),o(this,"delimiter",0),o(this,"actorId",new Uint8Array(0)),u.util.initPartial(r,this)}static fromBinary(r,e){return new Ve().fromBinary(r,e)}static fromJson(r,e){return new Ve().fromJson(r,e)}static fromJsonString(r,e){return new Ve().fromJsonString(r,e)}static equals(r,e){return u.util.equals(Ve,r,e)}},o(Ve,"runtime",u),o(Ve,"typeName","yorkie.v1.TimeTicket"),o(Ve,"fields",u.util.newFieldList(()=>[{no:1,name:"lamport",kind:"scalar",T:3},{no:2,name:"delimiter",kind:"scalar",T:13},{no:3,name:"actor_id",kind:"scalar",T:12}])),Ve);const ts=class Wr extends T{constructor(e){super(),o(this,"topic",""),o(this,"payload",new Uint8Array(0)),u.util.initPartial(e,this)}static fromBinary(e,t){return new Wr().fromBinary(e,t)}static fromJson(e,t){return new Wr().fromJson(e,t)}static fromJsonString(e,t){return new Wr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Wr,e,t)}};o(ts,"runtime",u),o(ts,"typeName","yorkie.v1.DocEventBody"),o(ts,"fields",u.util.newFieldList(()=>[{no:1,name:"topic",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12}]));let yu=ts;const rs=class Gr extends T{constructor(e){super(),o(this,"type",0),o(this,"publisher",""),o(this,"body"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Gr().fromBinary(e,t)}static fromJson(e,t){return new Gr().fromJson(e,t)}static fromJsonString(e,t){return new Gr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Gr,e,t)}};o(rs,"runtime",u),o(rs,"typeName","yorkie.v1.DocEvent"),o(rs,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(lt)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"body",kind:"message",T:yu}]));let vu=rs;const ns=class Hr extends T{constructor(e){super(),o(this,"clientKey",""),o(this,"metadata",{}),u.util.initPartial(e,this)}static fromBinary(e,t){return new Hr().fromBinary(e,t)}static fromJson(e,t){return new Hr().fromJson(e,t)}static fromJsonString(e,t){return new Hr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Hr,e,t)}};o(ns,"runtime",u),o(ns,"typeName","yorkie.v1.ActivateClientRequest"),o(ns,"fields",u.util.newFieldList(()=>[{no:1,name:"client_key",kind:"scalar",T:9},{no:2,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]));let wu=ns;const ss=class Yr extends T{constructor(e){super(),o(this,"clientId",""),u.util.initPartial(e,this)}static fromBinary(e,t){return new Yr().fromBinary(e,t)}static fromJson(e,t){return new Yr().fromJson(e,t)}static fromJsonString(e,t){return new Yr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Yr,e,t)}};o(ss,"runtime",u),o(ss,"typeName","yorkie.v1.ActivateClientResponse"),o(ss,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9}]));let Tu=ss;const is=class Xr extends T{constructor(e){super(),o(this,"clientId",""),u.util.initPartial(e,this)}static fromBinary(e,t){return new Xr().fromBinary(e,t)}static fromJson(e,t){return new Xr().fromJson(e,t)}static fromJsonString(e,t){return new Xr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Xr,e,t)}};o(is,"runtime",u),o(is,"typeName","yorkie.v1.DeactivateClientRequest"),o(is,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9}]));let Su=is;const os=class Zr extends T{constructor(e){super(),u.util.initPartial(e,this)}static fromBinary(e,t){return new Zr().fromBinary(e,t)}static fromJson(e,t){return new Zr().fromJson(e,t)}static fromJsonString(e,t){return new Zr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Zr,e,t)}};o(os,"runtime",u),o(os,"typeName","yorkie.v1.DeactivateClientResponse"),o(os,"fields",u.util.newFieldList(()=>[]));let bu=os;const as=class Qr extends T{constructor(e){super(),o(this,"clientId",""),o(this,"changePack"),u.util.initPartial(e,this)}static fromBinary(e,t){return new Qr().fromBinary(e,t)}static fromJson(e,t){return new Qr().fromJson(e,t)}static fromJsonString(e,t){return new Qr().fromJsonString(e,t)}static equals(e,t){return u.util.equals(Qr,e,t)}};o(as,"runtime",u),o(as,"typeName","yorkie.v1.AttachDocumentRequest"),o(as,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:Ge}]));let Iu=as;const cs=class en extends T{constructor(e){super(),o(this,"documentId",""),o(this,"changePack"),u.util.initPartial(e,this)}static fromBinary(e,t){return new en().fromBinary(e,t)}static fromJson(e,t){return new en().fromJson(e,t)}static fromJsonString(e,t){return new en().fromJsonString(e,t)}static equals(e,t){return u.util.equals(en,e,t)}};o(cs,"runtime",u),o(cs,"typeName","yorkie.v1.AttachDocumentResponse"),o(cs,"fields",u.util.newFieldList(()=>[{no:1,name:"document_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:Ge}]));let Au=cs;const us=class tn extends T{constructor(e){super(),o(this,"clientId",""),o(this,"documentId",""),o(this,"changePack"),o(this,"removeIfNotAttached",!1),u.util.initPartial(e,this)}static fromBinary(e,t){return new tn().fromBinary(e,t)}static fromJson(e,t){return new tn().fromJson(e,t)}static fromJsonString(e,t){return new tn().fromJsonString(e,t)}static equals(e,t){return u.util.equals(tn,e,t)}};o(us,"runtime",u),o(us,"typeName","yorkie.v1.DetachDocumentRequest"),o(us,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Ge},{no:4,name:"remove_if_not_attached",kind:"scalar",T:8}]));let ku=us;const hs=class rn extends T{constructor(e){super(),o(this,"changePack"),u.util.initPartial(e,this)}static fromBinary(e,t){return new rn().fromBinary(e,t)}static fromJson(e,t){return new rn().fromJson(e,t)}static fromJsonString(e,t){return new rn().fromJsonString(e,t)}static equals(e,t){return u.util.equals(rn,e,t)}};o(hs,"runtime",u),o(hs,"typeName","yorkie.v1.DetachDocumentResponse"),o(hs,"fields",u.util.newFieldList(()=>[{no:2,name:"change_pack",kind:"message",T:Ge}]));let Nu=hs;const ls=class nn extends T{constructor(e){super(),o(this,"clientId",""),o(this,"documentId",""),u.util.initPartial(e,this)}static fromBinary(e,t){return new nn().fromBinary(e,t)}static fromJson(e,t){return new nn().fromJson(e,t)}static fromJsonString(e,t){return new nn().fromJsonString(e,t)}static equals(e,t){return u.util.equals(nn,e,t)}};o(ls,"runtime",u),o(ls,"typeName","yorkie.v1.WatchDocumentRequest"),o(ls,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9}]));let Eu=ls;const fs=class sn extends T{constructor(e){super(),o(this,"body",{case:void 0}),u.util.initPartial(e,this)}static fromBinary(e,t){return new sn().fromBinary(e,t)}static fromJson(e,t){return new sn().fromJson(e,t)}static fromJsonString(e,t){return new sn().fromJsonString(e,t)}static equals(e,t){return u.util.equals(sn,e,t)}};o(fs,"runtime",u),o(fs,"typeName","yorkie.v1.WatchDocumentResponse"),o(fs,"fields",u.util.newFieldList(()=>[{no:1,name:"initialization",kind:"message",T:Du,oneof:"body"},{no:2,name:"event",kind:"message",T:vu,oneof:"body"}]));let Pu=fs;const ds=class on extends T{constructor(e){super(),o(this,"clientIds",[]),u.util.initPartial(e,this)}static fromBinary(e,t){return new on().fromBinary(e,t)}static fromJson(e,t){return new on().fromJson(e,t)}static fromJsonString(e,t){return new on().fromJsonString(e,t)}static equals(e,t){return u.util.equals(on,e,t)}};o(ds,"runtime",u),o(ds,"typeName","yorkie.v1.WatchDocumentResponse.Initialization"),o(ds,"fields",u.util.newFieldList(()=>[{no:1,name:"client_ids",kind:"scalar",T:9,repeated:!0}]));let Du=ds;const gs=class an extends T{constructor(e){super(),o(this,"clientId",""),o(this,"documentId",""),o(this,"changePack"),u.util.initPartial(e,this)}static fromBinary(e,t){return new an().fromBinary(e,t)}static fromJson(e,t){return new an().fromJson(e,t)}static fromJsonString(e,t){return new an().fromJsonString(e,t)}static equals(e,t){return u.util.equals(an,e,t)}};o(gs,"runtime",u),o(gs,"typeName","yorkie.v1.RemoveDocumentRequest"),o(gs,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Ge}]));let xu=gs;const ms=class cn extends T{constructor(e){super(),o(this,"changePack"),u.util.initPartial(e,this)}static fromBinary(e,t){return new cn().fromBinary(e,t)}static fromJson(e,t){return new cn().fromJson(e,t)}static fromJsonString(e,t){return new cn().fromJsonString(e,t)}static equals(e,t){return u.util.equals(cn,e,t)}};o(ms,"runtime",u),o(ms,"typeName","yorkie.v1.RemoveDocumentResponse"),o(ms,"fields",u.util.newFieldList(()=>[{no:1,name:"change_pack",kind:"message",T:Ge}]));let Cu=ms;const ps=class un extends T{constructor(e){super(),o(this,"clientId",""),o(this,"documentId",""),o(this,"changePack"),o(this,"pushOnly",!1),u.util.initPartial(e,this)}static fromBinary(e,t){return new un().fromBinary(e,t)}static fromJson(e,t){return new un().fromJson(e,t)}static fromJsonString(e,t){return new un().fromJsonString(e,t)}static equals(e,t){return u.util.equals(un,e,t)}};o(ps,"runtime",u),o(ps,"typeName","yorkie.v1.PushPullChangesRequest"),o(ps,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Ge},{no:4,name:"push_only",kind:"scalar",T:8}]));let Ou=ps;const ys=class hn extends T{constructor(e){super(),o(this,"changePack"),u.util.initPartial(e,this)}static fromBinary(e,t){return new hn().fromBinary(e,t)}static fromJson(e,t){return new hn().fromJson(e,t)}static fromJsonString(e,t){return new hn().fromJsonString(e,t)}static equals(e,t){return u.util.equals(hn,e,t)}};o(ys,"runtime",u),o(ys,"typeName","yorkie.v1.PushPullChangesResponse"),o(ys,"fields",u.util.newFieldList(()=>[{no:1,name:"change_pack",kind:"message",T:Ge}]));let Ru=ys;const vs=class ln extends T{constructor(e){super(),o(this,"clientId",""),o(this,"documentId",""),o(this,"topic",""),o(this,"payload",new Uint8Array(0)),u.util.initPartial(e,this)}static fromBinary(e,t){return new ln().fromBinary(e,t)}static fromJson(e,t){return new ln().fromJson(e,t)}static fromJsonString(e,t){return new ln().fromJsonString(e,t)}static equals(e,t){return u.util.equals(ln,e,t)}};o(vs,"runtime",u),o(vs,"typeName","yorkie.v1.BroadcastRequest"),o(vs,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}]));let Bu=vs;const ws=class fn extends T{constructor(e){super(),u.util.initPartial(e,this)}static fromBinary(e,t){return new fn().fromBinary(e,t)}static fromJson(e,t){return new fn().fromJson(e,t)}static fromJsonString(e,t){return new fn().fromJsonString(e,t)}static equals(e,t){return u.util.equals(fn,e,t)}};o(ws,"runtime",u),o(ws,"typeName","yorkie.v1.BroadcastResponse"),o(ws,"fields",u.util.newFieldList(()=>[]));let Ju=ws;const Lu={typeName:"yorkie.v1.YorkieService",methods:{activateClient:{name:"ActivateClient",I:wu,O:Tu,kind:Q.Unary},deactivateClient:{name:"DeactivateClient",I:Su,O:bu,kind:Q.Unary},attachDocument:{name:"AttachDocument",I:Iu,O:Au,kind:Q.Unary},detachDocument:{name:"DetachDocument",I:ku,O:Nu,kind:Q.Unary},removeDocument:{name:"RemoveDocument",I:xu,O:Cu,kind:Q.Unary},pushPullChanges:{name:"PushPullChanges",I:Ou,O:Ru,kind:Q.Unary},watchDocument:{name:"WatchDocument",I:Eu,O:Pu,kind:Q.ServerStreaming},broadcast:{name:"Broadcast",I:Bu,O:Ju,kind:Q.Unary}}},qu=u.makeMessageType("google.rpc.ErrorInfo",()=>[{no:1,name:"reason",kind:"scalar",T:9},{no:2,name:"domain",kind:"scalar",T:9},{no:3,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]);u.makeMessageType("google.rpc.RetryInfo",()=>[{no:1,name:"retry_delay",kind:"message",T:je}]),u.makeMessageType("google.rpc.DebugInfo",()=>[{no:1,name:"stack_entries",kind:"scalar",T:9,repeated:!0},{no:2,name:"detail",kind:"scalar",T:9}]),u.makeMessageType("google.rpc.QuotaFailure",()=>[{no:1,name:"violations",kind:"message",T:$u,repeated:!0}]);const $u=u.makeMessageType("google.rpc.QuotaFailure.Violation",()=>[{no:1,name:"subject",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9}],{localName:"QuotaFailure_Violation"});u.makeMessageType("google.rpc.PreconditionFailure",()=>[{no:1,name:"violations",kind:"message",T:Uu,repeated:!0}]);const Uu=u.makeMessageType("google.rpc.PreconditionFailure.Violation",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"subject",kind:"scalar",T:9},{no:3,name:"description",kind:"scalar",T:9}],{localName:"PreconditionFailure_Violation"});u.makeMessageType("google.rpc.BadRequest",()=>[{no:1,name:"field_violations",kind:"message",T:Fu,repeated:!0}]);const Fu=u.makeMessageType("google.rpc.BadRequest.FieldViolation",()=>[{no:1,name:"field",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9},{no:3,name:"reason",kind:"scalar",T:9},{no:4,name:"localized_message",kind:"message",T:zu}],{localName:"BadRequest_FieldViolation"});u.makeMessageType("google.rpc.RequestInfo",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"serving_data",kind:"scalar",T:9}]),u.makeMessageType("google.rpc.ResourceInfo",()=>[{no:1,name:"resource_type",kind:"scalar",T:9},{no:2,name:"resource_name",kind:"scalar",T:9},{no:3,name:"owner",kind:"scalar",T:9},{no:4,name:"description",kind:"scalar",T:9}]),u.makeMessageType("google.rpc.Help",()=>[{no:1,name:"links",kind:"message",T:Mu,repeated:!0}]);const Mu=u.makeMessageType("google.rpc.Help.Link",()=>[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9}],{localName:"Help_Link"}),zu=u.makeMessageType("google.rpc.LocalizedMessage",()=>[{no:1,name:"locale",kind:"scalar",T:9},{no:2,name:"message",kind:"scalar",T:9}]);var d=(r=>(r.Ok="ok",r.ErrClientNotActivated="ErrClientNotActivated",r.ErrClientNotFound="ErrClientNotFound",r.ErrUnimplemented="ErrUnimplemented",r.ErrInvalidType="ErrInvalidType",r.ErrDummy="ErrDummy",r.ErrDocumentNotAttached="ErrDocumentNotAttached",r.ErrDocumentNotDetached="ErrDocumentNotDetached",r.ErrDocumentRemoved="ErrDocumentRemoved",r.ErrInvalidObjectKey="ErrInvalidObjectKey",r.ErrInvalidArgument="ErrInvalidArgument",r.ErrNotInitialized="ErrNotInitialized",r.ErrNotReady="ErrNotReady",r.ErrRefused="ErrRefused",r.ErrContextNotProvided="ErrContextNotProvided",r.ErrPermissionDenied="ErrPermissionDenied",r.ErrUnauthenticated="ErrUnauthenticated",r.ErrTooManySubscribers="ErrTooManySubscribers",r.ErrTooManyAttachments="ErrTooManyAttachments",r))(d||{});class g extends Error{constructor(e,t){super(t),o(this,"name","YorkieError"),o(this,"stack"),this.code=e,this.message=t,this.toString=()=>`[code=${this.code}]: ${this.message}`}}var Oe=(r=>(r.Put="put",r.Clear="clear",r))(Oe||{});const Ts="000000000000000000000000",rt=24;class ne{constructor(e,t,n){o(this,"lamport"),o(this,"delimiter"),o(this,"actorID"),this.lamport=e,this.delimiter=t,this.actorID=n}static of(e,t,n){return new ne(e,t,n)}static fromStruct(e){return ne.of(BigInt(e.lamport),e.delimiter,e.actorID)}toIDString(){return`${this.lamport.toString()}:${this.actorID}:${this.delimiter}`}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return`${this.lamport.toString()}:${this.actorID.slice(-2)}:${this.delimiter}`}setActor(e){return new ne(this.lamport,this.delimiter,e)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(e){return this.compare(e)>0}equals(e){return this.compare(e)===0}compare(e){if(this.lamport>e.lamport)return 1;if(e.lamport>this.lamport)return-1;const t=this.actorID.localeCompare(e.actorID);return t!==0?t:this.delimiter>e.delimiter?1:e.delimiter>this.delimiter?-1:0}}const Zs=0n,jo=0,Vt=9223372036854775807n,Pt=new ne(Zs,jo,Ts);function Re(r){return r.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(e){switch(e){case'"':case"\\":return"\\"+e;case`
`:return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}})}class Kt{constructor(e){o(this,"createdAt"),o(this,"movedAt"),o(this,"removedAt"),this.createdAt=e}getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setMovedAt(e){return!this.movedAt||e&&e.after(this.movedAt)?(this.movedAt=e,!0):!1}setRemovedAt(e){this.removedAt=e}remove(e){return e&&e.after(this.getPositionedAt())&&(!this.removedAt||e.after(this.removedAt))?(this.removedAt=e,!0):!1}isRemoved(){return!!this.removedAt}getMetaUsage(){let e=0;return this.getCreatedAt()&&(e+=rt),this.getMovedAt()&&(e+=rt),this.getRemovedAt()&&(e+=rt),e}}class nt extends Kt{constructor(e){super(e)}}class Qs{constructor(e,t){o(this,"strKey"),o(this,"value"),this.strKey=e,this.value=t}static of(e,t){return new Qs(e,t)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(e){return this.value.remove(e)}}class jt{constructor(){o(this,"nodeMapByKey"),o(this,"nodeMapByCreatedAt"),this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}static create(){return new jt}set(e,t,n){let s;const i=this.nodeMapByKey.get(e);i!=null&&!i.isRemoved()&&i.remove(n)&&(s=i.getValue());const a=Qs.of(e,t);return this.nodeMapByCreatedAt.set(t.getCreatedAt().toIDString(),a),(i==null||n.after(i.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(e,a),t.setMovedAt(n)),s}delete(e,t){if(!this.nodeMapByCreatedAt.has(e.toIDString()))throw new g(d.ErrInvalidArgument,`fail to find ${e.toIDString()}`);const n=this.nodeMapByCreatedAt.get(e.toIDString());return n.remove(t),n.getValue()}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return t.getStrKey()}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new g(d.ErrInvalidArgument,`fail to find ${e.getCreatedAt().toIDString()}`);const n=this.nodeMapByKey.get(t.getStrKey());t===n&&this.nodeMapByKey.delete(n.getStrKey()),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}deleteByKey(e,t){const n=this.nodeMapByKey.get(e);if(n!=null&&n.remove(t))return n.getValue()}has(e){const t=this.nodeMapByKey.get(e);return t==null?!1:!t.isRemoved()}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}get(e){const t=this.nodeMapByKey.get(e);if(!(!t||t.isRemoved()))return t}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}}class ee extends nt{constructor(e,t){super(e),o(this,"memberNodes"),this.memberNodes=t}static create(e,t){if(!t)return new ee(e,jt.create());const n=jt.create();for(const[s,i]of Object.entries(t))n.set(s,i.deepcopy(),i.getCreatedAt());return new ee(e,n)}subPathOf(e){return this.memberNodes.subPathOf(e)}purge(e){this.memberNodes.purge(e)}set(e,t,n){return this.memberNodes.set(e,t,n)}delete(e,t){return this.memberNodes.delete(e,t)}deleteByKey(e,t){return this.memberNodes.deleteByKey(e,t)}get(e){const t=this.memberNodes.get(e);return t==null?void 0:t.getValue()}getByID(e){const t=this.memberNodes.getByID(e);return t==null?void 0:t.getValue()}has(e){return this.memberNodes.has(e)}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){const e=[];for(const[t,n]of this)e.push(`"${Re(t)}":${n.toJSON()}`);return`{${e.join(",")}}`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(const[t,n]of this){const{createdAt:s,value:i,type:a}=n.toJSForTest();e[t]={key:t,createdAt:s,value:i,type:a}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_OBJECT"}}getKeys(){const e=Array();for(const[t]of this)e.push(t);return e}toSortedJSON(){var e;const t=Array();for(const[s]of this)t.push(s);const n=[];for(const s of t.sort()){const i=(e=this.memberNodes.get(s))==null?void 0:e.getValue();n.push(`"${Re(s)}":${i.toSortedJSON()}`)}return`{${n.join(",")}}`}getRHT(){return this.memberNodes}deepcopy(){const e=ee.create(this.getCreatedAt());for(const t of this.memberNodes)e.memberNodes.set(t.getStrKey(),t.getValue().deepcopy(),this.getPositionedAt());return e.remove(this.getRemovedAt()),e}getDescendants(e){for(const t of this.memberNodes){const n=t.getValue();if(e(n,this))return;n instanceof nt&&n.getDescendants(e)}}*[Symbol.iterator](){const e=new Set;for(const t of this.memberNodes)e.has(t.getStrKey())||(e.add(t.getStrKey()),t.isRemoved()||(yield[t.getStrKey(),t.getValue()]))}}var q=(r=>(r.Local="local",r.Remote="remote",r.UndoRedo="undoredo",r))(q||{});class de{constructor(e,t){o(this,"parentCreatedAt"),o(this,"executedAt"),this.parentCreatedAt=e,this.executedAt=t}getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new g(d.ErrNotReady,"executedAt is not set yet");return this.executedAt}setActor(e){this.executedAt&&(this.executedAt=this.executedAt.setActor(e))}setExecutedAt(e){this.executedAt=e}}class Wo{constructor(e){o(this,"value"),o(this,"left"),o(this,"right"),o(this,"parent"),o(this,"weight"),this.value=e,this.initWeight()}getNodeString(){return`${this.weight}${this.value}`}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(e){this.left=e}setRight(e){this.right=e}setParent(e){this.parent=e}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(e){this.weight+=e}initWeight(){this.weight=this.getLength()}}class Wt{constructor(e){o(this,"root"),this.root=e}get length(){return this.root?this.root.getWeight():0}find(e){if(!this.root||e<0)return[void 0,0];let t=this.root;for(;;)if(t.hasLeft()&&e<=t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else{e-=t.getLeftWeight();break}if(e>t.getLength())throw new g(d.ErrInvalidArgument,`out of index range: pos: ${e} > node.length: ${t.getLength()}`);return this.splayNode(t),[t,e]}indexOf(e){return!e||e!==this.root&&!e.hasLinks()?-1:(this.splayNode(e),this.root.getLeftWeight())}getRoot(){return this.root}insert(e){return this.insertAfter(this.root,e)}insertAfter(e,t){return e?(this.splayNode(e),this.root=t,t.setRight(e.getRight()),e.hasRight()&&e.getRight().setParent(t),t.setLeft(e),e.setParent(t),e.setRight(),this.updateWeight(e),this.updateWeight(t),t):(this.root=t,t)}updateWeight(e){e.initWeight(),e.hasLeft()&&e.increaseWeight(e.getLeftWeight()),e.hasRight()&&e.increaseWeight(e.getRightWeight())}updateTreeWeight(e){for(;e;)this.updateWeight(e),e=e.getParent()}splayNode(e){if(e)for(;;)if(this.isLeftChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e),this.rotateLeft(e);else if(this.isLeftChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e.getParent()),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e.getParent()),this.rotateLeft(e);else{this.isLeftChild(e)?this.rotateRight(e):this.isRightChild(e)&&this.rotateLeft(e),this.updateWeight(e);return}}delete(e){this.splayNode(e);const t=new Wt(e.getLeft());t.root&&t.root.setParent();const n=new Wt(e.getRight());if(n.root&&n.root.setParent(),t.root){const s=t.getRightmost();t.splayNode(s),t.root.setRight(n.root),n.root&&n.root.setParent(t.root),this.root=t.root}else this.root=n.root;e.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(e,t){if(!t){this.splayNode(e),this.cutOffRight(e);return}this.splayNode(e),this.splayNode(t),t.getLeft()!=e&&this.rotateRight(e),this.cutOffRight(e)}cutOffRight(e){const t=[];this.traversePostorder(e.getRight(),t);for(const n of t)n.initWeight();this.updateTreeWeight(e)}toTestString(){const e=[];return this.traverseInorder(this.root,e),e.map(t=>`[${t.getWeight()},${t.getLength()}]${t.getValue()||""}`).join("")}checkWeight(){const e=[];this.traverseInorder(this.root,e);for(const t of e)if(t.getWeight()!=t.getLength()+t.getLeftWeight()+t.getRightWeight())return!1;return!0}getRightmost(){let e=this.root;for(;e.hasRight();)e=e.getRight();return e}traverseInorder(e,t){e&&(this.traverseInorder(e.getLeft(),t),t.push(e),this.traverseInorder(e.getRight(),t))}traversePostorder(e,t){e&&(this.traversePostorder(e.getLeft(),t),this.traversePostorder(e.getRight(),t),t.push(e))}rotateLeft(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setRight(e.getLeft()),t.hasRight()&&t.getRight().setParent(t),e.setLeft(t),e.getLeft().setParent(e),this.updateWeight(t),this.updateWeight(e)}rotateRight(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setLeft(e.getRight()),t.hasLeft()&&t.getLeft().setParent(t),e.setRight(t),e.getRight().setParent(e),this.updateWeight(t),this.updateWeight(e)}isLeftChild(e){return e&&e.hasParent()?e.getParent().getLeft()===e:!1}isRightChild(e){return e&&e.hasParent()?e.getParent().getRight()===e:!1}}/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var ce=null;try{ce=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function x(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}x.prototype.__isLong__,Object.defineProperty(x.prototype,"__isLong__",{value:!0});function X(r){return(r&&r.__isLong__)===!0}function Go(r){var e=Math.clz32(r&-r);return r?31-e:e}x.isLong=X;var Ho={},Yo={};function gt(r,e){var t,n,s;return e?(r>>>=0,(s=0<=r&&r<256)&&(n=Yo[r],n)?n:(t=O(r,0,!0),s&&(Yo[r]=t),t)):(r|=0,(s=-128<=r&&r<128)&&(n=Ho[r],n)?n:(t=O(r,r<0?-1:0,!1),s&&(Ho[r]=t),t))}x.fromInt=gt;function ue(r,e){if(isNaN(r))return e?He:ge;if(e){if(r<0)return He;if(r>=Zo)return ra}else{if(r<=-9223372036854776e3)return te;if(r+1>=Vu)return ta}return r<0?ue(-r,e).neg():O(r%Dt|0,r/Dt|0,e)}x.fromNumber=ue;function O(r,e,t){return new x(r,e,t)}x.fromBits=O;var Ss=Math.pow;function ei(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?He:ge;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return ei(r.substring(1),e,t).neg();for(var s=ue(Ss(t,8)),i=ge,a=0;a<r.length;a+=8){var c=Math.min(8,r.length-a),h=parseInt(r.substring(a,a+c),t);if(c<8){var l=ue(Ss(t,c));i=i.mul(l).add(ue(h))}else i=i.mul(s),i=i.add(ue(h))}return i.unsigned=e,i}x.fromString=ei;function he(r,e){return typeof r=="number"?ue(r,e):typeof r=="string"?ei(r,e):O(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}x.fromValue=he;var Xo=65536,_u=1<<24,Dt=Xo*Xo,Zo=Dt*Dt,Vu=Zo/2,Qo=gt(_u),ge=gt(0);x.ZERO=ge;var He=gt(0,!0);x.UZERO=He;var xt=gt(1);x.ONE=xt;var ea=gt(1,!0);x.UONE=ea;var ti=gt(-1);x.NEG_ONE=ti;var ta=O(-1,2147483647,!1);x.MAX_VALUE=ta;var ra=O(-1,-1,!0);x.MAX_UNSIGNED_VALUE=ra;var te=O(0,-2147483648,!1);x.MIN_VALUE=te;var w=x.prototype;w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*Dt+(this.low>>>0):this.high*Dt+(this.low>>>0)},w.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(te)){var t=ue(e),n=this.div(t),s=n.mul(t).sub(this);return n.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=ue(Ss(e,6),this.unsigned),a=this,c="";;){var h=a.div(i),l=a.sub(h.mul(i)).toInt()>>>0,f=l.toString(e);if(a=h,a.isZero())return f+c;for(;f.length<6;)f="0"+f;c=""+f+c}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(te)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1},w.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0},w.isZero=function(){return this.high===0&&this.low===0},w.eqz=w.isZero,w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return(this.low&1)===1},w.isEven=function(){return(this.low&1)===0},w.equals=function(e){return X(e)||(e=he(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},w.eq=w.equals,w.notEquals=function(e){return!this.eq(e)},w.neq=w.notEquals,w.ne=w.notEquals,w.lessThan=function(e){return this.comp(e)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(e){return this.comp(e)<=0},w.lte=w.lessThanOrEqual,w.le=w.lessThanOrEqual,w.greaterThan=function(e){return this.comp(e)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(e){return this.comp(e)>=0},w.gte=w.greaterThanOrEqual,w.ge=w.greaterThanOrEqual,w.compare=function(e){if(X(e)||(e=he(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(te)?te:this.not().add(xt)},w.neg=w.negate,w.add=function(e){X(e)||(e=he(e));var t=this.high>>>16,n=this.high&65535,s=this.low>>>16,i=this.low&65535,a=e.high>>>16,c=e.high&65535,h=e.low>>>16,l=e.low&65535,f=0,m=0,v=0,y=0;return y+=i+l,v+=y>>>16,y&=65535,v+=s+h,m+=v>>>16,v&=65535,m+=n+c,f+=m>>>16,m&=65535,f+=t+a,f&=65535,O(v<<16|y,f<<16|m,this.unsigned)},w.subtract=function(e){return X(e)||(e=he(e)),this.add(e.neg())},w.sub=w.subtract,w.multiply=function(e){if(this.isZero())return this;if(X(e)||(e=he(e)),ce){var t=ce.mul(this.low,this.high,e.low,e.high);return O(t,ce.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?He:ge;if(this.eq(te))return e.isOdd()?te:ge;if(e.eq(te))return this.isOdd()?te:ge;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Qo)&&e.lt(Qo))return ue(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,a=this.low&65535,c=e.high>>>16,h=e.high&65535,l=e.low>>>16,f=e.low&65535,m=0,v=0,y=0,S=0;return S+=a*f,y+=S>>>16,S&=65535,y+=i*f,v+=y>>>16,y&=65535,y+=a*l,v+=y>>>16,y&=65535,v+=s*f,m+=v>>>16,v&=65535,v+=i*l,m+=v>>>16,v&=65535,v+=a*h,m+=v>>>16,v&=65535,m+=n*f+s*l+i*h+a*c,m&=65535,O(y<<16|S,m<<16|v,this.unsigned)},w.mul=w.multiply,w.divide=function(e){if(X(e)||(e=he(e)),e.isZero())throw Error("division by zero");if(ce){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ce.div_u:ce.div_s)(this.low,this.high,e.low,e.high);return O(t,ce.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?He:ge;var n,s,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return He;if(e.gt(this.shru(1)))return ea;i=He}else{if(this.eq(te)){if(e.eq(xt)||e.eq(ti))return te;if(e.eq(te))return xt;var a=this.shr(1);return n=a.div(e).shl(1),n.eq(ge)?e.isNegative()?xt:ti:(s=this.sub(e.mul(n)),i=n.add(s.div(e)),i)}else if(e.eq(te))return this.unsigned?He:ge;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ge}for(s=this;s.gte(e);){n=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(n)/Math.LN2),h=c<=48?1:Ss(2,c-48),l=ue(n),f=l.mul(e);f.isNegative()||f.gt(s);)n-=h,l=ue(n,this.unsigned),f=l.mul(e);l.isZero()&&(l=xt),i=i.add(l),s=s.sub(f)}return i},w.div=w.divide,w.modulo=function(e){if(X(e)||(e=he(e)),ce){var t=(this.unsigned?ce.rem_u:ce.rem_s)(this.low,this.high,e.low,e.high);return O(t,ce.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},w.mod=w.modulo,w.rem=w.modulo,w.not=function(){return O(~this.low,~this.high,this.unsigned)},w.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},w.clz=w.countLeadingZeros,w.countTrailingZeros=function(){return this.low?Go(this.low):Go(this.high)+32},w.ctz=w.countTrailingZeros,w.and=function(e){return X(e)||(e=he(e)),O(this.low&e.low,this.high&e.high,this.unsigned)},w.or=function(e){return X(e)||(e=he(e)),O(this.low|e.low,this.high|e.high,this.unsigned)},w.xor=function(e){return X(e)||(e=he(e)),O(this.low^e.low,this.high^e.high,this.unsigned)},w.shiftLeft=function(e){return X(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?O(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):O(0,this.low<<e-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(e){return X(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?O(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):O(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(e){return X(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?O(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?O(this.high,0,this.unsigned):O(this.high>>>e-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.shr_u=w.shiftRightUnsigned,w.rotateLeft=function(e){var t;return X(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?O(this.high,this.low,this.unsigned):e<32?(t=32-e,O(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,O(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},w.rotl=w.rotateLeft,w.rotateRight=function(e){var t;return X(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?O(this.high,this.low,this.unsigned):e<32?(t=32-e,O(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,O(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},w.rotr=w.rotateRight,w.toSigned=function(){return this.unsigned?O(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:O(this.low,this.high,!0)},w.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},w.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},x.fromBytes=function(e,t,n){return n?x.fromBytesLE(e,t):x.fromBytesBE(e,t)},x.fromBytesLE=function(e,t){return new x(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},x.fromBytesBE=function(e,t){return new x(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},typeof BigInt=="function"&&(x.fromBigInt=function(e,t){var n=Number(BigInt.asIntN(32,e)),s=Number(BigInt.asIntN(32,e>>BigInt(32)));return O(n,s,t)},x.fromValue=function(e,t){return typeof e=="bigint"?fromBigInt(e,t):he(e,t)},w.toBigInt=function(){var e=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|e});var j=(r=>(r[r.Null=0]="Null",r[r.Boolean=1]="Boolean",r[r.Integer=2]="Integer",r[r.Long=3]="Long",r[r.Double=4]="Double",r[r.String=5]="String",r[r.Bytes=6]="Bytes",r[r.Date=7]="Date",r))(j||{});class F extends Kt{constructor(e,t){super(t),o(this,"valueType"),o(this,"value"),this.valueType=F.getPrimitiveType(e),this.value=e===void 0?null:e}static of(e,t){return new F(e,t)}static valueFromBytes(e,t){switch(e){case 0:return null;case 1:return!!t[0];case 2:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 4:{const n=new DataView(t.buffer);return t.forEach(function(s,i){n.setUint8(i,s)}),n.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(t);case 3:return x.fromBytesLE(Array.from(t));case 6:return t;case 7:return new Date(x.fromBytesLE(Array.from(t),!0).toNumber());default:throw new g(d.ErrUnimplemented,`unimplemented type: ${e}`)}}getValueSize(){switch(this.valueType){case 0:return 8;case 1:return 4;case 2:return 4;case 3:return 8;case 4:return 8;case 5:return this.value.length*2;case 6:return this.value.length;case 7:return 8;default:throw new g(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}getDataSize(){return{data:this.getValueSize(),meta:this.getMetaUsage()}}toJSON(){return this.valueType===5?`"${Re(this.value)}"`:`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){const e=F.of(this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e.setRemovedAt(this.getRemovedAt()),e}getType(){return this.valueType}static getPrimitiveType(e){switch(typeof e){case"undefined":return 0;case"boolean":return 1;case"number":return this.isInteger(e)?2:4;case"string":return 5;case"object":if(e===null)return 0;if(e instanceof x)return 3;if(e instanceof Uint8Array)return 6;if(e instanceof Date)return 7}}static isSupport(e){return F.getPrimitiveType(e)!==void 0}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===2||e===3||e===4}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return this.value?new Uint8Array([1]):new Uint8Array([0]);case 2:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 4:{const e=this.value,t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),t}case 5:return new TextEncoder().encode(this.value);case 3:{const t=this.value.toBytesLE();return Uint8Array.from(t)}case 6:return this.value;case 7:{const e=this.value,t=x.fromNumber(e.getTime(),!0).toBytesLE();return Uint8Array.from(t)}default:throw new g(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}}class bs extends Wo{constructor(e){super(e),o(this,"prev"),o(this,"next"),this.value=e}static createAfter(e,t){const n=new bs(t),s=e.next;return e.next=n,n.prev=e,n.next=s,s&&(s.prev=n),n}remove(e){return this.value.remove(e)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}}class Gt{constructor(){o(this,"dummyHead"),o(this,"last"),o(this,"nodeMapByIndex"),o(this,"nodeMapByCreatedAt");const e=F.of(0,Pt);e.setRemovedAt(Pt),this.dummyHead=new bs(e),this.last=this.dummyHead,this.nodeMapByIndex=new Wt,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}static create(){return new Gt}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(e,t){let n=this.nodeMapByCreatedAt.get(e.toIDString());if(!n)throw new g(d.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);for(;n.getNext()&&n.getNext().getPositionedAt().after(t);)n=n.getNext();return n}release(e){this.last===e&&(this.last=e.getPrev()),e.release(),this.nodeMapByIndex.delete(e),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}insertAfter(e,t,n=t.getCreatedAt()){const s=this.findNextBeforeExecutedAt(e,n),i=bs.createAfter(s,t);s===this.last&&(this.last=i),this.nodeMapByIndex.insertAfter(s,i),this.nodeMapByCreatedAt.set(i.getCreatedAt().toIDString(),i)}moveAfter(e,t,n){const s=this.nodeMapByCreatedAt.get(e.toIDString());if(!s)throw new g(d.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);const i=this.nodeMapByCreatedAt.get(t.toIDString());if(!i)throw new g(d.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);s!==i&&(!i.getValue().getMovedAt()||n.after(i.getValue().getMovedAt()))&&(this.release(i),this.insertAfter(s.getCreatedAt(),i.getValue(),n),i.getValue().setMovedAt(n))}insert(e){this.insertAfter(this.last.getCreatedAt(),e)}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return String(this.nodeMapByIndex.indexOf(t))}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new g(d.ErrInvalidArgument,`fail to find the given createdAt: ${e.getCreatedAt().toIDString()}`);this.release(t)}getByIndex(e){if(e>=this.length)return;const[t,n]=this.nodeMapByIndex.find(e);let s=t;if(e===0&&t===this.dummyHead||n>0)do s&&(s=s.getNext());while(s&&s.isRemoved());return s}getPrevCreatedAt(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());do t=t.getPrev();while(this.dummyHead!==t&&t.isRemoved());return t.getValue().getCreatedAt()}delete(e,t){const n=this.nodeMapByCreatedAt.get(e.toIDString()),s=n.isRemoved();return n.remove(t)&&!s&&this.nodeMapByIndex.splayNode(n),n.getValue()}deleteByIndex(e,t){const n=this.getByIndex(e);if(n)return n.remove(t)&&this.nodeMapByIndex.splayNode(n),n.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){const e=[];for(const t of this){const n=`${t.getCreatedAt().toIDString()}:${t.getValue().toJSON()}`;t.isRemoved()?e.push(`{${n}}`):e.push(`[${n}]`)}return e.join("")}*[Symbol.iterator](){let e=this.dummyHead.getNext();for(;e;)yield e,e=e.getNext()}}class se extends nt{constructor(e,t){super(e),o(this,"elements"),this.elements=t}static create(e,t){if(!t)return new se(e,Gt.create());const n=Gt.create();for(const s of t)n.insertAfter(n.getLastCreatedAt(),s.deepcopy());return new se(e,n)}subPathOf(e){return this.elements.subPathOf(e)}purge(e){this.elements.purge(e)}insertAfter(e,t){this.elements.insertAfter(e,t)}moveAfter(e,t,n){this.elements.moveAfter(e,t,n)}get(e){const t=this.elements.getByIndex(e);return t==null?void 0:t.getValue()}getByID(e){const t=this.elements.getByID(e);return t==null?void 0:t.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(e){return this.elements.getPrevCreatedAt(e)}delete(e,t){return this.elements.delete(e,t)}deleteByIndex(e,t){return this.elements.deleteByIndex(e,t)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(const e of this.elements)e.isRemoved()||(yield e.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(e){for(const t of this.elements){const n=t.getValue();if(e(n,this))return;n instanceof nt&&n.getDescendants(e)}}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){const e=[];for(const t of this)e.push(t.toJSON());return`[${e.join(",")}]`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(let t=0;t<this.length;t++){const{createdAt:n,value:s,type:i}=this.get(t).toJSForTest();e[t]={key:String(t),createdAt:n,value:s,type:i}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){const e=se.create(this.getCreatedAt());for(const t of this.elements)e.elements.insertAfter(e.getLastCreatedAt(),t.getValue().deepcopy());return e.remove(this.getRemovedAt()),e}}class st extends de{constructor(e,t,n){super(e,n),o(this,"createdAt"),this.createdAt=t}static create(e,t,n){return new st(e,t,n)}execute(e,t){var n;const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof nt))throw new g(d.ErrInvalidArgument,`only object and array can execute remove: ${s}`);if(t===q.UndoRedo){let l=s.getByID(this.createdAt);for(;l;){if(l.getRemovedAt())return;l=(n=e.findElementPairByCreatedAt(l.getCreatedAt()))==null?void 0:n.parent}}const i=s.subPathOf(this.createdAt),a=this.toReverseOperation(s),c=s.delete(this.createdAt,this.getExecutedAt());return e.registerRemovedElement(c),{opInfos:s instanceof se?[{type:"remove",path:e.createPath(this.getParentCreatedAt()),index:Number(i)}]:[{type:"remove",path:e.createPath(this.getParentCreatedAt()),key:i}],reverseOp:a}}toReverseOperation(e){if(e instanceof ee){const t=e.subPathOf(this.createdAt);if(t!==void 0){const n=e.get(t);if(n!==void 0)return mt.create(t,n.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.REMOVE.${this.createdAt.toTestString()}`}getCreatedAt(){return this.createdAt}}class mt extends de{constructor(e,t,n,s){super(n,s),o(this,"key"),o(this,"value"),this.key=e,this.value=t}static create(e,t,n,s){return new mt(e,t,n,s)}execute(e,t){var n;const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof ee))throw new g(d.ErrInvalidArgument,"fail to execute, only object can execute set");if(t===q.UndoRedo){let l=s;for(;l;){if(l.getRemovedAt())return;l=(n=e.findElementPairByCreatedAt(l.getCreatedAt()))==null?void 0:n.parent}}const i=s.get(this.key),a=this.toReverseOperation(i),c=this.value.deepcopy(),h=s.set(this.key,c,this.getExecutedAt());return t===q.UndoRedo&&e.findByCreatedAt(c.getCreatedAt())&&e.deregisterElement(c),e.registerElement(c,s),h&&e.registerRemovedElement(h),{opInfos:[{type:"set",path:e.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:a}}toReverseOperation(e){let t=st.create(this.getParentCreatedAt(),this.value.getCreatedAt());return e!==void 0&&!e.isRemoved()&&(t=mt.create(this.key,e.deepcopy(),this.getParentCreatedAt())),t}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.SET.${this.key}=${this.value.toSortedJSON()}`}getKey(){return this.key}getValue(){return this.value}}class Ht extends de{constructor(e,t,n,s){super(e,s),o(this,"prevCreatedAt"),o(this,"value"),this.prevCreatedAt=t,this.value=n}static create(e,t,n,s){return new Ht(e,t,n,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(t instanceof se))throw new g(d.ErrInvalidArgument,"fail to execute, only array can execute add");const n=t,s=this.value.deepcopy();return n.insertAfter(this.prevCreatedAt,s),e.registerElement(s,n),{opInfos:[{type:"add",path:e.createPath(this.getParentCreatedAt()),index:Number(n.subPathOf(this.getEffectedCreatedAt()))}]}}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ADD.${this.value.toJSON()}`}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}}class it extends de{constructor(e,t,n,s){super(e,s),o(this,"prevCreatedAt"),o(this,"createdAt"),this.prevCreatedAt=t,this.createdAt=n}static create(e,t,n,s){return new it(e,t,n,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(t instanceof se))throw new g(d.ErrInvalidArgument,"fail to execute, only array can execute move");const n=t,s=Number(n.subPathOf(this.createdAt));n.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());const i=Number(n.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:e.createPath(this.getParentCreatedAt()),index:i,previousIndex:s}]}}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.MOVE`}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}}class pt{constructor(e,t,n,s){o(this,"key"),o(this,"value"),o(this,"updatedAt"),o(this,"_isRemoved"),this.key=e,this.value=t,this.updatedAt=n,this._isRemoved=s}static of(e,t,n,s){return new pt(e,t,n,s)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return`${this.updatedAt.toIDString()}:${this.key}`}getRemovedAt(){if(this._isRemoved)return this.updatedAt}getDataSize(){return{data:(this.key.length+this.value.length)*2,meta:rt}}}class Ye{constructor(){o(this,"nodeMapByKey"),o(this,"numberOfRemovedElement"),this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}static create(){return new Ye}getNodeMapByKey(){return this.nodeMapByKey}set(e,t,n){const s=this.nodeMapByKey.get(e);if(s&&s.isRemoved()&&n.after(s.getUpdatedAt())&&(this.numberOfRemovedElement-=1),s===void 0||n.after(s.getUpdatedAt())){const i=pt.of(e,t,n,!1);return this.nodeMapByKey.set(e,i),s!==void 0&&s.isRemoved()?[s,i]:[void 0,i]}return s.isRemoved()?[s,void 0]:[void 0,void 0]}setInternal(e,t,n,s){const i=pt.of(e,t,n,s);this.nodeMapByKey.set(e,i),s&&this.numberOfRemovedElement++}remove(e,t){const n=this.nodeMapByKey.get(e),s=[];if(n===void 0||t.after(n.getUpdatedAt())){if(n===void 0){this.numberOfRemovedElement+=1;const c=pt.of(e,"",t,!0);return this.nodeMapByKey.set(e,c),s.push(c),s}const i=n.isRemoved();i||(this.numberOfRemovedElement+=1),i&&s.push(n);const a=pt.of(e,n.getValue(),t,!0);return this.nodeMapByKey.set(e,a),s.push(a),s}return s}has(e){if(this.nodeMapByKey.has(e)){const t=this.nodeMapByKey.get(e);return t!==void 0&&!t.isRemoved()}return!1}get(e){if(this.nodeMapByKey.has(e))return this.nodeMapByKey.get(e).getValue()}deepcopy(){const e=new Ye;for(const[,t]of this.nodeMapByKey)e.setInternal(t.getKey(),t.getValue(),t.getUpdatedAt(),t.isRemoved());return e}toJSON(){if(!this.size())return"{}";const e=[];for(const[t,n]of this.nodeMapByKey)n.isRemoved()||e.push(`"${Re(t)}":"${Re(n.getValue())}"`);return`{${e.join(",")}}`}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){const e={};for(const[t,n]of this.nodeMapByKey)n.isRemoved()||(e[t]=n.getValue());return e}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}purge(e){const t=this.nodeMapByKey.get(e.getKey());t==null||t.toIDString()!=e.toIDString()||(this.nodeMapByKey.delete(e.getKey()),this.numberOfRemovedElement--)}}function me(r){if(r instanceof Map){const e=Array.from(r);return new Map(JSON.parse(JSON.stringify(e)))}return JSON.parse(JSON.stringify(r))}const na=r=>r?Object.entries(r).length===0:!0,Ct=r=>{const e={};for(const[t,n]of Object.entries(r))e[t]=JSON.stringify(n);return e},Xe=r=>{const e={};for(const[t,n]of Object.entries(r))e[t]=JSON.parse(n);return e};class Yt{constructor(e){o(this,"attributes"),o(this,"content"),this.attributes=Ye.create(),this.content=e}static create(e){return new Yt(e)}get length(){return this.content.length}substring(e,t){const n=new Yt(this.content.substring(e,t));return n.attributes=this.attributes.deepcopy(),n}setAttr(e,t,n){return this.attributes.set(e,t,n)}getAttrs(){return this.attributes}toString(){return this.content}getDataSize(){const e={data:0,meta:0};e.data+=this.content.length*2;for(const t of this.attributes){const n=t.getDataSize();e.meta+=n.meta,e.data+=n.data}return e}toJSON(){const e=Re(this.content),t=this.attributes.toObject(),n=[];for(const[s,i]of Object.entries(t)){const a=JSON.parse(i),c=typeof a=="string"?`"${Re(s)}":"${Re(a)}"`:`"${Re(s)}":${String(a)}`;n.push(c)}return n.sort(),n.length===0?`{"val":"${e}"}`:`{"attrs":{${n.join(",")}},"val":"${e}"}`}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(e){this.attributes&&e instanceof pt&&this.attributes.purge(e)}getGCPairs(){const e=[];for(const t of this.attributes)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}class le extends Kt{constructor(e,t){super(t),o(this,"rgaTreeSplit"),this.rgaTreeSplit=e}static create(e,t){return new le(e,t)}edit(e,t,n,s,i){const a=t?Yt.create(t):void 0;if(a&&s)for(const[m,v]of Object.entries(s))a.setAttr(m,v,n);const[c,h,l]=this.rgaTreeSplit.edit(e,n,a,i);return[l.map(m=>({...m,value:m.value?{attributes:Xe(m.value.getAttributes()),content:m.value.getContent()}:{attributes:void 0,content:""},type:"content"})),h,[c,c]]}setStyle(e,t,n,s){const[,i]=this.rgaTreeSplit.findNodeWithSplit(e[1],n),[,a]=this.rgaTreeSplit.findNodeWithSplit(e[0],n),c=[],h=this.rgaTreeSplit.findBetween(a,i),l=[];for(const m of h){const v=m.getCreatedAt().getActorID();let y=Vt;s!=null&&(y=s.get(v)?s.get(v):0n),m.canStyle(n,y)&&l.push(m)}const f=[];for(const m of l){if(m.isRemoved())continue;const[v,y]=this.rgaTreeSplit.findIndexesFromRange(m.createPosRange());c.push({type:"style",actor:n.getActorID(),from:v,to:y,value:{attributes:Xe(t)}});for(const[S,I]of Object.entries(t)){const[A]=m.getValue().setAttr(S,I,n);A!==void 0&&f.push({parent:m.getValue(),child:A})}}return[f,c]}indexRangeToPosRange(e,t){const n=this.rgaTreeSplit.indexToPos(e);return e===t?[n,n]:[n,this.rgaTreeSplit.indexToPos(t)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}getDataSize(){const e={data:0,meta:0};for(const t of this.rgaTreeSplit){if(t.isRemoved())continue;const n=t.getDataSize();e.data+=n.data,e.meta+=n.meta}return{data:e.data,meta:e.meta+this.getMetaUsage()}}toJSON(){const e=[];for(const t of this.rgaTreeSplit)t.isRemoved()||e.push(t.getValue().toJSON());return`[${e.join(",")}]`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){const e=[];for(const t of this.rgaTreeSplit)if(!t.isRemoved()){const n=t.getValue();e.push({attributes:Xe(n.getAttributes()),content:n.getContent()})}return e}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){const e=new le(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return e.remove(this.getRemovedAt()),e}findIndexesFromRange(e){return this.rgaTreeSplit.findIndexesFromRange(e)}getGCPairs(){const e=[];for(const t of this.rgaTreeSplit){t.getRemovedAt()&&e.push({parent:this.rgaTreeSplit,child:t});for(const n of t.getValue().getGCPairs())e.push(n)}return e}}class Xt extends de{constructor(e,t,n,s,i,a){super(e,a),o(this,"fromPos"),o(this,"toPos"),o(this,"content"),o(this,"attributes"),this.fromPos=t,this.toPos=n,this.content=s,this.attributes=i}static create(e,t,n,s,i,a){return new Xt(e,t,n,s,i,a)}execute(e,t,n){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof le))throw new g(d.ErrInvalidArgument,"fail to execute, only Text can execute edit");const i=s,[a,c]=i.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),n);for(const h of c)e.registerGCPair(h);return{opInfos:a.map(({from:h,to:l,value:f})=>({type:"edit",from:h,to:l,value:f,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),n=this.toPos.toTestString(),s=this.content;return`${e}.EDIT(${t},${n},${s})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}}class Zt extends de{constructor(e,t,n,s,i){super(e,i),o(this,"fromPos"),o(this,"toPos"),o(this,"attributes"),this.fromPos=t,this.toPos=n,this.attributes=s}static create(e,t,n,s,i){return new Zt(e,t,n,s,i)}execute(e,t,n){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof le))throw new g(d.ErrInvalidArgument,"fail to execute, only Text can execute edit");const i=s,[a,c]=i.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),n);for(const h of a)e.registerGCPair(h);return{opInfos:c.map(({from:h,to:l,value:f})=>({type:"style",from:h,to:l,value:f,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),n=this.toPos.toTestString(),s=this.attributes;return`${e}.STYL(${t},${n},${JSON.stringify(s)})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}}const Ku=2,ju="root",Be="text";function Qt(r,e){let t=0;const n=r.children;for(let s=0;s<e;s++){const i=n[s];!i||i.isRemoved||(t+=i.paddedSize)}return t}class Wu{constructor(e,t=[]){if(o(this,"type"),o(this,"parent"),o(this,"_children"),o(this,"size"),this.type=e,this.size=0,this._children=t,this.isText&&this._children.length>0)throw new g(d.ErrRefused,"Text node cannot have children")}updateAncestorsSize(){let e=this.parent;const t=this.isRemoved?-1:1;for(;e&&(e.size+=this.paddedSize*t,!e.isRemoved);)e=e.parent}updateDescendantsSize(){let e=0;for(const t of this._children){const n=t.updateDescendantsSize();t.isRemoved||(e+=n)}return this.size+=e,this.paddedSize}get isText(){return this.type===Be}get paddedSize(){return this.size+(this.isText?0:Ku)}isAncestorOf(e){return Gu(this,e)}get nextSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e+1];if(t)return t}get prevSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e-1];if(t)return t}splitText(e,t){if(e===0||e===this.size)return;const n=this.value.slice(0,e),s=this.value.slice(e);if(!s.length)return;this.value=n;const i=this.cloneText(e+t);return i.value=s,this.parent.insertAfterInternal(i,this),i}get children(){return this._children.filter(e=>!e.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(e=>e.isText)}getChildrenText(){return this.isText?this.value:this.hasTextChild()?this.children.map(e=>e.value).join(""):""}append(...e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");this._children.push(...e);for(const t of e)t.parent=this,t.updateAncestorsSize()}prepend(...e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");this._children.unshift(...e);for(const t of e)t.parent=this}insertBefore(e,t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");const n=this._children.indexOf(t);if(n===-1)throw new g(d.ErrInvalidArgument,"child not found");this.insertAtInternal(e,n),e.updateAncestorsSize()}insertAfter(e,t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");const n=this._children.indexOf(t);if(n===-1)throw new g(d.ErrInvalidArgument,"child not found");this.insertAtInternal(e,n+1),e.updateAncestorsSize()}insertAt(e,t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");this.insertAtInternal(e,t),e.updateAncestorsSize()}removeChild(e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");const t=this._children.indexOf(e);if(t===-1)throw new g(d.ErrInvalidArgument,"child not found");this._children.splice(t,1),e.parent=void 0}splitElement(e,t){const n=this.cloneElement(t);this.parent.insertAfterInternal(n,this),n.updateAncestorsSize();const s=this.children.slice(0,e),i=this.children.slice(e);this._children=s,n._children=i,this.size=this._children.reduce((a,c)=>a+c.paddedSize,0),n.size=n._children.reduce((a,c)=>a+c.paddedSize,0);for(const a of n._children)a.parent=n;return n}insertAfterInternal(e,t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");const n=this._children.indexOf(t);if(n===-1)throw new g(d.ErrInvalidArgument,"child not found");this.insertAtInternal(e,n+1)}insertAtInternal(e,t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");this._children.splice(t,0,e),e.parent=this}findOffset(e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");if(e.isRemoved){const t=this._children.indexOf(e);return this.allChildren.splice(0,t).filter(s=>!s.isRemoved).length}return this.children.indexOf(e)}findBranchOffset(e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");let t=e;for(;t;){const n=this._children.indexOf(t);if(n!==-1)return n;t=t.parent}return-1}}function Gu(r,e){if(r===e)return!1;for(;e.parent;){if(e.parent===r)return!0;e=e.parent}return!1}var K=(r=>(r.Start="Start",r.End="End",r.Text="Text",r))(K||{});function sa(r,e,t,n){if(e>t)throw new g(d.ErrInvalidArgument,`from is greater than to: ${e} > ${t}`);if(e>r.size)throw new g(d.ErrInvalidArgument,`from is out of range: ${e} > ${r.size}`);if(t>r.size)throw new g(d.ErrInvalidArgument,`to is out of range: ${t} > ${r.size}`);if(e===t)return;let s=0;for(const i of r.children){if(e-i.paddedSize<s&&s<t){const a=i.isText?e-s:e-s-1,c=i.isText?t-s:t-s-1,h=!i.isText&&a<0,l=!i.isText&&c>i.size;(i.isText||h)&&n([i,i.isText?"Text":"Start"],l),sa(i,Math.max(0,a),Math.min(c,i.size),n),l&&n([i,"End"],l)}s+=i.paddedSize}}function ia(r,e,t=0){for(const n of r.children)ia(n,e,t+1);e(r,t)}function Is(r,e,t=0){for(const n of r._children)Is(n,e,t+1);e(r,t)}function ri(r,e,t=!0){if(e>r.size)throw new g(d.ErrInvalidArgument,`index is out of range: ${e} > ${r.size}`);if(r.isText)return{node:r,offset:e};let n=0,s=0;for(const i of r.children){if(t&&i.isText&&i.size>=e-s)return ri(i,e-s,t);if(e===s)return{node:r,offset:n};if(!t&&i.paddedSize===e-s)return{node:r,offset:n+1};if(i.paddedSize>e-s)return ri(i,e-s-1,t);s+=i.paddedSize,n+=1}return{node:r,offset:n}}function oa(r){return r.isText||r.children.length===0?r:oa(r.children[0])}function Hu(r,e){if(r.size<e)throw new g(d.ErrInvalidArgument,"unacceptable path");for(let t=0;t<r.children.length;t++){const n=r.children[t];if(n.size<e)e-=n.size;else{r=n;break}}return{node:r,offset:e}}class Yu{constructor(e){o(this,"root"),this.root=e}tokensBetween(e,t,n){sa(this.root,e,t,n)}traverse(e){ia(this.root,e,0)}traverseAll(e){Is(this.root,e,0)}findTreePos(e,t=!0){return ri(this.root,e,t)}treePosToPath(e){const t=[];let n=e.node;if(n.isText){const s=n.parent.findOffset(n);if(s===-1)throw new g(d.ErrInvalidArgument,"invalid treePos");const i=Qt(n.parent,s);t.push(i+e.offset),n=n.parent}else if(n.hasTextChild()){const s=Qt(n,e.offset);t.push(s)}else t.push(e.offset);for(;n.parent;){const s=n.parent.findOffset(n);if(s===-1)throw new g(d.ErrInvalidArgument,"invalid treePos");t.push(s),n=n.parent}return t.reverse()}pathToIndex(e){const t=this.pathToTreePos(e);return this.indexOf(t)}pathToTreePos(e){if(!e.length)throw new g(d.ErrInvalidArgument,"unacceptable path");let t=this.root;for(let n=0;n<e.length-1;n++){const s=e[n];if(t=t.children[s],!t)throw new g(d.ErrInvalidArgument,"unacceptable path")}if(t.hasTextChild())return Hu(t,e[e.length-1]);if(t.children.length<e[e.length-1])throw new g(d.ErrInvalidArgument,"unacceptable path");return{node:t,offset:e[e.length-1]}}getRoot(){return this.root}get size(){return this.root.size}findPostorderRight(e){const{node:t,offset:n}=e;if(t.isText){if(t.size===n){const s=t.nextSibling;return s||t.parent}return t}return t.children.length===n?t:oa(t.children[n])}indexOf(e){let{node:t}=e;const{offset:n}=e;let s=0,i=1;if(t.isText){s+=n;const a=t.parent,c=a.findOffset(t);if(c===-1)throw new g(d.ErrInvalidArgument,"invalid pos");s+=Qt(a,c),t=t.parent}else s+=Qt(t,n);for(;t!=null&&t.parent;){const a=t.parent,c=a.findOffset(t);if(c===-1)throw new g(d.ErrInvalidArgument,"invalid pos");s+=Qt(a,c),i++,t=t.parent}return s+i-1}indexToPath(e){const t=this.findTreePos(e);return this.treePosToPath(t)}}const Xu=(r,e)=>r===e?0:r<e?-1:1;class Zu{constructor(e,t,n){o(this,"key"),o(this,"value"),o(this,"parent"),o(this,"left"),o(this,"right"),o(this,"isRed"),this.key=e,this.value=t,this.isRed=n}}class Qu{constructor(e){o(this,"stack"),this.stack=[],this.traverseInorder(e)}traverseInorder(e){e&&(this.traverseInorder(e.left),this.stack.push({key:e.key,value:e.value}),this.traverseInorder(e.right))}}class aa{constructor(e){o(this,"root"),o(this,"comparator"),o(this,"counter"),this.comparator=typeof e<"u"?e:Xu,this.counter=0}put(e,t){return this.root=this.putInternal(e,t,this.root),this.root.isRed=!1,t}get(e){const t=this.getInternal(e,this.root);return t?t.value:void 0}remove(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.isRed=!0),this.root=this.removeInternal(this.root,e),this.root&&(this.root.isRed=!1)}getIterator(){return new Qu(this.root)}values(){const e=[];for(const t of this.getIterator().stack)e.push(t.value);return e}floorEntry(e){let t=this.root;for(;t;){const n=this.comparator(e,t.key);if(n>0)if(t.right)t.right.parent=t,t=t.right;else return t;else if(n<0)if(t.left)t.left.parent=t,t=t.left;else{let s=t.parent,i=t;for(;s&&i===s.left;)i=s,s=s.parent;return s}else return t}}lastEntry(){if(!this.root)return this.root;let e=this.root;for(;e.right;)e=e.right;return e}size(){return this.counter}isEmpty(){return this.counter===0}getInternal(e,t){for(;t;){const n=this.comparator(e,t.key);if(n===0)return t;n<0?t=t.left:n>0&&(t=t.right)}}putInternal(e,t,n){if(!n)return this.counter+=1,new Zu(e,t,!0);const s=this.comparator(e,n.key);return s<0?n.left=this.putInternal(e,t,n.left):s>0?n.right=this.putInternal(e,t,n.right):n.value=t,this.isRed(n.right)&&!this.isRed(n.left)&&(n=this.rotateLeft(n)),this.isRed(n.left)&&this.isRed(n.left.left)&&(n=this.rotateRight(n)),this.isRed(n.left)&&this.isRed(n.right)&&this.flipColors(n),n}removeInternal(e,t){if(this.comparator(t,e.key)<0)!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeInternal(e.left,t);else{if(this.isRed(e.left)&&(e=this.rotateRight(e)),this.comparator(t,e.key)===0&&!e.right){this.counter-=1;return}if(!this.isRed(e.right)&&!this.isRed(e.right.left)&&(e=this.moveRedRight(e)),this.comparator(t,e.key)===0){this.counter-=1;const n=this.min(e.right);e.value=n.value,e.key=n.key,e.right=this.removeMin(e.right)}else e.right=this.removeInternal(e.right,t)}return this.fixUp(e)}min(e){return e.left?this.min(e.left):e}removeMin(e){if(e.left)return!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeMin(e.left),this.fixUp(e)}fixUp(e){return this.isRed(e.right)&&(e=this.rotateLeft(e)),this.isRed(e.left)&&this.isRed(e.left.left)&&(e=this.rotateRight(e)),this.isRed(e.left)&&this.isRed(e.right)&&this.flipColors(e),e}moveRedLeft(e){return this.flipColors(e),this.isRed(e.right.left)&&(e.right=this.rotateRight(e.right),e=this.rotateLeft(e),this.flipColors(e)),e}moveRedRight(e){return this.flipColors(e),this.isRed(e.left.left)&&(e=this.rotateRight(e),this.flipColors(e)),e}isRed(e){return e&&e.isRed}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.isRed=t.left.isRed,t.left.isRed=!0,t}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.isRed=t.right.isRed,t.right.isRed=!0,t}flipColors(e){e.isRed=!e.isRed,e.left.isRed=!e.left.isRed,e.right.isRed=!e.right.isRed}}class pe{constructor(e,t){o(this,"parentID"),o(this,"leftSiblingID"),this.parentID=e,this.leftSiblingID=t}static of(e,t){return new pe(e,t)}static fromTreePos(e){const{offset:t}=e;let{node:n}=e,s;return n.isText?(n.parent.children[0]===n&&t===0?s=n.parent:s=n,n=n.parent):t===0?s=n:s=n.children[t-1],pe.of(n.id,H.of(s.getCreatedAt(),s.getOffset()+t))}getParentID(){return this.parentID}static fromStruct(e){return pe.of(H.of(ne.fromStruct(e.parentID.createdAt),e.parentID.offset),H.of(ne.fromStruct(e.leftSiblingID.createdAt),e.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(e){const t=this.getParentID(),n=this.getLeftSiblingID(),s=e.findFloorNode(t);let i=e.findFloorNode(n);if(!s||!i)throw new g(d.ErrRefused,`cannot find node of CRDTTreePos(${t.toTestString()}, ${n.toTestString()})`);return!n.equals(t)&&n.getOffset()>0&&n.getOffset()===i.id.getOffset()&&i.insPrevID&&(i=e.findFloorNode(i.insPrevID)),[s,i]}getLeftSiblingID(){return this.leftSiblingID}equals(e){return this.getParentID().getCreatedAt().equals(e.getParentID().getCreatedAt())&&this.getParentID().getOffset()===e.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(e.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===e.getLeftSiblingID().getOffset()}}class H{constructor(e,t){o(this,"createdAt"),o(this,"offset"),this.createdAt=e,this.offset=t}static of(e,t){return new H(e,t)}static fromStruct(e){return H.of(ne.fromStruct(e.createdAt),e.offset)}static createComparator(){return(e,t)=>{const n=e.getCreatedAt().compare(t.getCreatedAt());return n!==0?n:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}getOffset(){return this.offset}setOffset(e){this.offset=e}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}toTestString(){return`${this.createdAt.toTestString()}/${this.offset}`}}class ie extends Wu{constructor(e,t,n,s,i){super(t),o(this,"id"),o(this,"removedAt"),o(this,"attrs"),o(this,"insPrevID"),o(this,"insNextID"),o(this,"_value",""),this.id=e,this.removedAt=i,s&&(this.attrs=s),typeof n=="string"?this.value=n:Array.isArray(n)&&(this._children=n)}toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(e,t,n,s){return new ie(e,t,n,s)}deepcopy(){var e;const t=new ie(this.id,this.type);return t.removedAt=this.removedAt,t._value=this._value,t.size=this.size,t.attrs=(e=this.attrs)==null?void 0:e.deepcopy(),t._children=this._children.map(n=>{const s=n.deepcopy();return s.parent=t,s}),t.insPrevID=this.insPrevID,t.insNextID=this.insNextID,t}get value(){if(!this.isText)throw new g(d.ErrInvalidType,`cannot get value of element node: ${this.type}`);return this._value}set value(e){if(!this.isText)throw new g(d.ErrInvalidType,`cannot set value of element node: ${this.type}`);this._value=e,this.size=e.length}get isRemoved(){return!!this.removedAt}remove(e){const t=!this.removedAt;(!this.removedAt||this.removedAt.compare(e)>0)&&(this.removedAt=e),t&&this.updateAncestorsSize()}cloneText(e){return new ie(H.of(this.id.getCreatedAt(),e),this.type,void 0,void 0,this.removedAt)}cloneElement(e){return new ie(H.of(e(),0),this.type,void 0,void 0,this.removedAt)}split(e,t,n){const s=this.isText?this.splitText(t,this.id.getOffset()):this.splitElement(t,n);if(s){if(s.insPrevID=this.id,this.insNextID){const i=e.findFloorNode(this.insNextID);i.insPrevID=s.id,s.insNextID=this.insNextID}this.insNextID=s.id,e.registerNode(s)}return s}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(e,t){return this.getCreatedAt().getLamport()<=t&&(!this.removedAt||e.after(this.removedAt))}canStyle(e,t){return this.isText?!1:this.getCreatedAt().getLamport()<=t&&(!this.removedAt||e.after(this.removedAt))}setAttrs(e,t){this.attrs||(this.attrs=new Ye);const n=[];for(const[s,i]of Object.entries(e))n.push(this.attrs.set(s,i,t));return n}purge(e){this.attrs&&this.attrs.purge(e)}getDataSize(){const e={data:0,meta:0};if(this.isText&&(e.data+=this.size*2),this.id&&(e.meta+=rt),this.removedAt&&(e.meta+=rt),this.attrs)for(const t of this.attrs){if(t.getRemovedAt())continue;const n=t.getDataSize();e.meta+=n.meta,e.data+=n.data}return e}getGCPairs(){const e=[];if(!this.attrs)return e;for(const t of this.attrs)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}function ni(r){var e;if(r.isText){const n=r;return{type:n.type,value:n.value}}const t={type:r.type,children:r.children.map(ni)};return r.attrs&&(t.attributes=Xe((e=r.attrs)==null?void 0:e.toObject())),t}function si(r){if(r.isText)return r.value;let e="";return r.attrs&&r.attrs.size()&&(e=" "+Array.from(r.attrs).filter(t=>!t.isRemoved()).sort((t,n)=>t.getKey().localeCompare(n.getKey())).map(t=>{const n=JSON.parse(t.getValue());return typeof n=="string"?`${t.getKey()}="${n}"`:`${t.getKey()}="${Re(t.getValue())}"`}).join(" ")),`<${r.type}${e}>${r.children.map(t=>si(t)).join("")}</${r.type}>`}function ca(r){if(r.isText){const e=r;return{type:e.type,value:e.value,size:e.size,isRemoved:e.isRemoved}}return{type:r.type,children:r.children.map(ca),size:r.size,isRemoved:r.isRemoved}}class fe extends Kt{constructor(e,t){super(t),o(this,"indexTree"),o(this,"nodeMapByID"),this.indexTree=new Yu(e),this.nodeMapByID=new aa(H.createComparator()),this.indexTree.traverseAll(n=>{this.nodeMapByID.put(n.id,n)})}static create(e,t){return new fe(e,t)}findFloorNode(e){const t=this.nodeMapByID.floorEntry(e);if(!(!t||!t.key.getCreatedAt().equals(e.getCreatedAt())))return t.value}registerNode(e){this.nodeMapByID.put(e.id,e)}findNodesAndSplitText(e,t){const[n,s]=e.toTreeNodePair(this);let i=s;const a=n===i,c=i.parent&&!a?i.parent:n;if(i.isText&&i.split(this,e.getLeftSiblingID().getOffset()-i.id.getOffset()),t){const h=c.allChildren,l=a?0:h.indexOf(i)+1;for(let f=l;f<h.length;f++){const m=h[f];if(!m.id.getCreatedAt().after(t))break;i=m}}return[c,i]}style(e,t,n,s){const[i,a]=this.findNodesAndSplitText(e[0],n),[c,h]=this.findNodesAndSplitText(e[1],n),l=[],f=t?Xe(t):{},m=[];return this.traverseInPosRange(i,a,c,h,([v])=>{const y=v.getCreatedAt().getActorID();let S=Vt;if(s!=null&&(S=s.get(y)?s.get(y):0n),v.canStyle(n,S)&&t){const I=v.setAttrs(t,n),A=I.reduce((R,[,$])=>($&&(R[$.getKey()]=f[$.getKey()]),R),{}),B=v.parent,C=v.prevSibling||v.parent;Object.keys(A).length>0&&l.push({type:"style",from:this.toIndex(B,C),to:this.toIndex(v,v),fromPath:this.toPath(B,C),toPath:this.toPath(v,v),actor:n.getActorID(),value:A});for(const[R]of I)R&&m.push({parent:v,child:R})}}),[m,l]}removeStyle(e,t,n,s){const[i,a]=this.findNodesAndSplitText(e[0],n),[c,h]=this.findNodesAndSplitText(e[1],n),l=[],f=[];return this.traverseInPosRange(i,a,c,h,([m])=>{const v=m.getCreatedAt().getActorID();let y=Vt;if(s!=null&&(y=s.get(v)?s.get(v):0n),m.canStyle(n,y)&&t){m.attrs||(m.attrs=new Ye);for(const A of t){const B=m.attrs.remove(A,n);for(const C of B)f.push({parent:m,child:C})}const S=m.parent,I=m.prevSibling||m.parent;l.push({actor:n.getActorID(),type:"removeStyle",from:this.toIndex(S,I),to:this.toIndex(m,m),fromPath:this.toPath(S,I),toPath:this.toPath(m,m),value:t})}}),[f,l]}edit(e,t,n,s,i,a){const[c,h]=this.findNodesAndSplitText(e[0],s),[l,f]=this.findNodesAndSplitText(e[1],s),m=this.toIndex(c,h),v=this.toPath(c,h),y=[],S=[],I=[];this.traverseInPosRange(c,h,l,f,([C,R],$)=>{if(R===K.Start&&!$)for(const St of C.children)I.push(St);const G=C.getCreatedAt().getActorID();let Te=Vt;a!=null&&(Te=a.get(G)?a.get(G):0n),(C.canDelete(s,Te)||y.includes(C.parent))&&((R===K.Text||R===K.Start)&&y.push(C),S.push([C,R]))});const A=this.makeDeletionChanges(S,s),B=[];for(const C of y)C.remove(s),C.isRemoved&&B.push({parent:this,child:C});for(const C of I)C.removedAt||c.append(C);if(n>0){let C=0,R=c,$=h;for(;C<n;)R.split(this,R.findOffset($)+1,i),$=R,R=R.parent,C++;A.push({type:"content",from:m,to:m,fromPath:v,toPath:v,actor:s.getActorID()})}if(t!=null&&t.length){const C=[];let R=h;for(const $ of t)R===c?c.insertAt($,0):c.insertAfter($,R),R=$,Is($,G=>{c.isRemoved&&(G.remove(s),B.push({parent:this,child:G})),this.nodeMapByID.put(G.id,G)}),$.isRemoved||C.push($);if(C.length){const $=C.map(G=>ni(G));A.length&&A[A.length-1].from===m?A[A.length-1].value=$:A.push({type:"content",from:m,to:m,fromPath:v,toPath:v,actor:s.getActorID(),value:$})}}return[A,B]}editT(e,t,n,s,i){const a=this.findPos(e[0]),c=this.findPos(e[1]);this.edit([a,c],t,n,s,i)}move(e,t,n){throw new g(d.ErrUnimplemented,`not implemented: ${e}, ${t}, ${n}`)}pathToTreePos(e){return this.indexTree.pathToTreePos(e)}purge(e){var t;(t=e.parent)==null||t.removeChild(e),this.nodeMapByID.remove(e.id);const n=e.insPrevID,s=e.insNextID;if(n){const i=this.findFloorNode(n);i.insNextID=s}if(s){const i=this.findFloorNode(s);i.insPrevID=n}e.insPrevID=void 0,e.insNextID=void 0}getGCPairs(){const e=[];return this.indexTree.traverse(t=>{t.getRemovedAt()&&e.push({parent:this,child:t});for(const n of t.getGCPairs())e.push(n)}),e}findPos(e,t=!0){const n=this.indexTree.findTreePos(e,t);return pe.fromTreePos(n)}pathToPosRange(e){const t=this.pathToIndex(e);return[this.findPos(t),this.findPos(t+1)]}pathToPos(e){const t=this.indexTree.pathToIndex(e);return this.findPos(t)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return si(this.indexTree.getRoot())}getDataSize(){const e={data:0,meta:0};return this.indexTree.traverse(t=>{if(t.getRemovedAt())return;const n=t.getDataSize();e.data+=n.data,e.meta+=n.meta}),{data:e.data,meta:e.meta+this.getMetaUsage()}}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){const e=this.indexTree.getRoot(),t=(n,s=void 0,i=void 0,a=0)=>{var c,h,l,f;let m,v,y;const S=n.isText?{node:n,offset:0}:s&&i?this.toTreePos(s,i):null;S&&(m=this.indexTree.indexOf(S),v=this.indexTree.treePosToPath(S),y=pe.fromTreePos(S).toStruct());const I={type:n.type,parent:s==null?void 0:s.id.toTestString(),size:n.size,id:n.id.toTestString(),removedAt:(c=n.removedAt)==null?void 0:c.toTestString(),insPrev:(h=n.insPrevID)==null?void 0:h.toTestString(),insNext:(l=n.insNextID)==null?void 0:l.toTestString(),value:n.isText?n.value:void 0,isRemoved:n.isRemoved,children:[],depth:a,attributes:n.attrs?Xe((f=n.attrs)==null?void 0:f.toObject()):void 0,index:m,path:v,pos:y};for(let A=0;A<n.allChildren.length;A++){const B=A===0?n:n.allChildren[A-1];I.children.push(t(n.allChildren[A],n,B,a+1))}return I};return t(e)}getRootTreeNode(){return ni(this.indexTree.getRoot())}toTestTreeNode(){return ca(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){const e=this.getRoot();return new fe(e.deepcopy(),this.getCreatedAt())}toPath(e,t){const n=this.toTreePos(e,t);return n?this.indexTree.treePosToPath(n):[]}toIndex(e,t){const n=this.toTreePos(e,t);return n?this.indexTree.indexOf(n):-1}indexToPath(e){return this.indexTree.indexToPath(e)}pathToIndex(e){return this.indexTree.pathToIndex(e)}indexRangeToPosRange(e){const t=this.findPos(e[0]);return e[0]===e[1]?[t,t]:[t,this.findPos(e[1])]}indexRangeToPosStructRange(e){const[t,n]=e,s=this.findPos(t);return t===n?[s.toStruct(),s.toStruct()]:[s.toStruct(),this.findPos(n).toStruct()]}posRangeToPathRange(e){const[t,n]=this.findNodesAndSplitText(e[0]),[s,i]=this.findNodesAndSplitText(e[1]);return[this.toPath(t,n),this.toPath(s,i)]}posRangeToIndexRange(e){const[t,n]=this.findNodesAndSplitText(e[0]),[s,i]=this.findNodesAndSplitText(e[1]);return[this.toIndex(t,n),this.toIndex(s,i)]}traverseInPosRange(e,t,n,s,i){const a=this.toIndex(e,t),c=this.toIndex(n,s);return this.indexTree.tokensBetween(a,c,i)}toTreePos(e,t){if(!e||!t)return;if(e.isRemoved){let s;for(;e.isRemoved;)s=e,e=s.parent;const i=e.findOffset(s);return{node:e,offset:i}}if(e===t)return{node:e,offset:0};let n=e.findOffset(t);if(!t.isRemoved){if(t.isText)return{node:t,offset:t.paddedSize};n++}return{node:e,offset:n}}makeDeletionChanges(e,t){const n=[],s=[];let i=null,a=null;for(let c=0;c<e.length;c++){const h=e[c],l=e[c+1];i||(i=h),a=h;const f=this.findRightToken(h);(!f||!l||f[0]!==l[0]||f[1]!==l[1])&&(s.push([i,a]),i=null,a=null)}for(const c of s){const[h,l]=c,[f,m]=this.findLeftToken(h),[v,y]=l,S=m===K.Start?f:f.parent,I=y===K.Start?v:v.parent,A=this.toIndex(S,f),B=this.toIndex(I,v);A<B&&(n.length>0&&A===n[n.length-1].to?(n[n.length-1].to=B,n[n.length-1].toPath=this.toPath(I,v)):n.push({type:"content",from:A,to:B,fromPath:this.toPath(S,f),toPath:this.toPath(I,v),actor:t.getActorID()}))}return n.reverse()}findRightToken([e,t]){if(t===K.Start){const c=e.allChildren;return c.length>0?[c[0],c[0].isText?K.Text:K.Start]:[e,K.End]}const n=e.parent,s=n.allChildren,i=s.indexOf(e);if(n&&i===s.length-1)return[n,K.End];const a=s[i+1];return[a,a.isText?K.Text:K.Start]}findLeftToken([e,t]){if(t===K.End){const c=e.allChildren;if(c.length>0){const h=c[c.length-1];return[h,h.isText?K.Text:K.End]}return[e,K.Start]}const n=e.parent,s=n.allChildren,i=s.indexOf(e);if(n&&i===0)return[n,K.Start];const a=s[i-1];return[a,a.isText?K.Text:K.End]}}class er extends de{constructor(e,t,n,s,i,a){super(e,a),o(this,"fromPos"),o(this,"toPos"),o(this,"contents"),o(this,"splitLevel"),this.fromPos=t,this.toPos=n,this.contents=s,this.splitLevel=i}static create(e,t,n,s,i,a){return new er(e,t,n,s,i,a)}execute(e,t,n){var s;const i=e.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof fe))throw new g(d.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const a=this.getExecutedAt(),c=i,[h,l]=c.edit([this.fromPos,this.toPos],(s=this.contents)==null?void 0:s.map(f=>f.deepcopy()),this.splitLevel,a,(()=>{let f=a.getDelimiter();return this.contents!==void 0&&(f+=this.contents.length),()=>ne.of(a.getLamport(),++f,a.getActorID())})(),n);for(const f of l)e.registerGCPair(f);return{opInfos:h.map(({from:f,to:m,value:v,splitLevel:y,fromPath:S,toPath:I})=>({type:"tree-edit",path:e.createPath(this.getParentCreatedAt()),from:f,to:m,value:v,splitLevel:y,fromPath:S,toPath:I}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.fromPos.getLeftSiblingID().getOffset()}`,n=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.toPos.getLeftSiblingID().getOffset()}`,s=this.contents||[];return`${e}.EDIT(${t},${n},${s.map(i=>si(i)).join("")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}}class yt{constructor(e){o(this,"vector"),this.vector=e||new Map}set(e,t){this.vector.set(e,t)}unset(e){this.vector.delete(e)}get(e){return this.vector.get(e)}maxLamport(){let e=BigInt(0);for(const[,t]of this)t>e&&(e=t);return e}max(e){const t=new Map;for(const[n,s]of e){const i=this.vector.get(n),a=i&&i>s?i:s;t.set(n,a)}for(const[n,s]of this){const i=e.get(n),a=i&&i>s?i:s;t.set(n,a)}return new yt(t)}afterOrEqual(e){const t=this.vector.get(e.getActorID());return t===void 0?!1:t>=e.getLamport()}deepcopy(){const e=new Map;for(const[t,n]of this.vector)e.set(t,n);return new yt(e)}filter(e){const t=new Map;for(const[n]of e){const s=this.vector.get(n);s!==void 0&&t.set(n,s)}return new yt(t)}size(){return this.vector.size}*[Symbol.iterator](){for(const[e,t]of this.vector)yield[e,t]}}const ua=new yt(new Map);class ye{constructor(e,t,n,s,i){o(this,"clientSeq"),o(this,"serverSeq"),o(this,"actor"),o(this,"lamport"),o(this,"versionVector"),this.clientSeq=e,this.serverSeq=i,this.lamport=t,this.versionVector=s,this.actor=n}hasClocks(){return this.versionVector.size()>0&&this.lamport!=Zs}static of(e,t,n,s,i){return new ye(e,t,n,s,i)}next(e=!1){if(e)return new ye(this.clientSeq+1,this.lamport,this.actor,ua,Zs);const t=this.versionVector.deepcopy();return t.set(this.actor,this.lamport+1n),new ye(this.clientSeq+1,this.lamport+1n,this.actor,t)}syncClocks(e){if(!e.hasClocks())return this;const t=e.lamport>this.lamport?e.lamport+1n:this.lamport+1n,n=this.versionVector.max(e.versionVector),s=new ye(this.clientSeq,t,this.actor,n);return s.versionVector.set(this.actor,t),s}setClocks(e,t){const n=e>this.lamport?e+1n:this.lamport+1n;t.unset(Ts);const s=this.versionVector.max(t);return s.set(this.actor,n),ye.of(this.clientSeq,n,this.actor,s)}createTimeTicket(e){return ne.of(this.lamport,e,this.actor)}setActor(e){return new ye(this.clientSeq,this.lamport,e,this.versionVector,this.serverSeq)}setLamport(e){return new ye(this.clientSeq,e,this.actor,this.versionVector,this.serverSeq)}setVersionVector(e){return new ye(this.clientSeq,this.lamport,this.actor,e,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}getVersionVector(){return this.versionVector}toTestString(){return`${this.lamport.toString()}:${this.actor.slice(-2)}:${this.clientSeq}`}}const eh=new ye(0,0n,Ts,ua);class vt{constructor({id:e,operations:t,presenceChange:n,message:s}){o(this,"id"),o(this,"operations"),o(this,"presenceChange"),o(this,"message"),this.id=e,this.operations=t||[],this.presenceChange=n,this.message=s}static create({id:e,operations:t,presenceChange:n,message:s}){return new vt({id:e,operations:t,presenceChange:n,message:s})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(e){for(const t of this.operations)t.setActor(e);this.id=this.id.setActor(e)}hasPresenceChange(){return this.presenceChange!==void 0}getPresenceChange(){return this.presenceChange}execute(e,t,n){const s=[],i=[];for(const a of this.operations){const c=a.execute(e,n,this.id.getVersionVector());if(!c)continue;const{opInfos:h,reverseOp:l}=c;s.push(...h),l&&i.unshift(l)}return this.presenceChange&&(this.presenceChange.type===Oe.Put?t.set(this.id.getActorID(),me(this.presenceChange.presence)):t.delete(this.id.getActorID())),{opInfos:s,reverseOps:i}}toTestString(){return`${this.operations.map(e=>e.toTestString()).join(",")}`}toStruct(){return{changeID:z.bytesToHex(z.toChangeID(this.getID()).toBinary()),message:this.getMessage(),operations:this.getOperations().map(e=>z.bytesToHex(z.toOperation(e).toBinary())),presenceChange:this.getPresenceChange()}}static fromStruct(e){const{changeID:t,operations:n,presenceChange:s,message:i}=e;return vt.create({id:z.bytesToChangeID(z.hexToBytes(t)),operations:n==null?void 0:n.map(a=>z.bytesToOperation(z.hexToBytes(a))),presenceChange:s,message:i})}}class As{constructor(e,t,n,s,i,a){o(this,"documentKey"),o(this,"checkpoint"),o(this,"isRemoved"),o(this,"changes"),o(this,"snapshot"),o(this,"versionVector"),this.documentKey=e,this.checkpoint=t,this.isRemoved=n,this.changes=s,this.snapshot=a,this.versionVector=i}static create(e,t,n,s,i,a){return new As(e,t,n,s,i,a)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getVersionVector(){return this.versionVector}}class Ot{constructor(e,t){o(this,"serverSeq"),o(this,"clientSeq"),this.serverSeq=e,this.clientSeq=t}static of(e,t){return new Ot(e,t)}increaseClientSeq(e){return e===0?this:new Ot(this.serverSeq,this.clientSeq+e)}forward(e){if(this.equals(e))return this;const t=this.serverSeq>e.serverSeq?this.serverSeq:e.serverSeq,n=Math.max(this.clientSeq,e.clientSeq);return Ot.of(t,n)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(e){return this.clientSeq===e.clientSeq&&this.serverSeq==e.serverSeq}toTestString(){return`serverSeq=${this.serverSeq}, clientSeq=${this.clientSeq}`}}const th=new Ot(0n,0);class Je{constructor(e,t){o(this,"createdAt"),o(this,"offset"),this.createdAt=e,this.offset=t}static of(e,t){return new Je(e,t)}static fromStruct(e){return Je.of(ne.fromStruct(e.createdAt),e.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}hasSameCreatedAt(e){return this.createdAt.compare(e.createdAt)===0}split(e){return new Je(this.createdAt,this.offset+e)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return`${this.createdAt.toTestString()}:${this.offset}`}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}}const rh=Je.of(Pt,0);class ve{constructor(e,t){o(this,"id"),o(this,"relativeOffset"),this.id=e,this.relativeOffset=t}static of(e,t){return new ve(e,t)}static fromStruct(e){const t=Je.fromStruct(e.id);return ve.of(t,e.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return Je.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return`${this.id.toTestString()}:${this.relativeOffset}`}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(e){return this.id.equals(e.id)?this.relativeOffset===e.relativeOffset:!1}}class ot extends Wo{constructor(e,t,n){super(t),o(this,"id"),o(this,"removedAt"),o(this,"prev"),o(this,"next"),o(this,"insPrev"),o(this,"insNext"),this.id=e,this.removedAt=n}static create(e,t){return new ot(e,t)}static createComparator(){return(e,t)=>{const n=e.getCreatedAt().compare(t.getCreatedAt());return n!==0?n:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(e){this.prev=e,e&&(e.next=this)}setNext(e){this.next=e,e&&(e.prev=this)}setInsPrev(e){this.insPrev=e,e&&(e.insNext=this)}setInsNext(e){this.insNext=e,e&&(e.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(e){return new ot(this.id.split(e),this.splitValue(e),this.removedAt)}canDelete(e,t){const n=!this.removedAt;return this.getCreatedAt().getLamport()<=t&&(!this.removedAt||e.after(this.removedAt))?n:!1}canStyle(e,t){return this.getCreatedAt().getLamport()<=t&&(!this.removedAt||e.after(this.removedAt))}remove(e){this.removedAt=e}createPosRange(){return[ve.of(this.id,0),ve.of(this.id,this.getLength())]}getDataSize(){const e=this.value.getDataSize();return this.id&&(e.meta+=rt),this.removedAt&&(e.meta+=rt),e}deepcopy(){return new ot(this.id,this.value,this.removedAt)}toTestString(){return`${this.id.toTestString()} ${this.value?this.value:""}`}splitValue(e){const t=this.value;return this.value=t.substring(0,e),t.substring(e,t.length)}toIDString(){return this.id.toIDString()}}class Rt{constructor(){o(this,"head"),o(this,"treeByIndex"),o(this,"treeByID"),this.head=ot.create(rh),this.treeByIndex=new Wt,this.treeByID=new aa(ot.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}static create(){return new Rt}edit(e,t,n,s){const[i,a]=this.findNodeWithSplit(e[1],t),[c,h]=this.findNodeWithSplit(e[0],t),l=this.findBetween(h,a),[f,m]=this.deleteNodes(l,t,s),v=a?a.getID():i.getID();let y=ve.of(v,0);if(n){const I=this.posToIndex(c.createPosRange()[1],!0),A=this.insertAfter(c,ot.create(Je.of(t,0),n));f.length&&f[f.length-1].from===I?f[f.length-1].value=n:f.push({actor:t.getActorID(),from:I,to:I,value:n}),y=ve.of(A.getID(),A.getContentLength())}const S=[];for(const[,I]of m)S.push({parent:this,child:I});return[y,S,f]}indexToPos(e){const[t,n]=this.treeByIndex.find(e),s=t;return ve.of(s.getID(),n)}findIndexesFromRange(e){const[t,n]=e;return[this.posToIndex(t,!1),this.posToIndex(n,!0)]}posToIndex(e,t){const n=e.getAbsoluteID(),s=t?this.findFloorNodePreferToLeft(n):this.findFloorNode(n);if(!s)throw new g(d.ErrInvalidArgument,`the node of the given id should be found: ${n.toTestString()}`);const i=this.treeByIndex.indexOf(s),a=s.isRemoved()?0:n.getOffset()-s.getID().getOffset();return i+a}findNode(e){return this.findFloorNode(e)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){const e=[];for(const t of this)t.isRemoved()||e.push(t.getValue());return e.join("")}*[Symbol.iterator](){let e=this.head.getNext();for(;e;)yield e,e=e.getNext()}getHead(){return this.head}deepcopy(){const e=new Rt;let t=this.head.getNext(),n=e.head,s;for(;t;){if(s=e.insertAfter(n,t.deepcopy()),t.hasInsPrev()){const i=e.findNode(t.getInsPrevID());s.setInsPrev(i)}n=s,t=t.getNext()}return e}toTestString(){const e=[];let t=this.head;for(;t;)t.isRemoved()?e.push(`{${t.toTestString()}}`):e.push(`[${t.toTestString()}]`),t=t.getNext();return e.join("")}insertAfter(e,t){const n=e.getNext();return t.setPrev(e),n&&n.setPrev(t),this.treeByID.put(t.getID(),t),this.treeByIndex.insertAfter(e,t),t}findNodeWithSplit(e,t){const n=e.getAbsoluteID();let s=this.findFloorNodePreferToLeft(n);const i=n.getOffset()-s.getID().getOffset();for(this.splitNode(s,i);s.hasNext()&&s.getNext().getCreatedAt().after(t);)s=s.getNext();return[s,s.getNext()]}findFloorNodePreferToLeft(e){let t=this.findFloorNode(e);if(!t)throw new g(d.ErrInvalidArgument,`the node of the given id should be found: ${e.toTestString()}`);if(e.getOffset()>0&&t.getID().getOffset()==e.getOffset()){if(!t.hasInsPrev())return t;t=t.getInsPrev()}return t}findFloorNode(e){const t=this.treeByID.floorEntry(e);if(t&&!(!t.key.equals(e)&&!t.key.hasSameCreatedAt(e)))return t.value}findBetween(e,t){const n=[];let s=e;for(;s&&s!==t;)n.push(s),s=s.getNext();return n}splitNode(e,t){if(t>e.getContentLength())throw new g(d.ErrInvalidArgument,"offset should be less than or equal to length");if(t===0)return e;if(t===e.getContentLength())return e.getNext();const n=e.split(t);this.treeByIndex.updateWeight(n),this.insertAfter(e,n);const s=e.getInsNext();return s&&s.setInsPrev(n),n.setInsPrev(e),n}deleteNodes(e,t,n){if(!e.length)return[[],new Map];const[s,i]=this.filterNodes(e,t,n),a=new Map,c=this.makeChanges(i,t);for(const h of s)a.set(h.getID().toIDString(),h),h.remove(t);return this.deleteIndexNodes(i),[c,a]}filterNodes(e,t,n){const s=[],i=[],[a,c]=this.findEdgesOfCandidates(e);i.push(a);for(const h of e){const l=h.getCreatedAt().getActorID();let f=Vt;n!=null&&(f=n.get(l)?n.get(l):0n),h.canDelete(t,f)?s.push(h):i.push(h)}return i.push(c),[s,i]}findEdgesOfCandidates(e){return[e[0].getPrev(),e[e.length-1].getNext()]}makeChanges(e,t){const n=[];let s,i;for(let a=0;a<e.length-1;a++){const c=e[a],h=e[a+1];c.getNext()!=h&&([s]=this.findIndexesFromRange(c.getNext().createPosRange()),h?[,i]=this.findIndexesFromRange(h.getPrev().createPosRange()):i=this.treeByIndex.length,s<i&&n.push({actor:t.getActorID(),from:s,to:i}))}return n.reverse()}deleteIndexNodes(e){for(let t=0;t<e.length-1;t++){const n=e[t],s=e[t+1];n.getNext()!=s&&this.treeByIndex.deleteRange(n,s)}}purge(e){this.treeByIndex.delete(e),this.treeByID.remove(e.getID());const t=e.getPrev(),n=e.getNext(),s=e.getInsPrev(),i=e.getInsNext();t&&t.setNext(n),n&&n.setPrev(t),e.setPrev(void 0),e.setNext(void 0),s&&s.setInsNext(i),i&&i.setInsPrev(s),e.setInsPrev(void 0),e.setInsNext(void 0)}}const ha=r=>r<0?Math.ceil(r):Math.floor(r);var we=(r=>(r[r.Int=0]="Int",r[r.Long=1]="Long",r))(we||{});class oe extends Kt{constructor(e,t,n){switch(super(n),o(this,"valueType"),o(this,"value"),this.valueType=e,e){case 0:typeof t=="number"?t>Math.pow(2,31)-1||t<-Math.pow(2,31)?this.value=x.fromNumber(t).toInt():this.value=ha(t):this.value=t.toInt();break;case 1:typeof t=="number"?this.value=x.fromNumber(t):this.value=t;break;default:throw new g(d.ErrUnimplemented,`unimplemented type: ${e}`)}}static create(e,t,n){return new oe(e,t,n)}static valueFromBytes(e,t){switch(e){case 0:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 1:return x.fromBytesLE(Array.from(t));default:throw new g(d.ErrUnimplemented,`unimplemented type: ${e}`)}}getDataSize(){return{data:this.valueType===0?4:8,meta:this.getMetaUsage()}}toJSON(){return`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){const e=oe.create(this.valueType,this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e}getType(){return this.valueType}static getCounterType(e){switch(typeof e){case"object":return e instanceof x?1:void 0;case"number":return e>Math.pow(2,31)-1||e<-Math.pow(2,31)?1:0;default:return}}static isSupport(e){return!!oe.getCounterType(e)}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===0||e===1}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 1:{const t=this.value.toBytesLE();return Uint8Array.from(t)}default:throw new g(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}increase(e){function t(n){if(!n.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof n.getValue()}`)}return t(this),t(e),this.valueType===1?this.value=this.value.add(e.getValue()):e.getType()===j.Long?this.value=this.value+e.getValue().toInt():this.value=x.fromNumber(this.value+ha(e.getValue())).toInt(),this}}class Bt extends de{constructor(e,t,n){super(e,n),o(this,"value"),this.value=t}static create(e,t,n){return new Bt(e,t,n)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(t instanceof oe))throw new g(d.ErrInvalidArgument,"fail to execute, only Counter can execute increase");const n=t,s=this.value.deepcopy();return n.increase(s),{opInfos:[{type:"increase",path:e.createPath(this.getParentCreatedAt()),value:s.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){const e=this.value.deepcopy(),n=e.getType()===j.Long?e.getValue().multiply(-1):e.getValue()*-1;return Bt.create(this.getParentCreatedAt(),F.of(n,e.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.INCREASE.${this.value.toJSON()}`}getValue(){return this.value}}class Ze extends de{constructor(e,t,n,s,i,a){super(e,a),o(this,"fromPos"),o(this,"toPos"),o(this,"attributes"),o(this,"attributesToRemove"),this.fromPos=t,this.toPos=n,this.attributes=s,this.attributesToRemove=i}static create(e,t,n,s,i){return new Ze(e,t,n,s,[],i)}static createTreeRemoveStyleOperation(e,t,n,s,i){return new Ze(e,t,n,new Map,s,i)}execute(e,t,n){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof fe))throw new g(d.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const i=s;let a,c;if(this.attributes.size){const h={};[...this.attributes].forEach(([l,f])=>h[l]=f),[c,a]=i.style([this.fromPos,this.toPos],h,this.getExecutedAt(),n)}else{const h=this.attributesToRemove;[c,a]=i.removeStyle([this.fromPos,this.toPos],h,this.getExecutedAt(),n)}for(const h of c)e.registerGCPair(h);return{opInfos:a.map(({from:h,to:l,value:f,fromPath:m,toPath:v})=>({type:"tree-style",from:h,to:l,value:this.attributes.size?{attributes:f}:{attributesToRemove:f},fromPath:m,toPath:v,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.fromPos.getLeftSiblingID().getOffset()}`,n=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.toPos.getLeftSiblingID().getOffset()}`;return`${e}.STYLE(${t},${n},${Object.entries(this.attributes||{}).map(([s,i])=>`${s}:"${i}"`).join(" ")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}}function nh(r){const e=new Xs,t=e.data;for(const[n,s]of Object.entries(r))t[n]=JSON.stringify(s);return e}function sh(r){if(r.type===Oe.Put)return new Ys({type:ft.PUT,presence:nh(r.presence)});if(r.type===Oe.Clear)return new Ys({type:ft.CLEAR});throw new g(d.ErrUnimplemented,"unimplemented type")}function ih(r){return new Ko({serverSeq:r.getServerSeq(),clientSeq:r.getClientSeq()})}function la(r){return new In({clientSeq:r.getClientSeq(),lamport:r.getLamport(),actorId:yi(r.getActorID()),versionVector:ii(r.getVersionVector())})}function N(r){if(r)return new b({lamport:r.getLamport(),delimiter:r.getDelimiter(),actorId:yi(r.getActorID())})}function ii(r){if(!r)return;const e=new An;for(const[t,n]of r)e.vector[t]=BigInt(n.toString());return e}function fa(r){switch(r){case j.Null:return P.NULL;case j.Boolean:return P.BOOLEAN;case j.Integer:return P.INTEGER;case j.Long:return P.LONG;case j.Double:return P.DOUBLE;case j.String:return P.STRING;case j.Bytes:return P.BYTES;case j.Date:return P.DATE;default:throw new g(d.ErrInvalidType,`unsupported type: ${r}`)}}function da(r){switch(r){case we.Int:return P.INTEGER_CNT;case we.Long:return P.LONG_CNT;default:throw new g(d.ErrInvalidType,`unsupported type: ${r}`)}}function oi(r){if(r instanceof ee)return new Ce({type:P.JSON_OBJECT,createdAt:N(r.getCreatedAt()),value:Na(r)});if(r instanceof se)return new Ce({type:P.JSON_ARRAY,createdAt:N(r.getCreatedAt()),value:Lh(r)});if(r instanceof le)return new Ce({type:P.TEXT,createdAt:N(r.getCreatedAt())});if(r instanceof F)return new Ce({type:fa(r.getType()),createdAt:N(r.getCreatedAt()),value:r.toBytes()});if(r instanceof oe)return new Ce({type:da(r.getType()),createdAt:N(r.getCreatedAt()),value:r.toBytes()});if(r instanceof fe)return new Ce({type:P.TREE,createdAt:N(r.getCreatedAt()),value:$h(r)});throw new g(d.ErrUnimplemented,"unimplemented element")}function oh(r){return new Vs({createdAt:N(r.getCreatedAt()),offset:r.getOffset()})}function ks(r){return new dt({createdAt:N(r.getID().getCreatedAt()),offset:r.getID().getOffset(),relativeOffset:r.getRelativeOffset()})}function Ns(r){return new _t({parentId:tr(r.getParentID()),leftSiblingId:tr(r.getLeftSiblingID())})}function tr(r){return new Et({createdAt:N(r.getCreatedAt()),offset:r.getOffset()})}function ga(r){const e=new _s;if(r instanceof mt){const t=r,n=new No;n.parentCreatedAt=N(t.getParentCreatedAt()),n.key=t.getKey(),n.value=oi(t.getValue()),n.executedAt=N(t.getExecutedAt()),e.body.case="set",e.body.value=n}else if(r instanceof Ht){const t=r,n=new Eo;n.parentCreatedAt=N(t.getParentCreatedAt()),n.prevCreatedAt=N(t.getPrevCreatedAt()),n.value=oi(t.getValue()),n.executedAt=N(t.getExecutedAt()),e.body.case="add",e.body.value=n}else if(r instanceof it){const t=r,n=new Po;n.parentCreatedAt=N(t.getParentCreatedAt()),n.prevCreatedAt=N(t.getPrevCreatedAt()),n.createdAt=N(t.getCreatedAt()),n.executedAt=N(t.getExecutedAt()),e.body.case="move",e.body.value=n}else if(r instanceof st){const t=r,n=new Do;n.parentCreatedAt=N(t.getParentCreatedAt()),n.createdAt=N(t.getCreatedAt()),n.executedAt=N(t.getExecutedAt()),e.body.case="remove",e.body.value=n}else if(r instanceof Xt){const t=r,n=new xo;n.parentCreatedAt=N(t.getParentCreatedAt()),n.from=ks(t.getFromPos()),n.to=ks(t.getToPos()),n.content=t.getContent();const s=n.attributes;for(const[i,a]of t.getAttributes())s[i]=a;n.executedAt=N(t.getExecutedAt()),e.body.case="edit",e.body.value=n}else if(r instanceof Zt){const t=r,n=new Co;n.parentCreatedAt=N(t.getParentCreatedAt()),n.from=ks(t.getFromPos()),n.to=ks(t.getToPos());const s=n.attributes;for(const[i,a]of t.getAttributes())s[i]=a;n.executedAt=N(t.getExecutedAt()),e.body.case="style",e.body.value=n}else if(r instanceof Bt){const t=r,n=new Oo;n.parentCreatedAt=N(t.getParentCreatedAt()),n.value=oi(t.getValue()),n.executedAt=N(t.getExecutedAt()),e.body.case="increase",e.body.value=n}else if(r instanceof er){const t=r,n=new Ro;n.parentCreatedAt=N(t.getParentCreatedAt()),n.from=Ns(t.getFromPos()),n.to=Ns(t.getToPos()),n.contents=dh(t.getContents()),n.splitLevel=t.getSplitLevel(),n.executedAt=N(t.getExecutedAt()),e.body.case="treeEdit",e.body.value=n}else if(r instanceof Ze){const t=r,n=new Bo;n.parentCreatedAt=N(t.getParentCreatedAt()),n.from=Ns(t.getFromPos()),n.to=Ns(t.getToPos());const s=t.getAttributesToRemove();if(s.length>0)n.attributesToRemove=s;else{const i=n.attributes;for(const[a,c]of t.getAttributes())i[a]=c}n.executedAt=N(t.getExecutedAt()),e.body.case="treeStyle",e.body.value=n}else throw new g(d.ErrUnimplemented,"unimplemented operation");return e}function ah(r){const e=[];for(const t of r)e.push(ga(t));return e}function ch(r){const e=new ko({id:la(r.getID()),message:r.getMessage()});return r.hasOperations()&&(e.operations=ah(r.getOperations())),r.hasPresenceChange()&&(e.presenceChange=sh(r.getPresenceChange())),e}function uh(r){const e=[];for(const t of r)e.push(ch(t));return e}function hh(r){const e=[];for(const t of r)e.push(new Mo({key:t.getStrKey(),element:ci(t.getValue())}));return e}function lh(r){const e=[];for(const t of r)e.push(new zo({element:ci(t.getValue())}));return e}function fh(r){const e=[];for(const t of r){const n=new _o;n.id=oh(t.getID()),n.value=t.getValue().getContent(),n.removedAt=N(t.getRemovedAt());const s=n.attributes,i=t.getValue().getAttrs();for(const a of i){const c=new Kn;c.value=a.getValue(),c.updatedAt=N(a.getUpdatedAt()),s[a.getKey()]=c}e.push(n)}return e}function dh(r){const e=[];if(!r||!r.length)return e;for(const t of r)e.push(new Vo({content:ai(t)}));return e}function gh(r){const e={};for(const t of r)e[t.getKey()]=new Kn({value:t.getValue(),updatedAt:N(t.getUpdatedAt()),isRemoved:t.isRemoved()});return e}function ai(r){if(!r)return[];const e=[];return Is(r,(t,n)=>{const s=new Ks({id:tr(t.id),type:t.type,removedAt:N(t.removedAt),depth:n});t.isText&&(s.value=t.value),t.insPrevID&&(s.insPrevId=tr(t.insPrevID)),t.insNextID&&(s.insNextId=tr(t.insNextID)),t.attrs&&(s.attributes=gh(t.attrs)),e.push(s)}),e}function mh(r){const e=new ae;return e.body.case="jsonObject",e.body.value=new Jo({nodes:hh(r.getRHT()),createdAt:N(r.getCreatedAt()),movedAt:N(r.getMovedAt()),removedAt:N(r.getRemovedAt())}),e}function ma(r){const e=new ae;return e.body.case="jsonArray",e.body.value=new Lo({nodes:lh(r.getElements()),createdAt:N(r.getCreatedAt()),movedAt:N(r.getMovedAt()),removedAt:N(r.getRemovedAt())}),e}function ph(r){const e=new ae;return e.body.case="primitive",e.body.value=new qo({type:fa(r.getType()),value:r.toBytes(),createdAt:N(r.getCreatedAt()),movedAt:N(r.getMovedAt()),removedAt:N(r.getRemovedAt())}),e}function yh(r){const e=new ae;return e.body.case="text",e.body.value=new $o({nodes:fh(r.getRGATreeSplit()),createdAt:N(r.getCreatedAt()),movedAt:N(r.getMovedAt()),removedAt:N(r.getRemovedAt())}),e}function vh(r){const e=new ae;return e.body.case="counter",e.body.value=new Uo({type:da(r.getType()),value:r.toBytes(),createdAt:N(r.getCreatedAt()),movedAt:N(r.getMovedAt()),removedAt:N(r.getRemovedAt())}),e}function pa(r){const e=new ae;return e.body.case="tree",e.body.value=new Fo({nodes:ai(r.getRoot()),createdAt:N(r.getCreatedAt()),movedAt:N(r.getMovedAt()),removedAt:N(r.getRemovedAt())}),e}function ci(r){if(r instanceof ee)return mh(r);if(r instanceof se)return ma(r);if(r instanceof F)return ph(r);if(r instanceof le)return yh(r);if(r instanceof oe)return vh(r);if(r instanceof fe)return pa(r);throw new g(d.ErrUnimplemented,"unimplemented element")}function wh(r){return new Ge({documentKey:r.getDocumentKey(),checkpoint:ih(r.getCheckpoint()),isRemoved:r.getIsRemoved(),changes:uh(r.getChanges()),snapshot:r.getSnapshot(),versionVector:ii(r.getVersionVector())})}function rr(r){if(!(r instanceof J))return{};const e=r.findDetails(qu);for(const t of e)return t.metadata;return{}}function at(r){return rr(r).code??""}function ya(r){return ye.of(r.clientSeq,BigInt(r.lamport),mi(r.actorId),ui(r.versionVector),BigInt(r.serverSeq))}function ui(r){if(!r)return;const e=new yt;return Object.entries(r.vector).forEach(([t,n])=>{e.set(t,BigInt(n.toString()))}),e}function E(r){if(r)return ne.of(BigInt(r.lamport),r.delimiter,mi(r.actorId))}function hi(r){const e={};return Object.entries(r.data).forEach(([t,n])=>{e[t]=JSON.parse(n)}),e}function Th(r){const e=r.type;if(e===ft.PUT){const t=hi(r.presence);return{type:Oe.Put,presence:t}}if(e===ft.CLEAR)return{type:Oe.Clear};throw new g(d.ErrInvalidType,`unsupported type: ${e}`)}function Sh(r){const e=new Map;return Object.entries(r).forEach(([t,n])=>{e.set(t,hi(n))}),e}function va(r){switch(r){case P.NULL:return j.Null;case P.BOOLEAN:return j.Boolean;case P.INTEGER:return j.Integer;case P.LONG:return j.Long;case P.DOUBLE:return j.Double;case P.STRING:return j.String;case P.BYTES:return j.Bytes;case P.DATE:return j.Date}throw new g(d.ErrUnimplemented,`unimplemented value type: ${r}`)}function Es(r){switch(r){case P.INTEGER_CNT:return we.Int;case P.LONG_CNT:return we.Long}throw new g(d.ErrUnimplemented,`unimplemented value type: ${r}`)}function li(r){switch(r.type){case P.JSON_OBJECT:return r.value?ka(r.value):ee.create(E(r.createdAt));case P.JSON_ARRAY:return r.value?Jh(r.value):se.create(E(r.createdAt));case P.TEXT:return le.create(Rt.create(),E(r.createdAt));case P.TREE:return qh(r.value);case P.NULL:case P.BOOLEAN:case P.INTEGER:case P.LONG:case P.DOUBLE:case P.STRING:case P.BYTES:case P.DATE:return F.of(F.valueFromBytes(va(r.type),r.value),E(r.createdAt));case P.INTEGER_CNT:case P.LONG_CNT:return oe.create(Es(r.type),oe.valueFromBytes(Es(r.type),r.value),E(r.createdAt))}}function Ps(r){return ve.of(Je.of(E(r.createdAt),r.offset),r.relativeOffset)}function wa(r){return Je.of(E(r.createdAt),r.offset)}function bh(r){const e=Yt.create(r.value);Object.entries(r.attributes).forEach(([n,s])=>{e.setAttr(n,s.value,E(s.updatedAt))});const t=ot.create(wa(r.id),e);return t.remove(E(r.removedAt)),t}function Jt(r){return pe.of(nr(r.parentId),nr(r.leftSiblingId))}function nr(r){return H.of(E(r.createdAt),r.offset)}function Ih(r){if(!r.length)return;const e=[];return r.forEach(t=>{const n=fi(t.content);e.push(n)}),e}function fi(r){if(r.length===0)return;const e=[];for(const s of r)e.push(kh(s));const t=e[e.length-1],n=new Map;n.set(r[e.length-1].depth,e[e.length-1]);for(let s=e.length-2;s>=0;s--)n.get(r[s].depth-1).prepend(e[s]),n.set(r[s].depth,e[s]);return t.updateDescendantsSize(),fe.create(t,Pt).getRoot()}function Ah(r){const e=Ye.create();for(const[t,n]of Object.entries(r))e.setInternal(t,n.value,E(n.updatedAt),n.isRemoved);return e}function kh(r){const e=nr(r.id),t=ie.create(e,r.type),n=Object.entries(r.attributes);return t.isText?t.value=r.value:n.length&&(t.attrs=Ah(r.attributes)),r.insPrevId&&(t.insPrevID=nr(r.insPrevId)),r.insNextId&&(t.insNextID=nr(r.insNextId)),t.removedAt=E(r.removedAt),t}function Ta(r){if(r.body.case==="set"){const e=r.body.value;return mt.create(e.key,li(e.value),E(e.parentCreatedAt),E(e.executedAt))}else if(r.body.case==="add"){const e=r.body.value;return Ht.create(E(e.parentCreatedAt),E(e.prevCreatedAt),li(e.value),E(e.executedAt))}else if(r.body.case==="move"){const e=r.body.value;return it.create(E(e.parentCreatedAt),E(e.prevCreatedAt),E(e.createdAt),E(e.executedAt))}else if(r.body.case==="remove"){const e=r.body.value;return st.create(E(e.parentCreatedAt),E(e.createdAt),E(e.executedAt))}else if(r.body.case==="edit"){const e=r.body.value,t=new Map;return Object.entries(e.attributes).forEach(([n,s])=>{t.set(n,s)}),Xt.create(E(e.parentCreatedAt),Ps(e.from),Ps(e.to),e.content,t,E(e.executedAt))}else if(r.body.case==="style"){const e=r.body.value,t=new Map;return Object.entries(e.attributes).forEach(([n,s])=>{t.set(n,s)}),Zt.create(E(e.parentCreatedAt),Ps(e.from),Ps(e.to),t,E(e.executedAt))}else{if(r.body.case==="select")return;if(r.body.case==="increase"){const e=r.body.value;return Bt.create(E(e.parentCreatedAt),li(e.value),E(e.executedAt))}else if(r.body.case==="treeEdit"){const e=r.body.value;return er.create(E(e.parentCreatedAt),Jt(e.from),Jt(e.to),Ih(e.contents),e.splitLevel,E(e.executedAt))}else if(r.body.case==="treeStyle"){const e=r.body.value,t=new Map,n=e.attributesToRemove;return(n==null?void 0:n.length)>0?Ze.createTreeRemoveStyleOperation(E(e.parentCreatedAt),Jt(e.from),Jt(e.to),n,E(e.executedAt)):(Object.entries(e.attributes).forEach(([s,i])=>{t.set(s,i)}),Ze.create(E(e.parentCreatedAt),Jt(e.from),Jt(e.to),t,E(e.executedAt)))}else throw new g(d.ErrUnimplemented,"unimplemented operation")}}function Nh(r){const e=[];for(const t of r){const n=Ta(t);n&&e.push(n)}return e}function Sa(r){const e=[];for(const t of r)e.push(vt.create({id:ya(t.id),operations:Nh(t.operations),presenceChange:t.presenceChange?Th(t.presenceChange):void 0,message:t.message}));return e}function Eh(r){return Ot.of(BigInt(r.serverSeq),r.clientSeq)}function Ph(r){return As.create(r.documentKey,Eh(r.checkpoint),r.isRemoved,Sa(r.changes),ui(r.versionVector),r.snapshot)}function ba(r){const e=new jt;for(const n of r.nodes){const s=di(n.element);e.set(n.key,s,s.getPositionedAt())}const t=new ee(E(r.createdAt),e);return t.setMovedAt(E(r.movedAt)),t.setRemovedAt(E(r.removedAt)),t}function Ia(r){const e=new Gt;for(const n of r.nodes)e.insert(di(n.element));const t=new se(E(r.createdAt),e);return t.setMovedAt(E(r.movedAt)),t.setRemovedAt(E(r.removedAt)),t}function Dh(r){const e=F.of(F.valueFromBytes(va(r.type),r.value),E(r.createdAt));return e.setMovedAt(E(r.movedAt)),e.setRemovedAt(E(r.removedAt)),e}function xh(r){const e=new Rt;let t=e.getHead();for(const s of r.nodes){const i=e.insertAfter(t,bh(s));s.insPrevId&&i.setInsPrev(e.findNode(wa(s.insPrevId))),t=i}const n=new le(e,E(r.createdAt));return n.setMovedAt(E(r.movedAt)),n.setRemovedAt(E(r.removedAt)),n}function Ch(r){const e=oe.create(Es(r.type),oe.valueFromBytes(Es(r.type),r.value),E(r.createdAt));return e.setMovedAt(E(r.movedAt)),e.setRemovedAt(E(r.removedAt)),e}function Aa(r){const e=fi(r.nodes);return fe.create(e,E(r.createdAt))}function di(r){if(r.body.case==="jsonObject")return ba(r.body.value);if(r.body.case==="jsonArray")return Ia(r.body.value);if(r.body.case==="primitive")return Dh(r.body.value);if(r.body.case==="text")return xh(r.body.value);if(r.body.case==="counter")return Ch(r.body.value);if(r.body.case==="tree")return Aa(r.body.value);throw new g(d.ErrUnimplemented,"unimplemented element")}function Oh(r){if(!r)return{root:ee.create(Pt),presences:new Map};const e=du.fromBinary(r);return{root:di(e.root),presences:Sh(e.presences)}}function Rh(r){const e=ii(r);return gi(e.toBinary())}function Bh(r){const e=pi(r),t=An.fromBinary(e);return ui(t)}function ka(r){if(!r)throw new g(d.ErrInvalidArgument,"bytes is empty");const e=ae.fromBinary(r);return ba(e.body.value)}function Na(r){return ci(r).toBinary()}function Jh(r){if(!r)throw new g(d.ErrInvalidArgument,"bytes is empty");const e=ae.fromBinary(r);return Ia(e.body.value)}function Lh(r){return ma(r).toBinary()}function qh(r){if(!r)throw new g(d.ErrInvalidArgument,"bytes is empty");const e=ae.fromBinary(r);return Aa(e.body.value)}function $h(r){return pa(r).toBinary()}function gi(r){return r?Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join(""):""}function mi(r){return gi(r)}function pi(r){return new Uint8Array(r.match(/.{1,2}/g).map(e=>parseInt(e,16)))}function yi(r){return pi(r)}function Uh(r){const e=In.fromBinary(r);return ya(e)}function Fh(r){const e=_s.fromBinary(r);return Ta(e)}const z={fromPresence:hi,toChangePack:wh,fromChangePack:Ph,fromChanges:Sa,toTreeNodes:ai,fromTreeNodes:fi,objectToBytes:Na,bytesToObject:ka,bytesToSnapshot:Oh,bytesToHex:gi,hexToBytes:pi,toHexString:mi,toUint8Array:yi,toOperation:ga,toChangeID:la,PbChangeID:In,bytesToChangeID:Uh,bytesToOperation:Fh,versionVectorToHex:Rh,hexToVersionVector:Bh};var Z=(r=>(r[r.Trivial=0]="Trivial",r[r.Debug=1]="Debug",r[r.Info=2]="Info",r[r.Warn=3]="Warn",r[r.Error=4]="Error",r[r.Fatal=5]="Fatal",r))(Z||{});let wt=3;function vi(r){wt=r}const k={trivial:(...r)=>{wt>0||typeof console<"u"&&console.log("YORKIE T:",...r)},debug:(...r)=>{wt>1||typeof console<"u"&&console.log("YORKIE D:",...r)},info:(...r)=>{wt>2||typeof console<"u"&&console.log("YORKIE I:",...r)},warn:(...r)=>{wt>3||typeof console<"u"&&(typeof console.warn<"u"?console.warn("YORKIE W:",...r):console.log("YORKIE W:",...r))},error:(...r)=>{wt>4||typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE E:",...r):console.log("YORKIE E:",...r))},fatal:(...r)=>{typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE F:",...r):console.log("YORKIE F:",...r))},isEnabled:r=>wt<=r};function Ea(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}class Mh{constructor(e,t,n,s,i){o(this,"reconnectStreamDelay"),o(this,"doc"),o(this,"docID"),o(this,"syncMode"),o(this,"remoteChangeEventReceived"),o(this,"watchStream"),o(this,"watchLoopTimerID"),o(this,"watchAbortController"),o(this,"unsubscribeBroadcastEvent"),this.reconnectStreamDelay=e,this.doc=t,this.docID=n,this.syncMode=s,this.remoteChangeEventReceived=!1,this.unsubscribeBroadcastEvent=i}changeSyncMode(e){this.syncMode=e}needRealtimeSync(){return this.syncMode===ur.RealtimeSyncOff?!1:this.syncMode===ur.RealtimePushOnly?this.doc.hasLocalChanges():this.syncMode!==ur.Manual&&(this.doc.hasLocalChanges()||this.remoteChangeEventReceived)}async runWatchLoop(e){const t=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await e(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.watchLoopTimerID=setTimeout(t,this.reconnectStreamDelay)})}catch{}};await t()}cancelWatchStream(){this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}}const wi=()=>{};class zh{constructor(e){o(this,"finalized",!1),o(this,"observers",[]),o(this,"finalError");try{e(this)}catch(t){this.error(t)}}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;if(!e)throw new g(d.ErrInvalidArgument,"missing observer");if(this.finalized)throw new g(d.ErrRefused,"observable is finalized due to previous error");typeof e=="object"?s=e:s={next:e,error:t,complete:n},s.next===void 0&&(s.next=wi),s.error===void 0&&(s.error=wi),s.complete===void 0&&(s.complete=wi);const i=Ea(),a=this.unsubscribeOne.bind(this,i);if(this.observers.push({subscriptionID:i,observer:s}),this.finalized)try{this.finalError?s.error(this.finalError):s.complete()}catch(c){k.warn(c)}return a}unsubscribeOne(e){var t;this.observers=(t=this.observers)==null?void 0:t.filter(n=>n.subscriptionID!==e)}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e].observer)}catch(n){k.error(n)}}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.observers=void 0)}}function _h(r){const e=new zh(r);return{subscribe:e.subscribe.bind(e),getProxy:()=>e}}class Lt{constructor(e,t,n,s){o(this,"prevID"),o(this,"nextID"),o(this,"delimiter"),o(this,"message"),o(this,"root"),o(this,"operations"),o(this,"presenceChange"),o(this,"previousPresence"),o(this,"reversePresenceKeys"),this.prevID=e,this.nextID=e.next(),this.delimiter=jo,this.root=t,this.operations=[],this.previousPresence=me(n),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=s}static create(e,t,n,s){return new Lt(e,t,n,s)}push(e){this.operations.push(e)}registerElement(e,t){this.root.registerElement(e,t)}registerRemovedElement(e){this.root.registerRemovedElement(e)}registerGCPair(e){this.root.registerGCPair(e)}getNextID(){return this.operations.length===0?this.prevID.next(!0).setLamport(this.prevID.getLamport()).setVersionVector(this.prevID.getVersionVector()):this.nextID}toChange(){const e=this.operations.length===0?this.prevID.next(!0):this.nextID;return vt.create({id:e,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}hasChange(){return this.operations.length>0||this.presenceChange!==void 0}setPresenceChange(e){this.presenceChange=e}setReversePresence(e,t){for(const n of Object.keys(e))t!=null&&t.addToHistory?this.reversePresenceKeys.add(n):this.reversePresenceKeys.delete(n)}getReversePresence(){if(this.reversePresenceKeys.size===0)return;const e={};for(const t of this.reversePresenceKeys)e[t]=this.previousPresence[t];return e}issueTimeTicket(){return this.delimiter+=1,this.nextID.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.nextID.createTimeTicket(this.delimiter)}}class sr{constructor(e){o(this,"rootObject"),o(this,"elementPairMapByCreatedAt"),o(this,"gcElementSetByCreatedAt"),o(this,"gcPairMap"),this.rootObject=e,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.registerElement(e,void 0),e.getDescendants(t=>{if(t.getRemovedAt()&&this.registerRemovedElement(t),t instanceof le||t instanceof fe)for(const n of t.getGCPairs())this.registerGCPair(n);return!1})}static create(){return new sr(ee.create(Pt))}findByCreatedAt(e){const t=this.elementPairMapByCreatedAt.get(e.toIDString());if(t)return t.element}findElementPairByCreatedAt(e){return this.elementPairMapByCreatedAt.get(e.toIDString())}createSubPaths(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!t)return[];const n=[];for(;t.parent;){const s=t.element.getCreatedAt(),i=t.parent.subPathOf(s);if(i===void 0)throw new g(d.ErrInvalidArgument,`cant find the given element: ${s.toIDString()}`);n.unshift(i),t=this.elementPairMapByCreatedAt.get(t.parent.getCreatedAt().toIDString())}return n.unshift("$"),n}createPath(e){return this.createSubPaths(e).join(".")}registerElement(e,t){this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),e instanceof nt&&e.getDescendants((n,s)=>(this.registerElement(n,s),!1))}deregisterElement(e){let t=0;const n=s=>{const i=s.getCreatedAt().toIDString();this.elementPairMapByCreatedAt.delete(i),this.gcElementSetByCreatedAt.delete(i),t++};return n(e),e instanceof nt&&e.getDescendants(s=>(n(s),!1)),t}registerRemovedElement(e){this.gcElementSetByCreatedAt.add(e.getCreatedAt().toIDString())}registerGCPair(e){if(this.gcPairMap.get(e.child.toIDString())){this.gcPairMap.delete(e.child.toIDString());return}this.gcPairMap.set(e.child.toIDString(),e)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){const e=new Set;for(const t of this.gcElementSetByCreatedAt){e.add(t);const n=this.elementPairMapByCreatedAt.get(t);n.element instanceof nt&&n.element.getDescendants(s=>(e.add(s.getCreatedAt().toIDString()),!1))}return e.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}getDocSize(){const e={live:{data:0,meta:0},gc:{data:0,meta:0}};for(const[t,n]of this.elementPairMapByCreatedAt)this.gcElementSetByCreatedAt.has(t)?(e.gc.data+=n.element.getDataSize().data,e.gc.meta+=n.element.getDataSize().meta):(e.live.data+=n.element.getDataSize().data,e.live.meta+=n.element.getDataSize().meta);for(const t of this.gcPairMap.values()){const n=t.child.getDataSize();e.gc.data+=n.data,e.gc.meta+=n.meta}return e}deepcopy(){return new sr(this.rootObject.deepcopy())}garbageCollect(e){let t=0;for(const n of this.gcElementSetByCreatedAt){const s=this.elementPairMapByCreatedAt.get(n),i=s.element.getRemovedAt();i&&(e!=null&&e.afterOrEqual(i))&&(s.parent.purge(s.element),t+=this.deregisterElement(s.element))}for(const[,n]of this.gcPairMap){const s=n.child.getRemovedAt();s&&(e!=null&&e.afterOrEqual(s))&&(n.parent.purge(n.child),this.gcPairMap.delete(n.child.toIDString()),t+=1)}return t}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}getStats(){return{elements:this.getElementMapSize(),gcPairs:this.gcPairMap.size,gcElements:this.getGarbageElementSetSize()}}}function Pa(r,e){const t=new ir(r);return new Proxy(e,t.getHandlers())}class ir{constructor(e){o(this,"context"),o(this,"handlers"),this.context=e,this.handlers={set:(t,n,s)=>(k.isEnabled(Z.Trivial)&&k.trivial(`obj[${n}]=${JSON.stringify(s)}`),ir.setInternal(e,t,n,s),!0),get:(t,n)=>(k.isEnabled(Z.Trivial)&&k.trivial(`obj[${n}]`),n==="getID"?()=>t.getCreatedAt():n==="toJSON"||n==="toString"?()=>t.toJSON():n==="toJS"?()=>t.toJS():n==="toJSForTest"?()=>t.toJSForTest():Tt(e,t.get(n))),ownKeys:t=>t.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(t,n)=>(k.isEnabled(Z.Trivial)&&k.trivial(`obj[${n}]`),ir.deleteInternal(e,t,n),!0)}}static setInternal(e,t,n,s){if(n.includes("."))throw new g(d.ErrInvalidObjectKey,"key must not contain the '.'.");const i=e.issueTimeTicket(),a=Ds(e,s,i),c=t.set(n,a,i);e.registerElement(a,t),c&&e.registerRemovedElement(c),e.push(mt.create(n,a.deepcopy(),t.getCreatedAt(),i))}static buildObjectMembers(e,t){const n={};for(const[s,i]of Object.entries(t)){if(s.includes("."))throw new g(d.ErrInvalidObjectKey,"key must not contain the '.'.");const a=e.issueTimeTicket(),c=Ds(e,i,a);n[s]=c}return n}static deleteInternal(e,t,n){const s=e.issueTimeTicket(),i=t.deleteByKey(n,s);i&&(e.push(st.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i))}getHandlers(){return this.handlers}}function Vh(r,e){const t=new _(r,e);return new Proxy(e,t.getHandlers())}function Kh(r){return typeof r=="string"||r instanceof String?!isNaN(r):!1}function jh(r){return["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(r)}class _{constructor(e,t){o(this,"context"),o(this,"handlers"),o(this,"array"),this.context=e,this.array=t,this.handlers={get:(n,s,i)=>s==="getID"?()=>n.getCreatedAt():s==="getElementByID"?a=>{const c=n.getByID(a);if(!(!c||c.isRemoved()))return ct(e,c)}:s==="getElementByIndex"?a=>{const c=n.get(a);return ct(e,c)}:s==="getLast"?()=>ct(e,n.getLast()):s==="deleteByID"?a=>{const c=_.deleteInternalByID(e,n,a);return ct(e,c)}:s==="insertAfter"?(a,c)=>{const h=_.insertAfterInternal(e,n,a,c);return ct(e,h)}:s==="insertBefore"?(a,c)=>{const h=_.insertBeforeInternal(e,n,a,c);return ct(e,h)}:s==="moveBefore"?(a,c)=>{_.moveBeforeInternal(e,n,a,c)}:s==="moveAfter"?(a,c)=>{_.moveAfterInternal(e,n,a,c)}:s==="moveFront"?a=>{_.moveFrontInternal(e,n,a)}:s==="moveLast"?a=>{_.moveLastInternal(e,n,a)}:Kh(s)?Tt(e,n.get(Number(s))):s==="push"?a=>_.pushInternal(e,n,a):s==="splice"?(a,c,...h)=>_.splice(e,n,a,c,...h):s==="length"?n.length:typeof s=="symbol"&&s===Symbol.iterator?_.iteratorInternal.bind(this,e,n):s==="includes"?(a,c)=>_.includes(e,n,a,c):s==="indexOf"?(a,c)=>_.indexOf(e,n,a,c):s==="lastIndexOf"?(a,c)=>_.lastIndexOf(e,n,a,c):s==="toJSForTest"?()=>n.toJSForTest():s==="toTestString"?()=>_.toTestString(n):typeof s=="string"&&jh(s)?(...a)=>{const c=Array.from(n).map(h=>Tt(e,h));return Array.prototype[s].apply(c,a)}:Reflect.get(n,s,i),deleteProperty:(n,s)=>(k.isEnabled(Z.Trivial)&&k.trivial(`array[${s}]`),_.deleteInternalByIndex(e,n,Number.parseInt(s)),!0)}}static*iteratorInternal(e,t){for(const n of t)yield ct(e,n)}static buildArrayElements(e,t){const n=[];for(const s of t){const i=e.issueTimeTicket(),a=Ds(e,s,i);n.push(a)}return n}static pushInternal(e,t,n){return _.insertAfterInternal(e,t,t.getLastCreatedAt(),n),t.length}static moveBeforeInternal(e,t,n,s){const i=e.issueTimeTicket(),a=t.getPrevCreatedAt(n);t.moveAfter(a,s,i),e.push(it.create(t.getCreatedAt(),a,s,i))}static moveAfterInternal(e,t,n,s){const i=e.issueTimeTicket();t.moveAfter(n,s,i),e.push(it.create(t.getCreatedAt(),n,s,i))}static moveFrontInternal(e,t,n){const s=e.issueTimeTicket(),i=t.getHead();t.moveAfter(i.getCreatedAt(),n,s),e.push(it.create(t.getCreatedAt(),i.getCreatedAt(),n,s))}static moveLastInternal(e,t,n){const s=e.issueTimeTicket(),i=t.getLastCreatedAt();t.moveAfter(i,n,s),e.push(it.create(t.getCreatedAt(),i,n,s))}static insertAfterInternal(e,t,n,s){const i=e.issueTimeTicket(),a=Ds(e,s,i);return t.insertAfter(n,a),e.registerElement(a,t),e.push(Ht.create(t.getCreatedAt(),n,a.deepcopy(),i)),a}static insertBeforeInternal(e,t,n,s){return _.insertAfterInternal(e,t,t.getPrevCreatedAt(n),s)}static deleteInternalByIndex(e,t,n){const s=e.issueTimeTicket(),i=t.deleteByIndex(n,s);if(i)return e.push(st.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static deleteInternalByID(e,t,n){const s=e.issueTimeTicket(),i=t.delete(n,s);return e.push(st.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static splice(e,t,n,s,...i){const a=t.length,c=n>=0?Math.min(n,a):Math.max(a+n,0),h=s===void 0?a:s<0?c:Math.min(c+s,a),l=[];for(let f=c;f<h;f++){const m=_.deleteInternalByIndex(e,t,c);if(m){const v=m.deepcopy();v.setRemovedAt(),l.push(Tt(e,v))}}if(i){let f=c===0?t.getHead().getID():t.get(c-1).getID();for(const m of i)f=_.insertAfterInternal(e,t,f,m).getID()}return l}static includes(e,t,n,s){var i;const a=t.length,c=s===void 0?0:s<0?Math.max(s+a,0):s;if(c>=a)return!1;if(F.isSupport(n))return Array.from(t).map(l=>Tt(e,l)).includes(n,c);for(let h=c;h<a;h++)if(((i=t.get(h))==null?void 0:i.getID())===n.getID())return!0;return!1}static indexOf(e,t,n,s){var i;const a=t.length,c=s===void 0?0:s<0?Math.max(s+a,0):s;if(c>=a)return-1;if(F.isSupport(n))return Array.from(t).map(l=>Tt(e,l)).indexOf(n,c);for(let h=c;h<a;h++)if(((i=t.get(h))==null?void 0:i.getID())===n.getID())return h;return-1}static lastIndexOf(e,t,n,s){var i;const a=t.length,c=s===void 0||s>=a?a-1:s<0?s+a:s;if(c<0)return-1;if(F.isSupport(n))return Array.from(t).map(l=>Tt(e,l)).lastIndexOf(n,c);for(let h=c;h>0;h--)if(((i=t.get(h))==null?void 0:i.getID())===n.getID())return h;return-1}static toTestString(e){return e.toTestString()}getHandlers(){return this.handlers}}class or{constructor(e,t){o(this,"context"),o(this,"text"),this.context=e,this.text=t}initialize(e,t){this.context=e,this.text=t}getID(){return this.text.getID()}edit(e,t,n,s){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.text.indexRangeToPosRange(e,t);k.isEnabled(Z.Debug)&&k.debug(`EDIT: f:${e}->${i[0].toTestString()}, t:${t}->${i[1].toTestString()} c:${n}`);const a=s?Ct(s):void 0,c=this.context.issueTimeTicket(),[,h,l]=this.text.edit(i,n,c,a);for(const f of h)this.context.registerGCPair(f);return this.context.push(new Xt(this.text.getCreatedAt(),i[0],i[1],n,a?new Map(Object.entries(a)):new Map,c)),this.text.findIndexesFromRange(l)}delete(e,t){return this.edit(e,t,"")}empty(){return this.edit(0,this.length,"")}setStyle(e,t,n){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.text.indexRangeToPosRange(e,t);k.isEnabled(Z.Debug)&&k.debug(`STYL: f:${e}->${s[0].toTestString()}, t:${t}->${s[1].toTestString()} a:${JSON.stringify(n)}`);const i=Ct(n),a=this.context.issueTimeTicket(),[c]=this.text.setStyle(s,i,a);for(const h of c)this.context.registerGCPair(h);return this.context.push(new Zt(this.text.getCreatedAt(),s[0],s[1],new Map(Object.entries(i)),a)),!0}indexRangeToPosRange(e){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");const t=this.text.indexRangeToPosRange(e[0],e[1]);return[t[0].toStruct(),t[1].toStruct()]}posRangeToIndexRange(e){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");const t=this.text.findIndexesFromRange([ve.fromStruct(e[0]),ve.fromStruct(e[1])]);return[t[0],t[1]]}toTestString(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toTestString()}values(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toString()}toJSON(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSForTest()}createRangeForTest(e,t){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.indexRangeToPosRange(e,t)}}class ar{constructor(e,t){o(this,"valueType"),o(this,"value"),o(this,"context"),o(this,"counter"),this.valueType=e,this.value=t}initialize(e,t){this.valueType=t.getValueType(),this.context=e,this.counter=t,this.value=t.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(e){if(!this.context||!this.counter)throw new g(d.ErrNotInitialized,"Counter is not initialized yet");const t=this.context.issueTimeTicket(),n=F.of(e,t);if(!n.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof n.getValue()}`);return this.counter.increase(n),this.context.push(Bt.create(this.counter.getCreatedAt(),n,t)),this}toJSForTest(){if(!this.context||!this.counter)throw new g(d.ErrNotInitialized,"Counter is not initialized yet");return this.counter.toJSForTest()}}function Ti(r){if(r.isText)return{type:r.type,value:r.value};const e={type:r.type,children:r.children.map(t=>Ti(t))};return r.attrs&&(e.attributes=Xe(r.attrs.toObject())),e}function Wh(r,e){const t={type:r.isText?r.parent.type:r.type,children:r.isText?r.parent.getChildrenText().length===e?[]:[{type:Be,value:r.parent.getChildrenText().slice(e)}]:r.children.slice(e).map(n=>Ti(n))};return r.attrs?t.attributes=Xe(r.attrs.toObject()):r.isText&&r.parent.attrs&&(t.attributes=Xe(r.parent.attrs.toObject())),t}function Gh(r,e){const{node:t}=r,n=[...e].slice(0,-1),s=t.isText?t.parent.getChildrenText().length:t.children.length,i=[...n,s],a=[...n],c=[];a[a.length-1]+=1,e.every((l,f)=>l===i[f])||c.push({fromPath:[...e],toPath:i});const h=Wh(t,e[e.length-1]);return h&&c.push({fromPath:a,toPath:a,content:h}),c}function Hh(r,e){const{node:t,offset:n}=r,s=t.children[n],i=t.children[n-1],{children:a}=s,c=[...e].slice(0,-1),h=[{fromPath:[...e],toPath:[...c,n+1]}];if(!s.children.length)return h;const l=[...c,n-1,i.hasTextChild()?i.getChildrenText().length:i.children.length],f=a.map(m=>Ti(m));return h.push({fromPath:l,toPath:l,content:f}),h}function Si(r,e,t){const{type:n}=r,s=t.issueTimeTicket();if(n===Be){Da(r);const{value:i}=r,a=ie.create(H.of(s,0),n,i);e.append(a)}else{const{children:i=[]}=r,{attributes:a}=r;let c;if(typeof a=="object"&&!na(a)){const l=Ct(a);c=new Ye;for(const[f,m]of Object.entries(l))c.set(f,m,s)}const h=ie.create(H.of(s,0),n,void 0,c);e.append(h);for(const l of i)Si(l,h,t)}}function Yh(r,e){const{type:t}=e,n=r.issueTimeTicket();let s;if(e.type===Be){const{value:i}=e;s=ie.create(H.of(n,0),t,i)}else if(e){const{children:i=[]}=e,{attributes:a}=e;let c;if(typeof a=="object"&&!na(a)){const h=Ct(a);c=new Ye;for(const[l,f]of Object.entries(h))c.set(l,f,n)}s=ie.create(H.of(r.issueTimeTicket(),0),t,void 0,c);for(const h of i)Si(h,s,r)}return s}function Da(r){if(!r.value.length)throw new g(d.ErrInvalidArgument,"text node cannot have empty value");return!0}function xa(r){if(!r.length)return!0;if(r[0].type===Be)for(const t of r){const{type:n}=t;if(n!==Be)throw new g(d.ErrInvalidArgument,"element node and text node cannot be passed together");Da(t)}else for(const t of r){const{type:n}=t;if(n===Be)throw new g(d.ErrInvalidArgument,"element node and text node cannot be passed together")}return!0}class cr{constructor(e){o(this,"initialRoot"),o(this,"context"),o(this,"tree"),this.initialRoot=e}initialize(e,t){this.context=e,this.tree=t}getID(){return this.tree.getID()}buildRoot(e){if(!this.initialRoot)return ie.create(H.of(e.issueTimeTicket(),0),ju);const t=ie.create(H.of(e.issueTimeTicket(),0),this.initialRoot.type);for(const n of this.initialRoot.children)Si(n,t,e);return t}getSize(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getIndexTree()}splitByPath(e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const t=this.tree.pathToTreePos(e),n=Gh(t,e);for(const s of n){const{fromPath:i,toPath:a,content:c}=s,h=this.tree.pathToPos(i),l=this.tree.pathToPos(a);this.editInternal(h,l,c?[c]:[],0)}}mergeByPath(e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const t=this.tree.pathToTreePos(e);if(t.node.isText)throw new g(d.ErrInvalidArgument,"text node cannot be merged");const n=Hh(t,e);for(const s of n){const{fromPath:i,toPath:a,content:c}=s,h=this.tree.pathToPos(i),l=this.tree.pathToPos(a);this.editInternal(h,l,c??[],0)}}styleByPath(e,t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const[n,s]=this.tree.pathToPosRange(e),i=this.context.issueTimeTicket(),a=t?Ct(t):void 0,[c]=this.tree.style([n,s],a,i);for(const h of c)this.context.registerGCPair(h);this.context.push(Ze.create(this.tree.getCreatedAt(),n,s,a?new Map(Object.entries(a)):new Map,i))}style(e,t,n){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),a=this.context.issueTimeTicket(),c=n?Ct(n):void 0,[h]=this.tree.style([s,i],c,a);for(const l of h)this.context.registerGCPair(l);this.context.push(Ze.create(this.tree.getCreatedAt(),s,i,c?new Map(Object.entries(c)):new Map,a))}removeStyle(e,t,n){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),a=this.context.issueTimeTicket(),[c]=this.tree.removeStyle([s,i],n,a);for(const h of c)this.context.registerGCPair(h);this.context.push(Ze.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),s,i,n,a))}editInternal(e,t,n,s=0){var i;if(n.length!==0&&n[0]&&(xa(n),n[0].type!==Be))for(const l of n){const{children:f=[]}=l;xa(f)}const a=this.context.getLastTimeTicket();let c=new Array;if(((i=n[0])==null?void 0:i.type)===Be){let l="";for(const f of n){const{value:m}=f;l+=m}c.push(ie.create(H.of(this.context.issueTimeTicket(),0),Be,l))}else c=n.map(l=>l&&Yh(this.context,l)).filter(l=>l);const[,h]=this.tree.edit([e,t],c.length?c.map(l=>l==null?void 0:l.deepcopy()):void 0,s,a,()=>this.context.issueTimeTicket());for(const l of h)this.context.registerGCPair(l);return this.context.push(er.create(this.tree.getCreatedAt(),e,t,c.length?c:void 0,s,a)),!0}editByPath(e,t,n,s=0){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new g(d.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(e),a=this.tree.pathToPos(t);return this.editInternal(i,a,n?[n]:[],s)}editBulkByPath(e,t,n,s=0){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new g(d.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(e),a=this.tree.pathToPos(t);return this.editInternal(i,a,n,s)}edit(e,t,n,s=0){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(e),a=this.tree.findPos(t);return this.editInternal(i,a,n?[n]:[],s)}editBulk(e,t,n,s=0){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(e),a=this.tree.findPos(t);return this.editInternal(i,a,n,s)}toXML(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexToPath(e)}pathToIndex(e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.pathToIndex(e)}pathRangeToPosRange(e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");const t=[this.tree.pathToIndex(e[0]),this.tree.pathToIndex(e[1])],n=this.tree.indexRangeToPosRange(t);return[n[0].toStruct(),n[1].toStruct()]}indexRangeToPosRange(e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexRangeToPosStructRange(e)}posRangeToIndexRange(e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");const t=[pe.fromStruct(e[0]),pe.fromStruct(e[1])];return this.tree.posRangeToIndexRange(t)}posRangeToPathRange(e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");const t=[pe.fromStruct(e[0]),pe.fromStruct(e[1])];return this.tree.posRangeToPathRange(t)}}function Ca(r,e){return Pa(r,e)}function ct(r,e){if(e){if(e instanceof F)return e;if(e instanceof ee)return Pa(r,e);if(e instanceof se)return Vh(r,e);if(e instanceof le)return new or(r,e);if(e instanceof oe){const t=new ar(we.Int,0);return t.initialize(r,e),t}else if(e instanceof fe){const t=new cr;return t.initialize(r,e),t}}else return;throw new TypeError(`Unsupported type of element: ${typeof e}`)}function Tt(r,e){const t=ct(r,e);return t instanceof F?t.getValue():t}function Ds(r,e,t){let n;if(F.isSupport(e))n=F.of(e,t);else if(Array.isArray(e))n=se.create(t,_.buildArrayElements(r,e));else if(typeof e=="object")e instanceof or?(n=le.create(Rt.create(),t),e.initialize(r,n)):e instanceof ar?(n=oe.create(e.getValueType(),e.getValue(),t),e.initialize(r,n)):e instanceof cr?(n=fe.create(e.buildRoot(r),t),e.initialize(r,n)):n=ee.create(t,ir.buildObjectMembers(r,e));else throw new TypeError(`Unsupported type of value: ${typeof e}`);return n}class xs{constructor(e,t){o(this,"context"),o(this,"presence"),this.context=e,this.presence=t}set(e,t){for(const n of Object.keys(e))this.presence[n]=e[n];this.context.setPresenceChange({type:Oe.Put,presence:me(this.presence)}),this.context.setReversePresence(e,t)}get(e){return this.presence[e]}clear(){this.presence={},this.context.setPresenceChange({type:Oe.Clear})}}const Oa=50;class Xh{constructor(){o(this,"undoStack",[]),o(this,"redoStack",[])}hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(e){this.undoStack.length>=Oa&&this.undoStack.shift(),this.undoStack.push(e)}popUndo(){return this.undoStack.pop()}pushRedo(e){this.redoStack.length>=Oa&&this.redoStack.shift(),this.redoStack.push(e)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}}const Ra="yorkie-devtools-panel",Ba="yorkie-devtools-sdk";function Ja(r){return[W.StatusChanged,W.Snapshot,W.LocalChange,W.RemoteChange,W.Initialized,W.Watched,W.Unwatched,W.PresenceChanged].includes(r.type)}function La(r){return r.every(Ja)}const Zh=Object.freeze(Object.defineProperty({__proto__:null,isDocEventForReplay:Ja,isDocEventsForReplay:La},Symbol.toStringTag,{value:"Module"}));let qt="disconnected";const qa=new Map,Cs=new Map;typeof window<"u"&&(window.docEventsForReplayByDocKey=Cs);function Os(r,e){(e!=null&&e.force||qt!=="disconnected")&&window.postMessage({source:Ba,...r},"*")}function Qh(r){if(!r.isEnableDevtools()||typeof window>"u"||qa.has(r.getKey()))return;Cs.set(r.getKey(),[]);const e=r.subscribe("all",t=>{La(t)&&(Cs.get(r.getKey()).push(t),qt==="synced"&&Os({msg:"doc::sync::partial",docKey:r.getKey(),event:t}))});qa.set(r.getKey(),[e]),Os({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",t=>{var n;if(((n=t.data)==null?void 0:n.source)!==Ra)return;switch(t.data.msg){case"devtools::connect":if(qt!=="disconnected")break;qt="connected",Os({msg:"doc::available",docKey:r.getKey()}),k.info(`[YD] Devtools connected. Doc: ${r.getKey()}`);break;case"devtools::disconnect":qt="disconnected",k.info(`[YD] Devtools disconnected. Doc: ${r.getKey()}`);break;case"devtools::subscribe":qt="synced",Os({msg:"doc::sync::full",docKey:r.getKey(),events:Cs.get(r.getKey())}),k.info(`[YD] Devtools subscribed. Doc: ${r.getKey()}`);break}})}var Qe=(r=>(r.Detached="detached",r.Attached="attached",r.Removed="removed",r))(Qe||{}),W=(r=>(r.StatusChanged="status-changed",r.ConnectionChanged="connection-changed",r.SyncStatusChanged="sync-status-changed",r.Snapshot="snapshot",r.LocalChange="local-change",r.RemoteChange="remote-change",r.Initialized="initialized",r.Watched="watched",r.Unwatched="unwatched",r.PresenceChanged="presence-changed",r.Broadcast="broadcast",r.LocalBroadcast="local-broadcast",r.AuthError="auth-error",r))(W||{}),Rs=(r=>(r.Connected="connected",r.Disconnected="disconnected",r))(Rs||{}),Bs=(r=>(r.Synced="synced",r.SyncFailed="sync-failed",r))(Bs||{});class bi{constructor(e,t){o(this,"key"),o(this,"status"),o(this,"opts"),o(this,"changeID"),o(this,"checkpoint"),o(this,"localChanges"),o(this,"root"),o(this,"clone"),o(this,"eventStream"),o(this,"eventStreamObserver"),o(this,"onlineClients"),o(this,"presences"),o(this,"history"),o(this,"internalHistory"),o(this,"isUpdating"),this.opts=t||{},this.key=e,this.status="detached",this.root=sr.create(),this.changeID=eh,this.checkpoint=th,this.localChanges=[],this.eventStream=_h(n=>{this.eventStreamObserver=n}),this.onlineClients=new Set,this.presences=new Map,this.isUpdating=!1,this.internalHistory=new Xh,this.history={canUndo:this.canUndo.bind(this),canRedo:this.canRedo.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this)},Qh(this)}update(e,t){if(this.getStatus()==="removed")throw new g(d.ErrDocumentRemoved,`${this.key} is removed`);this.ensureClone();const n=this.changeID.getActorID(),s=Lt.create(this.changeID,this.clone.root,this.clone.presences.get(n)||{},t);try{const i=Ca(s,this.clone.root.getObject());this.presences.has(n)||this.clone.presences.set(n,{}),this.isUpdating=!0,e(i,new xs(s,this.clone.presences.get(n)))}catch(i){throw this.clone=void 0,i}finally{this.isUpdating=!1}if(s.hasChange()){k.isEnabled(Z.Trivial)&&k.trivial(`trying to update a local change: ${this.toJSON()}`);const i=s.toChange(),{opInfos:a,reverseOps:c}=i.execute(this.root,this.presences,q.Local),h=s.getReversePresence();h&&c.push({type:"presence",value:h}),this.localChanges.push(i),c.length>0&&this.internalHistory.pushUndo(c),a.length>0&&this.internalHistory.clearRedo(),this.changeID=s.getNextID();const l=[];a.length>0&&l.push({type:"local-change",source:q.Local,value:{message:i.getMessage()||"",operations:a,actor:n,clientSeq:i.getID().getClientSeq(),serverSeq:i.getID().getServerSeq()},rawChange:this.isEnableDevtools()?i.toStruct():void 0}),i.hasPresenceChange()&&l.push({type:"presence-changed",source:q.Local,value:{clientID:n,presence:this.getPresence(n)}}),this.publish(l),k.isEnabled(Z.Trivial)&&k.trivial(`after update a local change: ${this.toJSON()}`)}}subscribe(e,t,n,s){if(typeof e=="string"){if(typeof t!="function")throw new g(d.ErrInvalidArgument,"Second argument must be a callback function");if(e==="presence"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type!=="initialized"&&l.type!=="watched"&&l.type!=="unwatched"&&l.type!=="presence-changed"||c(l)},n,s)}if(e==="my-presence"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type!=="initialized"&&l.type!=="presence-changed"||l.type==="presence-changed"&&l.value.clientID!==this.changeID.getActorID()||c(l)},n,s)}if(e==="others"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type!=="watched"&&l.type!=="unwatched"&&l.type!=="presence-changed"||l.value.clientID!==this.changeID.getActorID()&&c(l)},n,s)}if(e==="connection"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type==="connection-changed"&&c(l)},n,s)}if(e==="status"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type==="status-changed"&&c(l)},n,s)}if(e==="sync"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type==="sync-status-changed"&&c(l)},n,s)}if(e==="local-broadcast"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type==="local-broadcast"&&c(l)},n)}if(e==="broadcast"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type==="broadcast"&&c(l)},n)}if(e==="auth-error"){const c=t;return this.eventStream.subscribe(h=>{for(const l of h)l.type==="auth-error"&&c(l)},n)}if(e==="all"){const c=t;return this.eventStream.subscribe(c,n,s)}const i=e,a=t;return this.eventStream.subscribe(c=>{for(const h of c){if(h.type!=="local-change"&&h.type!=="remote-change")continue;const l=[];for(const f of h.value.operations)this.isSameElementOrChildOf(f.path,i)&&l.push(f);l.length&&a({...h,value:{...h.value,operations:l}})}},n,s)}if(typeof e=="function"){const i=e,a=t,c=n;return this.eventStream.subscribe(h=>{for(const l of h)l.type!=="snapshot"&&l.type!=="local-change"&&l.type!=="remote-change"||i(l)},a,c)}throw new g(d.ErrInvalidArgument,`"${e}" is not a valid`)}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}isSameElementOrChildOf(e,t){if(t===e)return!0;const n=e.split(".");return t.split(".").every((i,a)=>i===n[a])}removePushedLocalChanges(e){for(;this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>e);)this.localChanges.shift()}applyChangePack(e){const t=e.hasSnapshot();t?this.applySnapshot(e.getCheckpoint().getServerSeq(),e.getVersionVector(),e.getSnapshot(),e.getCheckpoint().getClientSeq()):(this.applyChanges(e.getChanges(),q.Remote),this.removePushedLocalChanges(e.getCheckpoint().getClientSeq())),this.checkpoint=this.checkpoint.forward(e.getCheckpoint()),t||this.garbageCollect(e.getVersionVector()),e.getIsRemoved()&&this.applyStatus("removed"),k.isEnabled(Z.Trivial)&&k.trivial(`${this.root.toJSON()}`)}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:me(this.presences)})}createChangePack(){const e=Array.from(this.localChanges),t=this.checkpoint.increaseClientSeq(e.length);return As.create(this.key,t,!1,e,this.getVersionVector())}setActor(e){for(const t of this.localChanges)t.setActor(e);this.changeID=this.changeID.setActor(e)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getCloneRoot(){if(this.clone)return this.clone.root.getObject()}getRoot(){this.ensureClone();const e=Lt.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});return Ca(e,this.clone.root.getObject())}getDocSize(){return this.root.getDocSize()}garbageCollect(e){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(e),this.root.garbageCollect(e))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}getStats(){return this.root.getStats()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(e,t,n,s=-1){const{root:i,presences:a}=z.bytesToSnapshot(n);this.root=new sr(i),this.presences=a,this.changeID=this.changeID.setClocks(t.maxLamport(),t),this.clone=void 0,this.removePushedLocalChanges(s),this.applyChanges(this.localChanges,q.Local),this.publish([{type:"snapshot",source:q.Remote,value:{serverSeq:e.toString(),snapshot:this.isEnableDevtools()?z.bytesToHex(n):void 0,snapshotVector:z.versionVectorToHex(t)}}])}applyChanges(e,t){k.isEnabled(Z.Debug)&&k.debug(`trying to apply ${e.length} remote changes.elements:${this.root.getElementMapSize()}, removeds:${this.root.getGarbageElementSetSize()}`),k.isEnabled(Z.Trivial)&&k.trivial(e.map(n=>`${n.getID().toTestString()}	${n.toTestString()}`).join(`
`));for(const n of e)this.applyChange(n,t);k.isEnabled(Z.Debug)&&k.debug(`after appling ${e.length} remote changes.elements:${this.root.getElementMapSize()},  removeds:${this.root.getGarbageElementSetSize()}`)}applyChange(e,t){this.ensureClone(),e.execute(this.clone.root,this.clone.presences,t);const n=[],s=e.getID().getActorID();if(e.hasPresenceChange()&&this.onlineClients.has(s)){const a=e.getPresenceChange();switch(a.type){case Oe.Put:n.push(this.presences.has(s)?{type:"presence-changed",source:t,value:{clientID:s,presence:a.presence}}:{type:"watched",source:q.Remote,value:{clientID:s,presence:a.presence}});break;case Oe.Clear:n.push({type:"unwatched",source:q.Remote,value:{clientID:s,presence:this.getPresence(s)}}),this.removeOnlineClient(s);break}}const{opInfos:i}=e.execute(this.root,this.presences,t);if(this.changeID=this.changeID.syncClocks(e.getID()),i.length>0){const a=this.isEnableDevtools()?e.toStruct():void 0;n.push(t===q.Remote?{type:"remote-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:a}:{type:"local-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:a})}n.length>0&&this.publish(n)}applyWatchStream(e){if(e.body.case==="initialization"){const t=e.body.value.clientIds,n=new Set;for(const s of t)s!==this.changeID.getActorID()&&n.add(s);this.setOnlineClients(n),this.publish([{type:"initialized",source:q.Local,value:this.getPresences()}]);return}if(e.body.case==="event"){const{type:t,publisher:n}=e.body.value,s=[];if(t===lt.DOCUMENT_WATCHED){if(this.onlineClients.has(n)&&this.hasPresence(n))return;this.addOnlineClient(n),this.hasPresence(n)&&s.push({type:"watched",source:q.Remote,value:{clientID:n,presence:this.getPresence(n)}})}else if(t===lt.DOCUMENT_UNWATCHED){const i=this.getPresence(n);this.removeOnlineClient(n),i&&s.push({type:"unwatched",source:q.Remote,value:{clientID:n,presence:i}})}else if(t===lt.DOCUMENT_BROADCAST&&e.body.value.body){const{topic:i,payload:a}=e.body.value.body,c=new TextDecoder;s.push({type:"broadcast",value:{clientID:n,topic:i,payload:JSON.parse(c.decode(a))}})}s.length>0&&this.publish(s)}}applyStatus(e){this.status=e,e==="detached"&&this.setActor(Ts),this.publish([{source:e==="removed"?q.Remote:q.Local,type:"status-changed",value:e==="attached"?{status:e,actorID:this.changeID.getActorID()}:{status:e}}])}applyDocEventForReplay(e){if(e.type==="status-changed"){this.applyStatus(e.value.status),e.value.status==="attached"&&this.setActor(e.value.actorID);return}if(e.type==="snapshot"){const{snapshot:t,serverSeq:n,snapshotVector:s}=e.value;if(!t)return;this.applySnapshot(BigInt(n),z.hexToVersionVector(s),z.hexToBytes(t));return}if(e.type==="local-change"||e.type==="remote-change"){if(!e.rawChange)return;const t=vt.fromStruct(e.rawChange);this.applyChange(t,e.source)}if(e.type==="initialized"){const t=new Set;for(const{clientID:n,presence:s}of e.value)t.add(n),this.presences.set(n,s);this.setOnlineClients(t);return}if(e.type==="watched"){const{clientID:t,presence:n}=e.value;this.addOnlineClient(t),this.presences.set(t,n);return}if(e.type==="unwatched"){const{clientID:t}=e.value;this.removeOnlineClient(t),this.presences.delete(t)}if(e.type==="presence-changed"){const{clientID:t,presence:n}=e.value;this.presences.set(t,n)}}applyDocEventsForReplay(e){for(const t of e)this.applyDocEventForReplay(t)}getValueByPath(e){if(!e.startsWith("$"))throw new g(d.ErrInvalidArgument,'path must start with "$"');const t=e.split(".");t.shift();let n=this.getRoot();for(const s of t)if(n=n[s],n===void 0)return;return n}setOnlineClients(e){this.onlineClients=e}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(e){this.onlineClients.add(e)}removeOnlineClient(e){this.onlineClients.delete(e)}hasPresence(e){return this.presences.has(e)}getMyPresence(){if(this.status!=="attached")return{};const e=this.presences.get(this.changeID.getActorID());return e?me(e):{}}getPresence(e){if(e===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(e))return;const t=this.presences.get(e);return t?me(t):void 0}getPresenceForTest(e){const t=this.presences.get(e);return t?me(t):void 0}getPresences(){const e=[];e.push({clientID:this.changeID.getActorID(),presence:me(this.getMyPresence())});for(const t of this.onlineClients)this.presences.has(t)&&e.push({clientID:t,presence:me(this.presences.get(t))});return e}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){const e=this.getChangeID().getActorID();return this.getPresences().filter(t=>t.clientID!==e).sort((t,n)=>t.clientID>n.clientID?1:-1)}canUndo(){return this.internalHistory.hasUndo()&&!this.isUpdating}canRedo(){return this.internalHistory.hasRedo()&&!this.isUpdating}undo(){if(this.isUpdating)throw new g(d.ErrRefused,"Undo is not allowed during an update");const e=this.internalHistory.popUndo();if(e===void 0)throw new g(d.ErrRefused,"There is no operation to be undone");this.ensureClone();const t=Lt.create(this.changeID,this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const l of e){if(!(l instanceof de)){new xs(t,me(this.clone.presences.get(this.changeID.getActorID()))).set(l.value,{addToHistory:!0});continue}const f=t.issueTimeTicket();l.setExecutedAt(f),t.push(l)}const n=t.toChange();n.execute(this.clone.root,this.clone.presences,q.UndoRedo);const{opInfos:s,reverseOps:i}=n.execute(this.root,this.presences,q.UndoRedo),a=t.getReversePresence();if(a&&i.push({type:"presence",value:a}),i.length>0&&this.internalHistory.pushRedo(i),!n.hasPresenceChange()&&s.length===0)return;this.localChanges.push(n),this.changeID=t.getNextID();const c=this.changeID.getActorID(),h=[];s.length>0&&h.push({type:"local-change",source:q.UndoRedo,value:{message:n.getMessage()||"",operations:s,actor:c,clientSeq:n.getID().getClientSeq(),serverSeq:n.getID().getServerSeq()},rawChange:this.isEnableDevtools()?n.toStruct():void 0}),n.hasPresenceChange()&&h.push({type:"presence-changed",source:q.UndoRedo,value:{clientID:c,presence:this.getPresence(c)}}),this.publish(h)}redo(){if(this.isUpdating)throw new g(d.ErrRefused,"Redo is not allowed during an update");const e=this.internalHistory.popRedo();if(e===void 0)throw new g(d.ErrRefused,"There is no operation to be redone");this.ensureClone();const t=Lt.create(this.changeID,this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const l of e){if(!(l instanceof de)){new xs(t,me(this.clone.presences.get(this.changeID.getActorID()))).set(l.value,{addToHistory:!0});continue}const f=t.issueTimeTicket();l.setExecutedAt(f),t.push(l)}const n=t.toChange();n.execute(this.clone.root,this.clone.presences,q.UndoRedo);const{opInfos:s,reverseOps:i}=n.execute(this.root,this.presences,q.UndoRedo),a=t.getReversePresence();if(a&&i.push({type:"presence",value:a}),i.length>0&&this.internalHistory.pushUndo(i),!n.hasPresenceChange()&&s.length===0)return;this.localChanges.push(n),this.changeID=t.getNextID();const c=this.changeID.getActorID(),h=[];s.length>0&&h.push({type:"local-change",source:q.UndoRedo,value:{message:n.getMessage()||"",operations:s,actor:c,clientSeq:n.getID().getClientSeq(),serverSeq:n.getID().getServerSeq()},rawChange:this.isEnableDevtools()?n.toStruct():void 0}),n.hasPresenceChange()&&h.push({type:"presence-changed",source:q.UndoRedo,value:{clientID:c,presence:this.getPresence(c)}}),this.publish(h)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}broadcast(e,t,n){const s={type:"local-broadcast",value:{topic:e,payload:t},options:n};this.publish([s])}getVersionVector(){return this.changeID.getVersionVector()}}function el(r,e){let t=e;return{authInterceptor:i=>async a=>(r&&a.header.set("x-api-key",r),t&&a.header.set("authorization",t),await i(a)),setToken:i=>{t=i}}}const $a={name:"@yorkie-js/sdk",version:"0.6.12"};function tl(r){return e=>async t=>(r?t.header.set("x-yorkie-user-agent",r):t.header.set("x-yorkie-user-agent",$a.name+"/"+$a.version),await e(t))}const rl=r=>{try{if(JSON.stringify(r)===void 0)return!1}catch{return!1}return!0};var ur=(r=>(r.Manual="manual",r.Realtime="realtime",r.RealtimePushOnly="realtime-pushonly",r.RealtimeSyncOff="realtime-syncoff",r))(ur||{}),Ua=(r=>(r.Deactivated="deactivated",r.Activated="activated",r))(Ua||{}),Fa=(r=>(r.SyncLoop="SyncLoop",r.WatchLoop="WatchLoop",r))(Fa||{});const hr={rpcAddr:"https://api.yorkie.dev",syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3},Ii={maxRetries:1/0,initialRetryInterval:1e3,maxBackoff:2e4};class Ai{constructor(e){o(this,"id"),o(this,"key"),o(this,"metadata"),o(this,"status"),o(this,"attachmentMap"),o(this,"apiKey"),o(this,"authTokenInjector"),o(this,"conditions"),o(this,"syncLoopDuration"),o(this,"reconnectStreamDelay"),o(this,"retrySyncLoopDelay"),o(this,"rpcClient"),o(this,"setAuthToken"),o(this,"taskQueue"),o(this,"processing",!1),o(this,"keepalive",!1),e=e||hr;const t=e.rpcAddr||hr.rpcAddr;this.key=e.key||Ea(),this.metadata=e.metadata||{},this.status="deactivated",this.attachmentMap=new Map,this.apiKey=e.apiKey||"",this.authTokenInjector=e.authTokenInjector,this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=e.syncLoopDuration??hr.syncLoopDuration,this.reconnectStreamDelay=e.reconnectStreamDelay??hr.reconnectStreamDelay,this.retrySyncLoopDelay=e.retrySyncLoopDelay??hr.retrySyncLoopDelay;const{authInterceptor:n,setToken:s}=el(this.apiKey);this.setAuthToken=s,this.rpcClient=Vc(Lu,fu({baseUrl:t,interceptors:[n,tl(e==null?void 0:e.userAgent)],fetch:(i,a)=>{const c={...a,keepalive:this.keepalive};return fetch(i,c)}})),this.taskQueue=[]}async activate(){if(this.isActive())return Promise.resolve();if(this.authTokenInjector){const e=await this.authTokenInjector();this.setAuthToken(e)}return this.enqueueTask(async()=>{try{const e=await this.rpcClient.activateClient({clientKey:this.key,metadata:this.metadata},{headers:{"x-shard-key":this.apiKey}});this.id=e.clientId,this.status="activated",this.runSyncLoop(),k.info(`[AC] c:"${this.getKey()}" activated, id:"${this.id}"`),typeof window<"u"&&window.addEventListener("beforeunload",async()=>{await this.deactivate({keepalive:!0})})}catch(e){throw k.error(`[AC] c:"${this.getKey()}" err :`,e),await this.handleConnectError(e),e}})}deactivate(e={keepalive:!1}){if(this.status==="deactivated")return Promise.resolve();const t=async()=>{try{await this.rpcClient.deactivateClient({clientId:this.id},{headers:{"x-shard-key":this.apiKey}}),this.deactivateInternal(),k.info(`[DC] c"${this.getKey()}" deactivated`)}catch(n){throw k.error(`[DC] c:"${this.getKey()}" err :`,n),await this.handleConnectError(n),n}};if(e.keepalive){this.keepalive=!0;const n=t();return this.keepalive=!1,n}return this.enqueueTask(t)}hasDocument(e){return this.attachmentMap.has(e)}attach(e,t={}){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);if(e.getStatus()!==Qe.Detached)throw new g(d.ErrDocumentNotDetached,`${e.getKey()} is not detached`);e.setActor(this.id),e.update((i,a)=>a.set(t.initialPresence||{}));const n=e.subscribe("local-broadcast",async i=>{var a;const{topic:c,payload:h}=i.value,l=(a=i.options)==null?void 0:a.error,f=i.options;try{await this.broadcast(e.getKey(),c,h,f)}catch(m){m instanceof Error&&(l==null||l(m))}}),s=t.syncMode??"realtime";return this.enqueueTask(async()=>{try{const i=await this.rpcClient.attachDocument({clientId:this.id,changePack:z.toChangePack(e.createChangePack())},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),a=z.fromChangePack(i.changePack);if(e.applyChangePack(a),e.getStatus()===Qe.Removed)return e;e.applyStatus(Qe.Attached),this.attachmentMap.set(e.getKey(),new Mh(this.reconnectStreamDelay,e,i.documentId,s,n)),s!=="manual"&&await this.runWatchLoop(e.getKey()),k.info(`[AD] c:"${this.getKey()}" attaches d:"${e.getKey()}"`);const c=e.getRootObject();if(t.initialRoot){const h=t.initialRoot;e.update(l=>{for(const[f,m]of Object.entries(h))if(!c.has(f)){const v=f;l[v]=m}})}return e}catch(i){throw k.error(`[AD] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}})}detach(e,t={keepalive:!1}){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);const n=this.attachmentMap.get(e.getKey());if(!n)throw new g(d.ErrDocumentNotAttached,`${e.getKey()} is not attached`);e.update((i,a)=>a.clear());const s=async()=>{try{const i=await this.rpcClient.detachDocument({clientId:this.id,documentId:n.docID,changePack:z.toChangePack(e.createChangePack()),removeIfNotAttached:t.removeIfNotAttached??!1},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),a=z.fromChangePack(i.changePack);return e.applyChangePack(a),e.getStatus()!==Qe.Removed&&e.applyStatus(Qe.Detached),this.detachInternal(e.getKey()),k.info(`[DD] c:"${this.getKey()}" detaches d:"${e.getKey()}"`),e}catch(i){throw k.error(`[DD] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};if(t.keepalive){this.keepalive=!0;const i=s();return this.keepalive=!1,i}return this.enqueueTask(s)}async changeSyncMode(e,t){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);const n=this.attachmentMap.get(e.getKey());if(!n)throw new g(d.ErrDocumentNotAttached,`${e.getKey()} is not attached`);const s=n.syncMode;return s===t?e:(n.changeSyncMode(t),t==="manual"?(n.cancelWatchStream(),e):(t==="realtime"&&(n.remoteChangeEventReceived=!0),s==="manual"&&await this.runWatchLoop(e.getKey()),e))}sync(e){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);if(e){const t=this.attachmentMap.get(e.getKey());if(!t)throw new g(d.ErrDocumentNotAttached,`${e.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(t,"realtime").catch(async n=>{throw k.error(`[SY] c:"${this.getKey()}" err :`,n),await this.handleConnectError(n),n}))}return this.enqueueTask(async()=>{const t=[];for(const[,n]of this.attachmentMap)t.push(this.syncInternal(n,n.syncMode));return Promise.all(t).catch(async n=>{throw k.error(`[SY] c:"${this.getKey()}" err :`,n),await this.handleConnectError(n),n})})}remove(e){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);const t=this.attachmentMap.get(e.getKey());if(!t)throw new g(d.ErrDocumentNotAttached,`${e.getKey()} is not attached`);e.setActor(this.id);const n=z.toChangePack(e.createChangePack());return n.isRemoved=!0,this.enqueueTask(async()=>{try{const s=await this.rpcClient.removeDocument({clientId:this.id,documentId:t.docID,changePack:n},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),i=z.fromChangePack(s.changePack);e.applyChangePack(i),this.detachInternal(e.getKey()),k.info(`[RD] c:"${this.getKey()}" removes d:"${e.getKey()}"`)}catch(s){throw k.error(`[RD] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}})}getID(){return this.id}getKey(){return this.key}isActive(){return this.status==="activated"}getStatus(){return this.status}getCondition(e){return this.conditions[e]}broadcast(e,t,n,s){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);const i=this.attachmentMap.get(e);if(!i)throw new g(d.ErrDocumentNotAttached,`${e} is not attached`);if(!rl(n))throw new g(d.ErrInvalidArgument,"payload is not serializable");const a=(s==null?void 0:s.maxRetries)??Ii.maxRetries,c=Ii.maxBackoff;let h=0;const l=m=>Math.min(Ii.initialRetryInterval*2**m,c),f=async()=>this.enqueueTask(async()=>{try{await this.rpcClient.broadcast({clientId:this.id,documentId:i.docID,topic:t,payload:new TextEncoder().encode(JSON.stringify(n))},{headers:{"x-shard-key":`${this.apiKey}/${e}`}}),k.info(`[BC] c:"${this.getKey()}" broadcasts d:"${e}" t:"${t}"`)}catch(m){if(k.error(`[BC] c:"${this.getKey()}" err:`,m),await this.handleConnectError(m))if(m instanceof J&&at(m)===d.ErrUnauthenticated&&i.doc.publish([{type:W.AuthError,value:{reason:rr(m).reason,method:"Broadcast"}}]),h<a)h++,setTimeout(()=>f(),l(h-1)),k.info(`[BC] c:"${this.getKey()}" retry attempt ${h}/${a}`);else throw k.error(`[BC] c:"${this.getKey()}" exceeded maximum retry attempts`),m;else throw m}});return f()}runSyncLoop(){const e=()=>{if(!this.isActive()){k.debug(`[SL] c:"${this.getKey()}" exit sync loop`),this.conditions.SyncLoop=!1;return}const t=[];for(const[,n]of this.attachmentMap)n.needRealtimeSync()&&(n.remoteChangeEventReceived=!1,t.push(this.syncInternal(n,n.syncMode).catch(async s=>{throw s instanceof J&&at(s)===d.ErrUnauthenticated&&n.doc.publish([{type:W.AuthError,value:{reason:rr(s).reason,method:"PushPull"}}]),s})));Promise.all(t).then(()=>setTimeout(e,this.syncLoopDuration)).catch(async n=>{k.error(`[SL] c:"${this.getKey()}" sync failed:`,n),await this.handleConnectError(n)?setTimeout(e,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1})};k.debug(`[SL] c:"${this.getKey()}" run sync loop`),this.conditions.SyncLoop=!0,e()}async runWatchLoop(e){const t=this.attachmentMap.get(e);if(!t)throw new g(d.ErrDocumentNotAttached,`${e} is not attached`);return this.conditions.WatchLoop=!0,t.runWatchLoop(n=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new g(d.ErrClientNotActivated,`${this.key} is not active`));const s=new AbortController,i=this.rpcClient.watchDocument({clientId:this.id,documentId:t.docID},{headers:{"x-shard-key":`${this.apiKey}/${e}`},signal:s.signal});return t.doc.publish([{type:W.ConnectionChanged,value:Rs.Connected}]),k.info(`[WD] c:"${this.getKey()}" watches d:"${e}"`),new Promise((a,c)=>{(async()=>{try{for await(const l of i)this.handleWatchDocumentsResponse(t,l),l.body.case==="initialization"&&a([i,s])}catch(l){t.doc.resetOnlineClients(),t.doc.publish([{type:W.Initialized,source:q.Local,value:t.doc.getPresences()}]),t.doc.publish([{type:W.ConnectionChanged,value:Rs.Disconnected}]),k.debug(`[WD] c:"${this.getKey()}" unwatches`),await this.handleConnectError(l)?(l instanceof J&&at(l)===d.ErrUnauthenticated&&t.doc.publish([{type:W.AuthError,value:{reason:rr(l).reason,method:"WatchDocuments"}}]),n()):this.conditions.WatchLoop=!1,c(l)}})()})})}handleWatchDocumentsResponse(e,t){if(t.body.case==="event"&&t.body.value.type===lt.DOCUMENT_CHANGED){e.remoteChangeEventReceived=!0;return}e.doc.applyWatchStream(t)}deactivateInternal(){this.status="deactivated";for(const[e,t]of this.attachmentMap)this.detachInternal(e),t.doc.applyStatus(Qe.Detached)}detachInternal(e){const t=this.attachmentMap.get(e);t&&(t.cancelWatchStream(),t.unsubscribeBroadcastEvent(),this.attachmentMap.delete(e))}async syncInternal(e,t){const{doc:n,docID:s}=e,i=n.createChangePack();try{const a=await this.rpcClient.pushPullChanges({clientId:this.id,documentId:s,changePack:z.toChangePack(i),pushOnly:t==="realtime-pushonly"},{headers:{"x-shard-key":`${this.apiKey}/${n.getKey()}`}}),c=z.fromChangePack(a.changePack);if(c.hasChanges()&&(e.syncMode==="realtime-pushonly"||e.syncMode==="realtime-syncoff"))return n;n.applyChangePack(c),e.doc.publish([{type:W.SyncStatusChanged,value:Bs.Synced}]),n.getStatus()===Qe.Removed&&this.detachInternal(n.getKey());const h=n.getKey(),l=c.getChangeSize();return k.info(`[PP] c:"${this.getKey()}" sync d:"${h}", push:${i.getChangeSize()} pull:${l} cp:${c.getCheckpoint().toTestString()}`),n}catch(a){throw n.publish([{type:W.SyncStatusChanged,value:Bs.SyncFailed}]),k.error(`[PP] c:"${this.getKey()}" err :`,a),a}}async handleConnectError(e){if(!(e instanceof J))return!1;if(e.code===D.Canceled||e.code===D.Unknown||e.code===D.ResourceExhausted||e.code===D.Unavailable)return!0;if(at(e)===d.ErrUnauthenticated){if(this.authTokenInjector){const t=await this.authTokenInjector(rr(e).reason);this.setAuthToken(t)}return!0}return at(e)===d.ErrTooManySubscribers?(k.error(`[WD] c:"${this.getKey()}" err :`,e.rawMessage),!0):(at(e)===d.ErrTooManyAttachments||(at(e)===d.ErrClientNotActivated||at(e)===d.ErrClientNotFound)&&this.deactivateInternal(),!1)}enqueueTask(e){return new Promise((t,n)=>{this.taskQueue.push(()=>e().then(t).catch(n)),this.processing||this.processNext()})}async processNext(){if(this.taskQueue.length===0){this.processing=!1;return}try{this.processing=!0,await this.taskQueue.shift()()}catch{k.error(`[TQ] c:"${this.getKey()}" process failed, id:"${this.id}"`)}this.processNext()}}const nl={Client:Ai,Document:bi,Primitive:F,Text:or,Counter:ar,Tree:cr,LogLevel:Z,setLogLevel:vi,IntType:we.Int,LongType:we.Long};typeof globalThis<"u"&&(globalThis.yorkie={Client:Ai,Document:bi,Primitive:F,Text:or,Counter:ar,Tree:cr,LogLevel:Z,setLogLevel:vi,IntType:we.Int,LongType:we.Long}),L.Change=vt,L.Client=Ai,L.ClientCondition=Fa,L.ClientStatus=Ua,L.Counter=ar,L.CounterType=we,L.Devtools=Zh,L.DocEventType=W,L.DocStatus=Qe,L.DocSyncStatus=Bs,L.Document=bi,L.EventSourceDevPanel=Ra,L.EventSourceSDK=Ba,L.LogLevel=Z,L.OpSource=q,L.Presence=xs,L.Primitive=F,L.StreamConnectionStatus=Rs,L.SyncMode=ur,L.Text=or,L.TimeTicket=ne,L.Tree=cr,L.VersionVector=yt,L.converter=z,L.default=nl,L.setLogLevel=vi,Object.defineProperties(L,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})}(lr,lr.exports)),lr.exports}export{hl as g,ll as r};
